<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>Python | Master Reference</title>
    <meta name="description" content="The official Reference.">
    
    
    <link rel="preload" href="/ref-docs/assets/css/0.styles.33ab0e08.css" as="style"><link rel="preload" href="/ref-docs/assets/js/app.71b49bc2.js" as="script"><link rel="preload" href="/ref-docs/assets/js/31.edabf6af.js" as="script"><link rel="prefetch" href="/ref-docs/assets/js/10.cd080828.js"><link rel="prefetch" href="/ref-docs/assets/js/11.6c769a69.js"><link rel="prefetch" href="/ref-docs/assets/js/12.395e1ff2.js"><link rel="prefetch" href="/ref-docs/assets/js/13.a720ccda.js"><link rel="prefetch" href="/ref-docs/assets/js/14.14214069.js"><link rel="prefetch" href="/ref-docs/assets/js/15.847f6339.js"><link rel="prefetch" href="/ref-docs/assets/js/16.8eb7c425.js"><link rel="prefetch" href="/ref-docs/assets/js/17.78234f56.js"><link rel="prefetch" href="/ref-docs/assets/js/18.cc447a0c.js"><link rel="prefetch" href="/ref-docs/assets/js/19.34a2894c.js"><link rel="prefetch" href="/ref-docs/assets/js/2.0ed70e06.js"><link rel="prefetch" href="/ref-docs/assets/js/20.d3364668.js"><link rel="prefetch" href="/ref-docs/assets/js/21.590f1e84.js"><link rel="prefetch" href="/ref-docs/assets/js/22.8b4d9b6a.js"><link rel="prefetch" href="/ref-docs/assets/js/23.b7251fdf.js"><link rel="prefetch" href="/ref-docs/assets/js/24.4019ba64.js"><link rel="prefetch" href="/ref-docs/assets/js/25.b812c921.js"><link rel="prefetch" href="/ref-docs/assets/js/26.f71d0604.js"><link rel="prefetch" href="/ref-docs/assets/js/27.a49462eb.js"><link rel="prefetch" href="/ref-docs/assets/js/28.f09067eb.js"><link rel="prefetch" href="/ref-docs/assets/js/29.c704f67a.js"><link rel="prefetch" href="/ref-docs/assets/js/3.d497bacb.js"><link rel="prefetch" href="/ref-docs/assets/js/30.cefbfe1a.js"><link rel="prefetch" href="/ref-docs/assets/js/32.2aaa336f.js"><link rel="prefetch" href="/ref-docs/assets/js/33.b94bf779.js"><link rel="prefetch" href="/ref-docs/assets/js/34.844b06c3.js"><link rel="prefetch" href="/ref-docs/assets/js/35.e134604b.js"><link rel="prefetch" href="/ref-docs/assets/js/4.4e40482d.js"><link rel="prefetch" href="/ref-docs/assets/js/5.bb5588c1.js"><link rel="prefetch" href="/ref-docs/assets/js/6.256c1ac0.js"><link rel="prefetch" href="/ref-docs/assets/js/7.0572abe7.js"><link rel="prefetch" href="/ref-docs/assets/js/8.8743b6e5.js"><link rel="prefetch" href="/ref-docs/assets/js/9.7c6a4748.js">
    <link rel="stylesheet" href="/ref-docs/assets/css/0.styles.33ab0e08.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="theme-container"><header class="navbar"><div class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/ref-docs/" class="home-link router-link-active"><!----> <span class="site-name">Master Reference</span></a> <div class="links" style="max-width:nullpx;"><div class="search-box"><input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div> <nav class="nav-links can-hide"><div class="nav-item"><a href="/ref-docs/" class="nav-link">Home</a></div><div class="nav-item"><a href="/ref-docs/docsDir/cloud/linux.html" class="nav-link">Linux</a></div><div class="nav-item"><a href="/ref-docs/docsDir/programming/python.html" class="nav-link router-link-exact-active router-link-active">Python</a></div><div class="nav-item"><a href="/ref-docs/docsDir/database/spark.html" class="nav-link">Spark</a></div> <a href="https://github.com/flarco/ref-docs" target="_blank" rel="noopener noreferrer" class="repo-link">
    GitHub
    <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></nav></div></header> <div class="sidebar-mask"></div> <div class="sidebar"><nav class="nav-links"><div class="nav-item"><a href="/ref-docs/" class="nav-link">Home</a></div><div class="nav-item"><a href="/ref-docs/docsDir/cloud/linux.html" class="nav-link">Linux</a></div><div class="nav-item"><a href="/ref-docs/docsDir/programming/python.html" class="nav-link router-link-exact-active router-link-active">Python</a></div><div class="nav-item"><a href="/ref-docs/docsDir/database/spark.html" class="nav-link">Spark</a></div> <a href="https://github.com/flarco/ref-docs" target="_blank" rel="noopener noreferrer" class="repo-link">
    GitHub
    <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></nav>  <ul class="sidebar-links"><li><a href="/ref-docs/" class="sidebar-link">ref-docs</a></li><li><div class="sidebar-group"><p class="sidebar-heading"><span>Cloud</span> <!----></p> <ul class="sidebar-group-items"><li><a href="/ref-docs/docsDir/cloud/amazon.html" class="sidebar-link">Amazon Web Services</a></li><li><a href="/ref-docs/docsDir/cloud/docker.html" class="sidebar-link">Docker</a></li><li><a href="/ref-docs/docsDir/cloud/git.html" class="sidebar-link">GIT</a></li><li><a href="/ref-docs/docsDir/cloud/linux.html" class="sidebar-link">Linux</a></li><li><a href="/ref-docs/docsDir/cloud/nginx.html" class="sidebar-link">NGinx</a></li></ul></div></li><li><div class="sidebar-group"><p class="sidebar-heading"><span>Database</span> <!----></p> <ul class="sidebar-group-items"><li><a href="/ref-docs/docsDir/database/elasticsearch.html" class="sidebar-link">ElasticSearch</a></li><li><a href="/ref-docs/docsDir/database/influxdb.html" class="sidebar-link">InfluxDB</a></li><li><a href="/ref-docs/docsDir/database/mysql.html" class="sidebar-link">MySQL</a></li><li><a href="/ref-docs/docsDir/database/oracle.html" class="sidebar-link">Oracle</a></li><li><a href="/ref-docs/docsDir/database/postgres.html" class="sidebar-link">PostgeSQL</a></li><li><a href="/ref-docs/docsDir/database/sas.html" class="sidebar-link">SAS</a></li><li><a href="/ref-docs/docsDir/database/spark.html" class="sidebar-link">Spark</a></li><li><a href="/ref-docs/docsDir/database/mongodb.html" class="sidebar-link">MongoDB</a></li></ul></div></li><li><div class="sidebar-group"><p class="sidebar-heading open"><span>Programming</span> <!----></p> <ul class="sidebar-group-items"><li><a href="/ref-docs/docsDir/programming/android.html" class="sidebar-link">Android</a></li><li><a href="/ref-docs/docsDir/programming/go.html" class="sidebar-link">GO</a></li><li><a href="/ref-docs/docsDir/programming/java.html" class="sidebar-link">Java</a></li><li><a href="/ref-docs/docsDir/programming/scala.html" class="sidebar-link">Scala</a></li><li><a href="/ref-docs/docsDir/programming/nodejs.html" class="sidebar-link">NodeJS</a></li><li><a href="/ref-docs/docsDir/programming/javascript.html" class="sidebar-link">JavaScript</a></li><li><a href="/ref-docs/docsDir/programming/powershell.html" class="sidebar-link">PowerShell</a></li><li><a href="/ref-docs/docsDir/programming/python-database.html" class="sidebar-link">Python | Database</a></li><li><a href="/ref-docs/docsDir/programming/python-jupyter.html" class="sidebar-link">Python | Jupyter</a></li><li><a href="/ref-docs/docsDir/programming/python-links.html" class="sidebar-link">Python Links</a></li><li><a href="/ref-docs/docsDir/programming/python.html" class="active sidebar-link">Python</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/ref-docs/docsDir/programming/python.html#classes" class="sidebar-link">Classes</a></li><li class="sidebar-sub-header"><a href="/ref-docs/docsDir/programming/python.html#data-types" class="sidebar-link">Data Types</a></li><li class="sidebar-sub-header"><a href="/ref-docs/docsDir/programming/python.html#collections" class="sidebar-link">Collections</a></li><li class="sidebar-sub-header"><a href="/ref-docs/docsDir/programming/python.html#path" class="sidebar-link">Path</a></li><li class="sidebar-sub-header"><a href="/ref-docs/docsDir/programming/python.html#date" class="sidebar-link">Date</a></li><li class="sidebar-sub-header"><a href="/ref-docs/docsDir/programming/python.html#file-read-write" class="sidebar-link">File Read/Write</a></li><li class="sidebar-sub-header"><a href="/ref-docs/docsDir/programming/python.html#random" class="sidebar-link">Random</a></li><li class="sidebar-sub-header"><a href="/ref-docs/docsDir/programming/python.html#for-loop" class="sidebar-link">FOR Loop</a></li><li class="sidebar-sub-header"><a href="/ref-docs/docsDir/programming/python.html#database" class="sidebar-link">Database</a></li><li class="sidebar-sub-header"><a href="/ref-docs/docsDir/programming/python.html#system" class="sidebar-link">System</a></li><li class="sidebar-sub-header"><a href="/ref-docs/docsDir/programming/python.html#web-json" class="sidebar-link">Web / JSON</a></li><li class="sidebar-sub-header"><a href="/ref-docs/docsDir/programming/python.html#other" class="sidebar-link">Other</a></li><li class="sidebar-sub-header"><a href="/ref-docs/docsDir/programming/python.html#flask" class="sidebar-link">Flask</a></li><li class="sidebar-sub-header"><a href="/ref-docs/docsDir/programming/python.html#jython" class="sidebar-link">Jython</a></li><li class="sidebar-sub-header"><a href="/ref-docs/docsDir/programming/python.html#scrapy" class="sidebar-link">Scrapy</a></li><li class="sidebar-sub-header"><a href="/ref-docs/docsDir/programming/python.html#installing-with-custom-rpm-library" class="sidebar-link">Installing with custom RPM library</a></li><li class="sidebar-sub-header"><a href="/ref-docs/docsDir/programming/python.html#installing-from-script" class="sidebar-link">Installing from script</a></li><li class="sidebar-sub-header"><a href="/ref-docs/docsDir/programming/python.html#install-local-package" class="sidebar-link">Install Local Package</a></li></ul></li><li><a href="/ref-docs/docsDir/programming/ruby.html" class="sidebar-link">Ruby</a></li></ul></div></li><li><div class="sidebar-group"><p class="sidebar-heading"><span>ETL</span> <!----></p> <ul class="sidebar-group-items"><li><a href="/ref-docs/docsDir/etl/informatica.html" class="sidebar-link">Informatica</a></li><li><a href="/ref-docs/docsDir/etl/ssis.html" class="sidebar-link">SSIS</a></li><li><a href="/ref-docs/docsDir/etl/talend.html" class="sidebar-link">Talend</a></li></ul></div></li></ul> </div> <div class="page"> <div class="content"><h1 id="python"><a href="#python" aria-hidden="true" class="header-anchor">#</a> Python</h1> <hr> <h2 id="classes"><a href="#classes" aria-hidden="true" class="header-anchor">#</a> Classes</h2> <div class="language-python extra-class"><pre class="language-python"><code><span class="token keyword">class</span> <span class="token class-name">c1</span><span class="token punctuation">:</span>
   <span class="token comment"># class attrbitues are defaults for object attributes</span>
  att1 <span class="token operator">=</span> <span class="token string">'Nada'</span>
  att3 <span class="token operator">=</span> <span class="token string">'Beauty'</span>

  <span class="token keyword">def</span> <span class="token function">__init__</span><span class="token punctuation">(</span>self<span class="token punctuation">)</span><span class="token punctuation">:</span>
    c1<span class="token punctuation">.</span>att2 <span class="token operator">=</span> <span class="token number">22</span>  <span class="token comment"># class attribute</span>
    self<span class="token punctuation">.</span>att2 <span class="token operator">=</span> <span class="token number">22</span>  <span class="token comment"># object attribute overwriten</span>

  <span class="token keyword">def</span> <span class="token function">m1</span><span class="token punctuation">(</span>self<span class="token punctuation">)</span><span class="token punctuation">:</span>
    c1<span class="token punctuation">.</span>att1 <span class="token operator">=</span> <span class="token string">&quot;hey&quot;</span>  <span class="token comment"># class attribute</span>
    <span class="token keyword">print</span> self<span class="token punctuation">.</span>att1  <span class="token comment"># object attrbute</span>
    self<span class="token punctuation">.</span>att1 <span class="token operator">=</span> <span class="token string">'heyhey!'</span>

  <span class="token decorator annotation punctuation">@classmethod</span>
  <span class="token keyword">def</span> <span class="token function">cm2</span><span class="token punctuation">(</span>klass<span class="token punctuation">,</span> str0<span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token keyword">print</span> str0
    <span class="token keyword">print</span> klass<span class="token punctuation">.</span>att1
    <span class="token keyword">print</span> c1<span class="token punctuation">.</span>att3
    <span class="token keyword">print</span> c1<span class="token operator">==</span>klass

  @<span class="token builtin">staticmethod</span>
  <span class="token keyword">def</span> <span class="token function">sm3</span><span class="token punctuation">(</span>str0<span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token keyword">print</span> str0
</code></pre></div><h3 id="static-method"><a href="#static-method" aria-hidden="true" class="header-anchor">#</a> Static Method</h3> <p>Can be used/ran without instantiating the class into an object. Static methods have no access to class attributes.</p> <div class="language-python extra-class"><pre class="language-python"><code><span class="token comment"># running static method, without object, and without having access to class attributes</span>
c1<span class="token punctuation">.</span>sm3<span class="token punctuation">(</span><span class="token string">'yoyoyo'</span><span class="token punctuation">)</span>
</code></pre></div><h3 id="class-method"><a href="#class-method" aria-hidden="true" class="header-anchor">#</a> Class Method</h3> <p>Can be used/ran without instantiating the class into an object. Class methods do have access to class attributes.</p> <div class="language-python extra-class"><pre class="language-python"><code><span class="token comment"># running class method, without object, and having access to class attributes</span>
c1<span class="token punctuation">.</span>cm2<span class="token punctuation">(</span><span class="token string">'heelo'</span><span class="token punctuation">)</span>
</code></pre></div><h3 id="licenses"><a href="#licenses" aria-hidden="true" class="header-anchor">#</a> Licenses</h3> <div class="language-python extra-class"><pre class="language-python"><code><span class="token keyword">import</span> pkg_resources
<span class="token keyword">import</span> prettytable

<span class="token keyword">def</span> <span class="token function">get_pkg_license</span><span class="token punctuation">(</span>pkg<span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token keyword">try</span><span class="token punctuation">:</span>
        lines <span class="token operator">=</span> pkg<span class="token punctuation">.</span>get_metadata_lines<span class="token punctuation">(</span><span class="token string">'METADATA'</span><span class="token punctuation">)</span>
    <span class="token keyword">except</span><span class="token punctuation">:</span>
        lines <span class="token operator">=</span> pkg<span class="token punctuation">.</span>get_metadata_lines<span class="token punctuation">(</span><span class="token string">'PKG-INFO'</span><span class="token punctuation">)</span>

    <span class="token keyword">for</span> line <span class="token keyword">in</span> lines<span class="token punctuation">:</span>
        <span class="token keyword">if</span> line<span class="token punctuation">.</span>startswith<span class="token punctuation">(</span><span class="token string">'License:'</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
            <span class="token keyword">return</span> line<span class="token punctuation">[</span><span class="token number">9</span><span class="token punctuation">:</span><span class="token punctuation">]</span>
    <span class="token keyword">return</span> <span class="token string">'(Licence not found)'</span>

<span class="token keyword">def</span> <span class="token function">print_packages_and_licenses</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
    t <span class="token operator">=</span> prettytable<span class="token punctuation">.</span>PrettyTable<span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token string">'Package'</span><span class="token punctuation">,</span> <span class="token string">'License'</span><span class="token punctuation">]</span><span class="token punctuation">)</span>
    <span class="token keyword">for</span> pkg <span class="token keyword">in</span> <span class="token builtin">sorted</span><span class="token punctuation">(</span>pkg_resources<span class="token punctuation">.</span>working_set<span class="token punctuation">,</span> key<span class="token operator">=</span><span class="token keyword">lambda</span> x<span class="token punctuation">:</span> <span class="token builtin">str</span><span class="token punctuation">(</span>x<span class="token punctuation">)</span><span class="token punctuation">.</span>lower<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
        t<span class="token punctuation">.</span>add_row<span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token builtin">str</span><span class="token punctuation">(</span>pkg<span class="token punctuation">)</span><span class="token punctuation">,</span> get_pkg_license<span class="token punctuation">(</span>pkg<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
    <span class="token keyword">print</span><span class="token punctuation">(</span>t<span class="token punctuation">)</span>


<span class="token keyword">if</span> __name__ <span class="token operator">==</span> <span class="token string">&quot;__main__&quot;</span><span class="token punctuation">:</span>
    print_packages_and_licenses<span class="token punctuation">(</span><span class="token punctuation">)</span>
</code></pre></div><h3 id="simple-method"><a href="#simple-method" aria-hidden="true" class="header-anchor">#</a> Simple Method</h3> <p>Can be used/ran after instantiating the class into an object. Simple methods have access to class attributes and object attributes</p> <div class="language-python extra-class"><pre class="language-python"><code>O1 <span class="token operator">=</span> c1<span class="token punctuation">(</span><span class="token punctuation">)</span>
o1<span class="token punctuation">.</span>m1<span class="token punctuation">(</span><span class="token punctuation">)</span>
</code></pre></div><h2 id="data-types"><a href="#data-types" aria-hidden="true" class="header-anchor">#</a> Data Types</h2> <h3 id="string-number"><a href="#string-number" aria-hidden="true" class="header-anchor">#</a> String &amp; Number</h3> <p><strong>Zero Pad Number:</strong></p> <div class="language-python extra-class"><pre class="language-python"><code><span class="token operator">&gt;&gt;</span><span class="token operator">&gt;</span> <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token builtin">format</span><span class="token punctuation">(</span><span class="token number">5</span><span class="token punctuation">,</span> <span class="token string">&quot;05d&quot;</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
<span class="token number">00005</span>
<span class="token operator">&gt;&gt;</span><span class="token operator">&gt;</span> <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token builtin">format</span><span class="token punctuation">(</span><span class="token number">5</span><span class="token punctuation">,</span> <span class="token string">&quot;02d&quot;</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
<span class="token number">05</span>
</code></pre></div><p><strong>Encode to ASCII</strong></p> <div class="language-python extra-class"><pre class="language-python"><code>File<span class="token punctuation">.</span>write<span class="token punctuation">(</span><span class="token builtin">unicode</span>\_str<span class="token punctuation">.</span>encode<span class="token punctuation">(</span><span class="token string">'ascii'</span><span class="token punctuation">,</span> <span class="token string">'ignore'</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
</code></pre></div><p><strong>Decimal print:</strong></p> <div class="language-python extra-class"><pre class="language-python"><code><span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">'{:,.2f}'</span><span class="token punctuation">.</span><span class="token builtin">format</span><span class="token punctuation">(</span>s\<span class="token punctuation">[</span><span class="token string">'DL\_Sum'</span>\<span class="token punctuation">]</span> <span class="token punctuation">)</span><span class="token punctuation">)</span>

<span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">'${:,.2f}'</span><span class="token punctuation">.</span><span class="token builtin">format</span><span class="token punctuation">(</span>salary<span class="token punctuation">)</span> <span class="token comment">## currency</span>
</code></pre></div><p><strong>Comma / Thousands Separator</strong></p> <div class="language-python extra-class"><pre class="language-python"><code><span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">&quot;{:,d}&quot;</span><span class="token punctuation">.</span><span class="token builtin">format</span><span class="token punctuation">(</span><span class="token number">12456789</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
</code></pre></div><p><strong>Print in Grid:</strong></p> <div class="language-python extra-class"><pre class="language-python"><code><span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">'{0:&amp;lt;10}'</span><span class="token punctuation">.</span><span class="token builtin">format</span><span class="token punctuation">(</span><span class="token builtin">str</span><span class="token punctuation">(</span>stats\<span class="token punctuation">[</span>s\<span class="token punctuation">]</span>\<span class="token punctuation">[</span>h\<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
</code></pre></div><h3 id="regex"><a href="#regex" aria-hidden="true" class="header-anchor">#</a> Regex</h3> <p><strong>All Matches:</strong></p> <div class="language-python extra-class"><pre class="language-python"><code>m_arr <span class="token operator">=</span> re<span class="token punctuation">.</span>findall<span class="token punctuation">(</span><span class="token string">r'[ ]*SET *[\w =,\n()]*WHERE'</span><span class="token punctuation">,</span> string1<span class="token punctuation">)</span>
</code></pre></div><p><strong>Replace all matches:</strong></p> <div class="language-python extra-class"><pre class="language-python"><code>obj_sql2 <span class="token operator">=</span> re<span class="token punctuation">.</span>sub<span class="token punctuation">(</span><span class="token string">r&quot;,[\n ]+(?i)&quot;</span> <span class="token operator">+</span> combo_name <span class="token operator">+</span> <span class="token string">r&quot;[ \r*\n]+&quot;</span><span class="token punctuation">,</span>  combo_name <span class="token punctuation">,</span> string_sql2<span class="token punctuation">)</span>
</code></pre></div><p><strong>Matches Excluding Suffix/Prefix:</strong></p> <div class="language-python extra-class"><pre class="language-python"><code><span class="token string">r&quot;(?&lt;=Pay: )[- \w$\d]+&quot;</span>
<span class="token string">r&quot;(?&lt;=Rate )[ \w$]+?(?= Job Type)&quot;</span>
</code></pre></div><p><strong>Replace non-numeric</strong></p> <div class="language-python extra-class"><pre class="language-python"><code>result <span class="token operator">=</span> re<span class="token punctuation">.</span>sub<span class="token punctuation">(</span><span class="token string">'[^0-9]'</span><span class="token punctuation">,</span><span class="token string">''</span><span class="token punctuation">,</span> <span class="token string">'af7878787ad'</span><span class="token punctuation">)</span>
</code></pre></div><p><strong>Filter out entries</strong>*</p> <div class="language-python extra-class"><pre class="language-python"><code>regexp <span class="token operator">=</span> re<span class="token punctuation">.</span><span class="token builtin">compile</span><span class="token punctuation">(</span><span class="token string">r&quot;[- ,;{}()\n\t=\/:.]&quot;</span><span class="token punctuation">)</span>
fields <span class="token operator">=</span> <span class="token builtin">filter</span><span class="token punctuation">(</span><span class="token keyword">lambda</span> field<span class="token punctuation">:</span> <span class="token keyword">not</span> regexp<span class="token punctuation">.</span>search<span class="token punctuation">(</span>field<span class="token punctuation">)</span><span class="token punctuation">,</span> fields<span class="token punctuation">)</span>
</code></pre></div><p><strong>Constains one char math</strong></p> <div class="language-python extra-class"><pre class="language-python"><code><span class="token keyword">import</span> re
word <span class="token operator">=</span> <span class="token string">'fubar'</span>
regexp <span class="token operator">=</span> re<span class="token punctuation">.</span><span class="token builtin">compile</span><span class="token punctuation">(</span><span class="token string">r'[rzd]'</span><span class="token punctuation">)</span> <span class="token comment"># matches r, z or d</span>
<span class="token keyword">if</span> regexp<span class="token punctuation">.</span>search<span class="token punctuation">(</span>word<span class="token punctuation">)</span><span class="token punctuation">:</span>
  <span class="token keyword">print</span> <span class="token string">'matched'</span>
</code></pre></div><p><strong>Extract Substring</strong></p> <div class="language-python extra-class"><pre class="language-python"><code><span class="token keyword">import</span> re

sql_lines <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token string">'create table  schema1.table1  stored as parquet as'</span><span class="token punctuation">]</span>

regexp <span class="token operator">=</span> <span class="token string">r'create\s+table\s+(\S*)[\sa-zA-Z\d]+ as'</span>

table <span class="token operator">=</span> re<span class="token punctuation">.</span>findall<span class="token punctuation">(</span>regexp<span class="token punctuation">,</span> sql_lines<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span>
</code></pre></div><h3 id="yaml"><a href="#yaml" aria-hidden="true" class="header-anchor">#</a> YAML</h3> <div class="language-python extra-class"><pre class="language-python"><code><span class="token keyword">import</span> yaml

<span class="token keyword">def</span> <span class="token function">parse_yaml</span><span class="token punctuation">(</span>file_path<span class="token punctuation">)</span><span class="token punctuation">:</span>
  <span class="token keyword">with</span> <span class="token builtin">open</span><span class="token punctuation">(</span>file_path<span class="token punctuation">,</span> <span class="token string">'r'</span><span class="token punctuation">)</span> <span class="token keyword">as</span> stream<span class="token punctuation">:</span>
    data <span class="token operator">=</span> yaml<span class="token punctuation">.</span>load<span class="token punctuation">(</span>stream<span class="token punctuation">)</span>
    <span class="token keyword">return</span> <span class="token builtin">dict</span><span class="token punctuation">(</span>data<span class="token punctuation">)</span>

data <span class="token operator">=</span> parse_yaml<span class="token punctuation">(</span><span class="token string">r'C:\path\file.yml'</span><span class="token punctuation">)</span>

<span class="token keyword">with</span> <span class="token builtin">open</span><span class="token punctuation">(</span><span class="token string">r'C:\path\file2.yml'</span><span class="token punctuation">,</span> <span class="token string">'w'</span><span class="token punctuation">)</span> <span class="token keyword">as</span> outfile<span class="token punctuation">:</span>
    yaml<span class="token punctuation">.</span>dump<span class="token punctuation">(</span>data<span class="token punctuation">,</span> outfile<span class="token punctuation">,</span> default_flow_style<span class="token operator">=</span><span class="token boolean">False</span><span class="token punctuation">)</span>
</code></pre></div><h3 id="json"><a href="#json" aria-hidden="true" class="header-anchor">#</a> JSON</h3> <p><strong>STDin JSON Tool</strong></p> <div class="language- extra-class"><pre class="language-text"><code>curl http://localhost:3000/stats | python -m &quot;json.tool&quot;
</code></pre></div><p><strong>Dict to JSON String</strong></p> <div class="language-python extra-class"><pre class="language-python"><code><span class="token keyword">import</span> json

<span class="token keyword">print</span><span class="token punctuation">(</span>json<span class="token punctuation">.</span>dumps<span class="token punctuation">(</span>data_dict<span class="token punctuation">)</span><span class="token punctuation">)</span>
</code></pre></div><p><strong>JSON String to Dict</strong></p> <div class="language-python extra-class"><pre class="language-python"><code><span class="token keyword">import</span> json
<span class="token keyword">print</span><span class="token punctuation">(</span>json<span class="token punctuation">.</span>loads<span class="token punctuation">(</span>json_str<span class="token punctuation">)</span><span class="token punctuation">)</span>
</code></pre></div><p><strong>Good Library: jmespath</strong></p> <div class="language- extra-class"><pre class="language-text"><code>pip install jmespath
</code></pre></div><p><a href="https://jmespath.readthedocs.io/en/latest/specification.html#index-expressions" target="_blank" rel="noopener noreferrer">https://jmespath.readthedocs.io/en/latest/specification.html#index-expressions<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a> <a href="https://pypi.python.org/pypi/jmespath" target="_blank" rel="noopener noreferrer">https://pypi.python.org/pypi/jmespath<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></p> <div class="language-python extra-class"><pre class="language-python"><code>data <span class="token operator">=</span> <span class="token punctuation">{</span><span class="token punctuation">}</span>
jmespath<span class="token punctuation">.</span>search<span class="token punctuation">(</span><span class="token string">'result.periods'</span><span class="token punctuation">,</span> data<span class="token punctuation">)</span>
jmespath<span class="token punctuation">.</span>search<span class="token punctuation">(</span><span class="token string">'result.opening_hours.periods[0]'</span><span class="token punctuation">,</span> data<span class="token punctuation">)</span>
jmespath<span class="token punctuation">.</span>search<span class="token punctuation">(</span><span class="token string">'result.opening_hours.periods[0].close'</span><span class="token punctuation">,</span> data<span class="token punctuation">)</span>
jmespath<span class="token punctuation">.</span>search<span class="token punctuation">(</span><span class="token string">'result.opening_hours.periods[*].close.time'</span><span class="token punctuation">,</span> data<span class="token punctuation">)</span>
</code></pre></div><h4 id="get-unique-nested-keys"><a href="#get-unique-nested-keys" aria-hidden="true" class="header-anchor">#</a> Get Unique nested keys</h4> <div class="language-python extra-class"><pre class="language-python"><code>all_paths <span class="token operator">=</span> <span class="token punctuation">{</span><span class="token punctuation">}</span>
<span class="token keyword">def</span> <span class="token function">get_unique_keys</span><span class="token punctuation">(</span>data<span class="token punctuation">,</span> parent_path<span class="token operator">=</span><span class="token string">''</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
  <span class="token keyword">if</span> <span class="token builtin">isinstance</span><span class="token punctuation">(</span>data<span class="token punctuation">,</span> <span class="token builtin">dict</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token keyword">for</span> key<span class="token punctuation">,</span> data2 <span class="token keyword">in</span> data<span class="token punctuation">.</span>items<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
      get_unique_keys<span class="token punctuation">(</span>data2<span class="token punctuation">,</span> key <span class="token keyword">if</span> parent_path <span class="token operator">==</span> <span class="token string">''</span> <span class="token keyword">else</span> parent_path <span class="token operator">+</span> <span class="token string">'.'</span> <span class="token operator">+</span> key<span class="token punctuation">)</span>
  <span class="token keyword">elif</span> <span class="token builtin">isinstance</span><span class="token punctuation">(</span>data<span class="token punctuation">,</span> <span class="token builtin">list</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token keyword">for</span> data2 <span class="token keyword">in</span> data<span class="token punctuation">:</span>
      get_unique_keys<span class="token punctuation">(</span>data2<span class="token punctuation">,</span> parent_path <span class="token operator">+</span> <span class="token string">'[*]'</span><span class="token punctuation">)</span>
  <span class="token keyword">else</span><span class="token punctuation">:</span>
    all_paths<span class="token punctuation">[</span>parent_path<span class="token punctuation">]</span> <span class="token operator">=</span> all_paths<span class="token punctuation">.</span>get<span class="token punctuation">(</span>parent_path<span class="token punctuation">,</span><span class="token number">0</span><span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token number">1</span>

get_unique_keys<span class="token punctuation">(</span>data_dict<span class="token punctuation">)</span>
<span class="token keyword">for</span> path <span class="token keyword">in</span> <span class="token builtin">sorted</span><span class="token punctuation">(</span>all_paths<span class="token punctuation">)</span><span class="token punctuation">:</span>
  <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">'{} --&gt; {}'</span><span class="token punctuation">.</span><span class="token builtin">format</span><span class="token punctuation">(</span>path<span class="token punctuation">,</span> all_paths<span class="token punctuation">[</span>path<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
</code></pre></div><h3 id="counter"><a href="#counter" aria-hidden="true" class="header-anchor">#</a> Counter</h3> <p><strong>Get unique values and occurence</strong></p> <div class="language-python extra-class"><pre class="language-python"><code><span class="token keyword">for</span> combo<span class="token punctuation">,</span> field_count <span class="token keyword">in</span> Counter<span class="token punctuation">(</span><span class="token punctuation">[</span>row<span class="token punctuation">.</span>combo1 <span class="token keyword">for</span> row <span class="token keyword">in</span> data_columns<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">.</span>items<span class="token punctuation">(</span><span class="token punctuation">)</span>
</code></pre></div><h3 id="dictionary"><a href="#dictionary" aria-hidden="true" class="header-anchor">#</a> Dictionary</h3> <div class="language-python extra-class"><pre class="language-python"><code>Headers <span class="token operator">=</span> <span class="token punctuation">{</span><span class="token punctuation">}</span>
headers <span class="token operator">=</span> <span class="token punctuation">{</span>
  <span class="token string">'Content-type'</span><span class="token punctuation">:</span> <span class="token string">'application/json'</span>
<span class="token punctuation">}</span>
</code></pre></div><div class="language-python extra-class"><pre class="language-python"><code><span class="token keyword">for</span> key<span class="token punctuation">,</span> value <span class="token keyword">in</span> headers<span class="token punctuation">.</span>iteritems<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
   <span class="token keyword">print</span><span class="token punctuation">(</span>key <span class="token operator">+</span> <span class="token string">' '</span> <span class="token operator">+</span> values<span class="token punctuation">)</span>
</code></pre></div><p><strong>Delete:</strong></p> <div class="language-python extra-class"><pre class="language-python"><code><span class="token keyword">del</span> <span class="token builtin">dict</span><span class="token punctuation">[</span>key<span class="token punctuation">]</span>
</code></pre></div><p><strong>Sorted by key:</strong></p> <div class="language-python extra-class"><pre class="language-python"><code>top_repo <span class="token operator">=</span> <span class="token builtin">sorted</span><span class="token punctuation">(</span>all_repos<span class="token punctuation">,</span> key<span class="token operator">=</span><span class="token keyword">lambda</span> x<span class="token punctuation">:</span> x<span class="token punctuation">[</span><span class="token string">'stargazers_count'</span><span class="token punctuation">]</span><span class="token punctuation">,</span> reverse<span class="token operator">=</span><span class="token boolean">True</span><span class="token punctuation">)</span><span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span>
</code></pre></div><p><strong>Sorted by Value:</strong></p> <div class="language-python extra-class"><pre class="language-python"><code><span class="token keyword">for</span> key <span class="token keyword">in</span> <span class="token builtin">sorted</span><span class="token punctuation">(</span>dict1<span class="token punctuation">,</span> key<span class="token operator">=</span>dict1<span class="token punctuation">.</span>get<span class="token punctuation">)</span>
</code></pre></div><p><strong>Merge:</strong></p> <div class="language-python extra-class"><pre class="language-python"><code>new_dict <span class="token operator">=</span> <span class="token builtin">dict</span><span class="token punctuation">(</span>x<span class="token punctuation">.</span>items<span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">+</span> y<span class="token punctuation">.</span>items<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
new_dict <span class="token operator">=</span> <span class="token builtin">dict</span><span class="token punctuation">(</span>x<span class="token punctuation">,</span> <span class="token operator">**</span>y<span class="token punctuation">)</span>
</code></pre></div><p><strong>Build from list:</strong></p> <p><a href="http://stackoverflow.com/questions/209840/map-two-lists-into-a-dictionary-in-python" target="_blank" rel="noopener noreferrer">http://stackoverflow.com/questions/209840/map-two-lists-into-a-dictionary-in-python<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></p> <div class="language-python extra-class"><pre class="language-python"><code><span class="token keyword">import</span> itertools
file_lines <span class="token operator">=</span> read_from_file<span class="token punctuation">(</span>file_path<span class="token punctuation">)</span><span class="token punctuation">.</span>splitlines<span class="token punctuation">(</span><span class="token punctuation">)</span>
file_lines<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span> <span class="token operator">=</span> deli<span class="token punctuation">.</span>join<span class="token punctuation">(</span><span class="token punctuation">[</span>f<span class="token punctuation">.</span>lower<span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token keyword">for</span> f <span class="token keyword">in</span> file_lines<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">.</span>split<span class="token punctuation">(</span>deli<span class="token punctuation">)</span><span class="token punctuation">]</span><span class="token punctuation">)</span>
result_data <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token builtin">dict</span><span class="token punctuation">(</span>itertools<span class="token punctuation">.</span>izip<span class="token punctuation">(</span>file_lines<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">.</span>split<span class="token punctuation">(</span>deli<span class="token punctuation">)</span><span class="token punctuation">,</span> line<span class="token punctuation">.</span>split<span class="token punctuation">(</span>deli<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token keyword">for</span> line <span class="token keyword">in</span> file_lines<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">:</span><span class="token punctuation">]</span><span class="token punctuation">]</span>

keys <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token string">'name'</span><span class="token punctuation">,</span> <span class="token string">'age'</span><span class="token punctuation">,</span> <span class="token string">'food'</span><span class="token punctuation">)</span>
values <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token string">'Monty'</span><span class="token punctuation">,</span> <span class="token number">42</span><span class="token punctuation">,</span> <span class="token string">'spam'</span><span class="token punctuation">)</span>
<span class="token builtin">dict</span><span class="token punctuation">(</span><span class="token builtin">zip</span><span class="token punctuation">(</span>keys<span class="token punctuation">,</span> values<span class="token punctuation">)</span><span class="token punctuation">)</span>
<span class="token punctuation">{</span><span class="token string">'food'</span><span class="token punctuation">:</span> <span class="token string">'spam'</span><span class="token punctuation">,</span> <span class="token string">'age'</span><span class="token punctuation">:</span> <span class="token number">42</span><span class="token punctuation">,</span> <span class="token string">'name'</span><span class="token punctuation">:</span> <span class="token string">'Monty'</span><span class="token punctuation">}</span>
</code></pre></div><h4 id="jmespath-search"><a href="#jmespath-search" aria-hidden="true" class="header-anchor">#</a> JMESpath Search</h4> <div class="language-python extra-class"><pre class="language-python"><code>In <span class="token punctuation">[</span><span class="token number">218</span><span class="token punctuation">]</span><span class="token punctuation">:</span> d <span class="token operator">=</span> <span class="token builtin">dict</span><span class="token punctuation">(</span>a<span class="token operator">=</span><span class="token builtin">dict</span><span class="token punctuation">(</span>b<span class="token operator">=</span><span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token number">2</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">,</span> c<span class="token operator">=</span><span class="token punctuation">[</span><span class="token builtin">dict</span><span class="token punctuation">(</span>d<span class="token operator">=</span><span class="token number">3</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token builtin">dict</span><span class="token punctuation">(</span>d<span class="token operator">=</span><span class="token number">3</span><span class="token punctuation">)</span><span class="token punctuation">]</span><span class="token punctuation">)</span>

In <span class="token punctuation">[</span><span class="token number">219</span><span class="token punctuation">]</span><span class="token punctuation">:</span> d
Out<span class="token punctuation">[</span><span class="token number">219</span><span class="token punctuation">]</span><span class="token punctuation">:</span> <span class="token punctuation">{</span><span class="token string">'a'</span><span class="token punctuation">:</span> <span class="token punctuation">{</span><span class="token string">'b'</span><span class="token punctuation">:</span> <span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">]</span><span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token string">'c'</span><span class="token punctuation">:</span> <span class="token punctuation">[</span><span class="token punctuation">{</span><span class="token string">'d'</span><span class="token punctuation">:</span> <span class="token number">3</span><span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token punctuation">{</span><span class="token string">'d'</span><span class="token punctuation">:</span> <span class="token number">3</span><span class="token punctuation">}</span><span class="token punctuation">]</span><span class="token punctuation">}</span>

In <span class="token punctuation">[</span><span class="token number">220</span><span class="token punctuation">]</span><span class="token punctuation">:</span>  jmespath<span class="token punctuation">.</span>search<span class="token punctuation">(</span><span class="token string">'PolicyTransactionMessage.PolicyTransaction.Details'</span><span class="token punctuation">,</span> d<span class="token punctuation">)</span>

In <span class="token punctuation">[</span><span class="token number">221</span><span class="token punctuation">]</span><span class="token punctuation">:</span>  jmespath<span class="token punctuation">.</span>search<span class="token punctuation">(</span><span class="token string">'a'</span><span class="token punctuation">,</span> d<span class="token punctuation">)</span>
Out<span class="token punctuation">[</span><span class="token number">221</span><span class="token punctuation">]</span><span class="token punctuation">:</span> <span class="token punctuation">{</span><span class="token string">'b'</span><span class="token punctuation">:</span> <span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">]</span><span class="token punctuation">}</span>

In <span class="token punctuation">[</span><span class="token number">222</span><span class="token punctuation">]</span><span class="token punctuation">:</span>  jmespath<span class="token punctuation">.</span>search<span class="token punctuation">(</span><span class="token string">'a.b'</span><span class="token punctuation">,</span> d<span class="token punctuation">)</span>
Out<span class="token punctuation">[</span><span class="token number">222</span><span class="token punctuation">]</span><span class="token punctuation">:</span> <span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">]</span>

In <span class="token punctuation">[</span><span class="token number">223</span><span class="token punctuation">]</span><span class="token punctuation">:</span>  jmespath<span class="token punctuation">.</span>search<span class="token punctuation">(</span><span class="token string">'a'</span><span class="token punctuation">,</span> d<span class="token punctuation">)</span>
Out<span class="token punctuation">[</span><span class="token number">223</span><span class="token punctuation">]</span><span class="token punctuation">:</span> <span class="token punctuation">{</span><span class="token string">'b'</span><span class="token punctuation">:</span> <span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">]</span><span class="token punctuation">}</span>

In <span class="token punctuation">[</span><span class="token number">224</span><span class="token punctuation">]</span><span class="token punctuation">:</span>  jmespath<span class="token punctuation">.</span>search<span class="token punctuation">(</span><span class="token string">'c'</span><span class="token punctuation">,</span> d<span class="token punctuation">)</span>
Out<span class="token punctuation">[</span><span class="token number">224</span><span class="token punctuation">]</span><span class="token punctuation">:</span> <span class="token punctuation">[</span><span class="token punctuation">{</span><span class="token string">'d'</span><span class="token punctuation">:</span> <span class="token number">3</span><span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token punctuation">{</span><span class="token string">'d'</span><span class="token punctuation">:</span> <span class="token number">3</span><span class="token punctuation">}</span><span class="token punctuation">]</span>

In <span class="token punctuation">[</span><span class="token number">225</span><span class="token punctuation">]</span><span class="token punctuation">:</span>  jmespath<span class="token punctuation">.</span>search<span class="token punctuation">(</span><span class="token string">'c[0]'</span><span class="token punctuation">,</span> d<span class="token punctuation">)</span>
Out<span class="token punctuation">[</span><span class="token number">225</span><span class="token punctuation">]</span><span class="token punctuation">:</span> <span class="token punctuation">{</span><span class="token string">'d'</span><span class="token punctuation">:</span> <span class="token number">3</span><span class="token punctuation">}</span>

In <span class="token punctuation">[</span><span class="token number">226</span><span class="token punctuation">]</span><span class="token punctuation">:</span>  jmespath<span class="token punctuation">.</span>search<span class="token punctuation">(</span><span class="token string">'c[*]'</span><span class="token punctuation">,</span> d<span class="token punctuation">)</span>
Out<span class="token punctuation">[</span><span class="token number">226</span><span class="token punctuation">]</span><span class="token punctuation">:</span> <span class="token punctuation">[</span><span class="token punctuation">{</span><span class="token string">'d'</span><span class="token punctuation">:</span> <span class="token number">3</span><span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token punctuation">{</span><span class="token string">'d'</span><span class="token punctuation">:</span> <span class="token number">3</span><span class="token punctuation">}</span><span class="token punctuation">]</span>

In <span class="token punctuation">[</span><span class="token number">227</span><span class="token punctuation">]</span><span class="token punctuation">:</span>  jmespath<span class="token punctuation">.</span>search<span class="token punctuation">(</span><span class="token string">'a.*'</span><span class="token punctuation">,</span> d<span class="token punctuation">)</span>
Out<span class="token punctuation">[</span><span class="token number">227</span><span class="token punctuation">]</span><span class="token punctuation">:</span> <span class="token punctuation">[</span><span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">]</span><span class="token punctuation">]</span>
</code></pre></div><div class="language-python extra-class"><pre class="language-python"><code><span class="token keyword">class</span> <span class="token class-name">DictTree</span><span class="token punctuation">:</span>
  <span class="token keyword">def</span> <span class="token function">__init__</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> data<span class="token punctuation">,</span> header_only<span class="token operator">=</span><span class="token boolean">False</span><span class="token punctuation">,</span> name_processor<span class="token operator">=</span><span class="token boolean">None</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
    self<span class="token punctuation">.</span>data <span class="token operator">=</span> data
    self<span class="token punctuation">.</span>name_processor <span class="token operator">=</span> name_processor
    self<span class="token punctuation">.</span>get_keys_path<span class="token punctuation">(</span>header_only<span class="token operator">=</span>header_only<span class="token punctuation">)</span>
    self<span class="token punctuation">.</span>TRow <span class="token operator">=</span> namedtuple<span class="token punctuation">(</span><span class="token string">'TRow'</span><span class="token punctuation">,</span> <span class="token string">'title action field_name field_type depth_level field_path is_null is_list len'</span><span class="token punctuation">)</span>

  <span class="token keyword">def</span> <span class="token function">get_keys_path</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> header_only<span class="token operator">=</span><span class="token boolean">False</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token string">&quot;Traverses nested dictionary and returns depth level and corresponding JMESPath search string&quot;</span>
    <span class="token comment"># http://jmespath.org/specification.html#examples</span>
    <span class="token comment"># https://github.com/jmespath/jmespath.py</span>
    <span class="token keyword">from</span> pyspark<span class="token punctuation">.</span>sql <span class="token keyword">import</span> Row
    fields_parent <span class="token operator">=</span> OrderedDict<span class="token punctuation">(</span><span class="token punctuation">)</span>
    DP <span class="token operator">=</span> namedtuple<span class="token punctuation">(</span><span class="token string">'DictPath'</span><span class="token punctuation">,</span> <span class="token string">'level key path vtype field_name'</span><span class="token punctuation">)</span>
    name_processor <span class="token operator">=</span> self<span class="token punctuation">.</span>name_processor <span class="token keyword">if</span> self<span class="token punctuation">.</span>name_processor <span class="token keyword">else</span> <span class="token boolean">None</span>

    <span class="token keyword">def</span> <span class="token function">get_data_type</span><span class="token punctuation">(</span>val<span class="token punctuation">)</span><span class="token punctuation">:</span>
      <span class="token keyword">if</span> <span class="token builtin">isinstance</span><span class="token punctuation">(</span>val<span class="token punctuation">,</span> <span class="token builtin">dict</span><span class="token punctuation">)</span><span class="token punctuation">:</span> <span class="token keyword">return</span> <span class="token string">'dict'</span>
      <span class="token keyword">if</span> <span class="token builtin">isinstance</span><span class="token punctuation">(</span>val<span class="token punctuation">,</span> <span class="token builtin">list</span><span class="token punctuation">)</span><span class="token punctuation">:</span> <span class="token keyword">return</span> <span class="token string">'list'</span>
      <span class="token keyword">try</span><span class="token punctuation">:</span> <span class="token builtin">float</span><span class="token punctuation">(</span>val<span class="token punctuation">)</span> <span class="token punctuation">;</span> <span class="token keyword">return</span> <span class="token string">'number'</span>
      <span class="token keyword">except</span><span class="token punctuation">:</span>
        <span class="token keyword">try</span><span class="token punctuation">:</span> dateutil<span class="token punctuation">.</span>parser<span class="token punctuation">.</span>parse<span class="token punctuation">(</span>val<span class="token punctuation">)</span> <span class="token punctuation">;</span> <span class="token keyword">return</span> <span class="token string">'datetime'</span>
        <span class="token keyword">except</span><span class="token punctuation">:</span> <span class="token keyword">return</span> <span class="token string">'string'</span>

    <span class="token keyword">def</span> <span class="token function">get_field_name</span><span class="token punctuation">(</span>key<span class="token punctuation">,</span> parent<span class="token punctuation">)</span><span class="token punctuation">:</span>
      prefix <span class="token operator">=</span> <span class="token string">''</span>
      parent <span class="token operator">=</span> parent<span class="token punctuation">.</span>replace<span class="token punctuation">(</span><span class="token string">'&quot;'</span><span class="token punctuation">,</span> <span class="token string">''</span><span class="token punctuation">)</span>

      <span class="token keyword">if</span> <span class="token punctuation">(</span>parent<span class="token punctuation">.</span>endswith<span class="token punctuation">(</span><span class="token string">'[*]'</span><span class="token punctuation">)</span> <span class="token keyword">and</span> <span class="token builtin">len</span><span class="token punctuation">(</span>parent<span class="token punctuation">.</span>split<span class="token punctuation">(</span><span class="token string">'.'</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token operator">&gt;</span> <span class="token number">1</span><span class="token punctuation">)</span> <span class="token keyword">or</span> \
          <span class="token punctuation">(</span>parent<span class="token punctuation">.</span>endswith<span class="token punctuation">(</span><span class="token string">'[*]'</span><span class="token punctuation">)</span> <span class="token keyword">and</span> <span class="token keyword">not</span> parent<span class="token punctuation">.</span>startswith<span class="token punctuation">(</span><span class="token string">'[*]'</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
        prefix <span class="token operator">=</span> parent<span class="token punctuation">.</span>replace<span class="token punctuation">(</span><span class="token string">'[*]'</span><span class="token punctuation">,</span> <span class="token string">''</span><span class="token punctuation">)</span><span class="token punctuation">.</span>split<span class="token punctuation">(</span><span class="token string">'.'</span><span class="token punctuation">)</span><span class="token punctuation">[</span><span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">]</span> <span class="token operator">+</span> <span class="token string">'_'</span>

      <span class="token keyword">if</span> name_processor<span class="token punctuation">:</span>
        prefix <span class="token operator">=</span> name_processor<span class="token punctuation">(</span>prefix<span class="token punctuation">)</span>
        key <span class="token operator">=</span> name_processor<span class="token punctuation">(</span>key<span class="token punctuation">)</span>

      f_name_new <span class="token operator">=</span> f_name <span class="token operator">=</span> prefix <span class="token operator">+</span> key
      i <span class="token operator">=</span> <span class="token number">0</span>
      <span class="token keyword">while</span> f_name_new <span class="token keyword">in</span> fields_parent <span class="token keyword">and</span> fields_parent<span class="token punctuation">[</span>f_name_new<span class="token punctuation">]</span> <span class="token operator">!=</span> parent<span class="token punctuation">:</span>
        i<span class="token operator">+=</span><span class="token number">1</span>
        f_name_new <span class="token operator">=</span> f_name <span class="token operator">+</span> <span class="token builtin">str</span><span class="token punctuation">(</span>i<span class="token punctuation">)</span>
      fields_parent<span class="token punctuation">[</span>f_name_new<span class="token punctuation">]</span> <span class="token operator">=</span> parent
      <span class="token keyword">return</span> f_name_new

    q <span class="token operator">=</span> <span class="token keyword">lambda</span> s<span class="token punctuation">:</span> <span class="token string">'&quot;'</span> <span class="token operator">+</span> s <span class="token operator">+</span> <span class="token string">'&quot;'</span>
    <span class="token keyword">def</span> <span class="token function">get_paths</span><span class="token punctuation">(</span>d1<span class="token punctuation">,</span> level<span class="token operator">=</span><span class="token number">1</span><span class="token punctuation">,</span> parent<span class="token operator">=</span><span class="token string">''</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
      kks <span class="token operator">=</span> <span class="token builtin">set</span><span class="token punctuation">(</span><span class="token punctuation">)</span>

      <span class="token keyword">if</span> <span class="token builtin">isinstance</span><span class="token punctuation">(</span>d1<span class="token punctuation">,</span> <span class="token builtin">dict</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
        <span class="token keyword">if</span> <span class="token string">&quot;Header&quot;</span> <span class="token keyword">in</span> d1<span class="token punctuation">:</span>
          keys <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token string">&quot;Header&quot;</span><span class="token punctuation">]</span> <span class="token operator">+</span> <span class="token punctuation">[</span>k <span class="token keyword">for</span> k <span class="token keyword">in</span> d1 <span class="token keyword">if</span> k <span class="token operator">!=</span> <span class="token string">&quot;Header&quot;</span><span class="token punctuation">]</span>
        <span class="token keyword">else</span><span class="token punctuation">:</span>
          keys <span class="token operator">=</span> <span class="token builtin">list</span><span class="token punctuation">(</span>d1<span class="token punctuation">)</span>
        <span class="token keyword">for</span> key <span class="token keyword">in</span> keys<span class="token punctuation">:</span>
          <span class="token keyword">if</span> key<span class="token punctuation">.</span>startswith<span class="token punctuation">(</span><span class="token string">'@'</span><span class="token punctuation">)</span><span class="token punctuation">:</span> <span class="token keyword">continue</span>
          vt <span class="token operator">=</span> get_data_type<span class="token punctuation">(</span>d1<span class="token punctuation">[</span>key<span class="token punctuation">]</span><span class="token punctuation">)</span>
          field_name <span class="token operator">=</span> get_field_name<span class="token punctuation">(</span>key<span class="token punctuation">,</span> parent<span class="token punctuation">)</span> <span class="token keyword">if</span> vt <span class="token keyword">not</span> <span class="token keyword">in</span> <span class="token punctuation">(</span><span class="token string">'dict'</span><span class="token punctuation">,</span> <span class="token string">'list'</span><span class="token punctuation">)</span> <span class="token keyword">else</span> <span class="token boolean">None</span>
          path <span class="token operator">=</span> <span class="token string">'{}{}'</span><span class="token punctuation">.</span><span class="token builtin">format</span><span class="token punctuation">(</span>parent <span class="token operator">+</span> <span class="token string">'.'</span> <span class="token keyword">if</span> parent <span class="token keyword">else</span> <span class="token string">''</span><span class="token punctuation">,</span> q<span class="token punctuation">(</span>key<span class="token punctuation">)</span><span class="token punctuation">)</span>
          kks<span class="token punctuation">.</span>add<span class="token punctuation">(</span>DP<span class="token punctuation">(</span>level<span class="token punctuation">,</span> key<span class="token punctuation">,</span> path<span class="token punctuation">,</span> vt<span class="token punctuation">,</span> field_name<span class="token punctuation">)</span><span class="token punctuation">)</span>
          kks <span class="token operator">=</span> kks<span class="token punctuation">.</span>union<span class="token punctuation">(</span>get_paths<span class="token punctuation">(</span>d1<span class="token punctuation">[</span>key<span class="token punctuation">]</span><span class="token punctuation">,</span> level<span class="token operator">=</span>level<span class="token operator">+</span><span class="token number">1</span><span class="token punctuation">,</span> parent<span class="token operator">=</span>path<span class="token punctuation">)</span><span class="token punctuation">)</span>
          <span class="token keyword">if</span> header_only <span class="token keyword">and</span> key <span class="token operator">==</span> <span class="token string">&quot;Header&quot;</span><span class="token punctuation">:</span> <span class="token keyword">return</span> kks
      <span class="token keyword">elif</span> <span class="token builtin">isinstance</span><span class="token punctuation">(</span>d1<span class="token punctuation">,</span> <span class="token builtin">list</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
        key <span class="token operator">=</span> <span class="token string">'[*]'</span>
        path <span class="token operator">=</span> <span class="token string">'{}{}'</span><span class="token punctuation">.</span><span class="token builtin">format</span><span class="token punctuation">(</span>parent <span class="token keyword">if</span> parent <span class="token keyword">else</span> <span class="token string">''</span><span class="token punctuation">,</span> key<span class="token punctuation">)</span>
        <span class="token keyword">if</span> level<span class="token operator">==</span><span class="token number">1</span><span class="token punctuation">:</span>
          kks<span class="token punctuation">.</span>add<span class="token punctuation">(</span>DP<span class="token punctuation">(</span>level<span class="token punctuation">,</span> key<span class="token punctuation">,</span> path<span class="token punctuation">,</span> vt<span class="token punctuation">,</span> <span class="token boolean">None</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
        <span class="token keyword">for</span> item <span class="token keyword">in</span> d1<span class="token punctuation">:</span>
          kks <span class="token operator">=</span> kks<span class="token punctuation">.</span>union<span class="token punctuation">(</span>get_paths<span class="token punctuation">(</span>item<span class="token punctuation">,</span> level<span class="token operator">=</span>level<span class="token operator">+</span><span class="token number">1</span><span class="token punctuation">,</span> parent<span class="token operator">=</span>path<span class="token punctuation">)</span><span class="token punctuation">)</span>

      <span class="token keyword">return</span> kks

    self<span class="token punctuation">.</span>paths <span class="token operator">=</span> <span class="token builtin">sorted</span><span class="token punctuation">(</span>get_paths<span class="token punctuation">(</span>self<span class="token punctuation">.</span>data<span class="token punctuation">)</span><span class="token punctuation">)</span>
    self<span class="token punctuation">.</span>v_paths <span class="token operator">=</span> <span class="token punctuation">[</span>r <span class="token keyword">for</span> r <span class="token keyword">in</span> self<span class="token punctuation">.</span>paths <span class="token keyword">if</span> r<span class="token punctuation">.</span>vtype <span class="token keyword">not</span> <span class="token keyword">in</span> <span class="token punctuation">(</span><span class="token string">'dict'</span><span class="token punctuation">,</span> <span class="token string">'list'</span><span class="token punctuation">)</span><span class="token punctuation">]</span>
    self<span class="token punctuation">.</span>v_lists <span class="token operator">=</span> <span class="token punctuation">[</span>r <span class="token keyword">for</span> r <span class="token keyword">in</span> self<span class="token punctuation">.</span>paths <span class="token keyword">if</span> r<span class="token punctuation">.</span>vtype <span class="token keyword">in</span> <span class="token punctuation">(</span><span class="token string">'list'</span><span class="token punctuation">)</span><span class="token punctuation">]</span>
    self<span class="token punctuation">.</span>fields <span class="token operator">=</span> <span class="token punctuation">[</span>r<span class="token punctuation">.</span>field_name <span class="token keyword">for</span> r <span class="token keyword">in</span> self<span class="token punctuation">.</span>paths <span class="token keyword">if</span> r<span class="token punctuation">.</span>vtype <span class="token keyword">not</span> <span class="token keyword">in</span> <span class="token punctuation">(</span><span class="token string">'dict'</span><span class="token punctuation">,</span> <span class="token string">'list'</span><span class="token punctuation">)</span><span class="token punctuation">]</span>
    self<span class="token punctuation">.</span>fields_dict <span class="token operator">=</span> <span class="token punctuation">{</span>r<span class="token punctuation">.</span>field_name<span class="token punctuation">:</span> r <span class="token keyword">for</span> r <span class="token keyword">in</span> self<span class="token punctuation">.</span>paths <span class="token keyword">if</span> r<span class="token punctuation">.</span>vtype <span class="token keyword">not</span> <span class="token keyword">in</span> <span class="token punctuation">(</span><span class="token string">'dict'</span><span class="token punctuation">,</span> <span class="token string">'list'</span><span class="token punctuation">)</span><span class="token punctuation">}</span>
    self<span class="token punctuation">.</span>Rec <span class="token operator">=</span> Row<span class="token punctuation">(</span><span class="token operator">*</span>self<span class="token punctuation">.</span>fields<span class="token punctuation">)</span>

    <span class="token keyword">try</span><span class="token punctuation">:</span>
      self<span class="token punctuation">.</span>title <span class="token operator">=</span> <span class="token builtin">list</span><span class="token punctuation">(</span>self<span class="token punctuation">.</span>data<span class="token punctuation">)</span><span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span>
      self<span class="token punctuation">.</span>action <span class="token operator">=</span> self<span class="token punctuation">.</span>get_value<span class="token punctuation">(</span><span class="token string">'Action'</span><span class="token punctuation">,</span> conv_date<span class="token operator">=</span><span class="token boolean">False</span><span class="token punctuation">)</span>
    <span class="token keyword">except</span><span class="token punctuation">:</span>
      <span class="token keyword">pass</span>

    <span class="token keyword">return</span> self<span class="token punctuation">.</span>paths

  <span class="token keyword">def</span> <span class="token function">search</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> path<span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token keyword">from</span> jmespath <span class="token keyword">import</span> search
    <span class="token keyword">return</span> search<span class="token punctuation">(</span>path<span class="token punctuation">,</span> self<span class="token punctuation">.</span>data<span class="token punctuation">)</span>

  <span class="token keyword">def</span> <span class="token function">get_value</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> field<span class="token punctuation">,</span> conv_date<span class="token operator">=</span><span class="token boolean">True</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
    val <span class="token operator">=</span> self<span class="token punctuation">.</span>search<span class="token punctuation">(</span>self<span class="token punctuation">.</span>fields_dict<span class="token punctuation">[</span>field<span class="token punctuation">]</span><span class="token punctuation">.</span>path<span class="token punctuation">)</span>
    <span class="token keyword">if</span> conv_date <span class="token keyword">and</span> self<span class="token punctuation">.</span>fields_dict<span class="token punctuation">[</span>field<span class="token punctuation">]</span><span class="token punctuation">.</span>vtype <span class="token operator">==</span> <span class="token string">'date'</span><span class="token punctuation">:</span>
      <span class="token keyword">try</span><span class="token punctuation">:</span> val <span class="token operator">=</span> dateutil<span class="token punctuation">.</span>parser<span class="token punctuation">.</span>parse<span class="token punctuation">(</span>val<span class="token punctuation">)</span>
      <span class="token keyword">except</span><span class="token punctuation">:</span> <span class="token keyword">pass</span>
    <span class="token keyword">return</span> val

  <span class="token keyword">def</span> <span class="token function">get_field_table</span><span class="token punctuation">(</span>self<span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token string">&quot;Create fields table&quot;</span>
    t_rows <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span>
    <span class="token keyword">for</span> field <span class="token keyword">in</span> self<span class="token punctuation">.</span>fields<span class="token punctuation">:</span>
      val <span class="token operator">=</span> self<span class="token punctuation">.</span>get_value<span class="token punctuation">(</span>field<span class="token punctuation">)</span>
      rec <span class="token operator">=</span> <span class="token builtin">dict</span><span class="token punctuation">(</span>
        title<span class="token operator">=</span>self<span class="token punctuation">.</span>title<span class="token punctuation">,</span>
        action<span class="token operator">=</span>self<span class="token punctuation">.</span>action<span class="token punctuation">,</span>
        field_name<span class="token operator">=</span>field<span class="token punctuation">,</span>
        field_type<span class="token operator">=</span>self<span class="token punctuation">.</span>fields_dict<span class="token punctuation">[</span>field<span class="token punctuation">]</span><span class="token punctuation">.</span>vtype<span class="token punctuation">,</span>
        depth_level<span class="token operator">=</span>self<span class="token punctuation">.</span>fields_dict<span class="token punctuation">[</span>field<span class="token punctuation">]</span><span class="token punctuation">.</span>level<span class="token punctuation">,</span>
        field_path<span class="token operator">=</span>self<span class="token punctuation">.</span>fields_dict<span class="token punctuation">[</span>field<span class="token punctuation">]</span><span class="token punctuation">.</span>path<span class="token punctuation">,</span>
        is_null<span class="token operator">=</span><span class="token number">0</span> <span class="token keyword">if</span> <span class="token builtin">str</span><span class="token punctuation">(</span>val<span class="token punctuation">)</span><span class="token punctuation">.</span>strip<span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token keyword">else</span> <span class="token number">1</span><span class="token punctuation">,</span>
        is_list<span class="token operator">=</span><span class="token number">1</span> <span class="token keyword">if</span> <span class="token builtin">isinstance</span><span class="token punctuation">(</span>val<span class="token punctuation">,</span> <span class="token builtin">list</span><span class="token punctuation">)</span> <span class="token keyword">else</span> <span class="token number">0</span><span class="token punctuation">,</span>
        <span class="token builtin">len</span><span class="token operator">=</span><span class="token builtin">len</span><span class="token punctuation">(</span><span class="token builtin">str</span><span class="token punctuation">(</span>val<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
      <span class="token punctuation">)</span>

      t_rows<span class="token punctuation">.</span>append<span class="token punctuation">(</span>self<span class="token punctuation">.</span>TRow<span class="token punctuation">(</span><span class="token operator">**</span>rec<span class="token punctuation">)</span><span class="token punctuation">)</span>
    <span class="token keyword">return</span> t_rows

  <span class="token keyword">def</span> <span class="token function">get_record</span><span class="token punctuation">(</span>self<span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token string">&quot;Returns one record, omitting lists N:N relationships&quot;</span>
    <span class="token keyword">return</span> self<span class="token punctuation">.</span>Rec<span class="token punctuation">(</span><span class="token operator">*</span><span class="token punctuation">[</span>self<span class="token punctuation">.</span>get_value<span class="token punctuation">(</span>f<span class="token punctuation">)</span> <span class="token keyword">for</span> f <span class="token keyword">in</span> self<span class="token punctuation">.</span>fields<span class="token punctuation">]</span><span class="token punctuation">)</span>
</code></pre></div><h3 id="pandas"><a href="#pandas" aria-hidden="true" class="header-anchor">#</a> Pandas</h3> <ul><li><p>Dataframe: :http://pandas.pydata.org/pandas-docs/stable/api.html#dataframe&gt;</p> <ul><li>Serialization / IO / Conversion: <a href="http://pandas.pydata.org/pandas-docs/stable/api.html#id12" target="_blank" rel="noopener noreferrer">http://pandas.pydata.org/pandas-docs/stable/api.html#id12<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></li></ul></li> <li><p>Iterate over dataFrame:</p> <ul><li>df.itertuples() - namedtuples</li> <li>df.iterrows() - dicts</li></ul></li> <li><p>CSV Interaction:</p> <ul><li>df.to_csv(fileName): <a href="http://pandas.pydata.org/pandas-docs/stable/generated/pandas.DataFrame.to_csv.html" target="_blank" rel="noopener noreferrer">http://pandas.pydata.org/pandas-docs/stable/generated/pandas.DataFrame.to_csv.html<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></li> <li>pandas.read_csv(fileName): <a href="http://pandas.pydata.org/pandas-docs/stable/generated/pandas.read_csv.html" target="_blank" rel="noopener noreferrer">http://pandas.pydata.org/pandas-docs/stable/generated/pandas.read_csv.html<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></li></ul></li></ul> <div class="language-python extra-class"><pre class="language-python"><code>
<span class="token keyword">def</span> <span class="token function">process_one_field</span><span class="token punctuation">(</span>args<span class="token punctuation">)</span><span class="token punctuation">:</span>
  <span class="token punctuation">(</span>df<span class="token punctuation">,</span> field<span class="token punctuation">,</span> fields_types<span class="token punctuation">,</span> samples_n<span class="token punctuation">)</span> <span class="token operator">=</span> args
  data_type <span class="token operator">=</span> fields_types<span class="token punctuation">[</span>field<span class="token punctuation">]</span>
  tot_cnt <span class="token operator">=</span> <span class="token builtin">len</span><span class="token punctuation">(</span>df<span class="token punctuation">)</span>
  f_cnt <span class="token operator">=</span> df<span class="token punctuation">[</span>field<span class="token punctuation">]</span><span class="token punctuation">.</span>count<span class="token punctuation">(</span><span class="token punctuation">)</span>
  f_null_cnt <span class="token operator">=</span> tot_cnt <span class="token operator">-</span> f_cnt
  f_null_prct <span class="token operator">=</span> <span class="token builtin">round</span><span class="token punctuation">(</span><span class="token number">100.0</span> <span class="token operator">*</span> f_null_cnt <span class="token operator">/</span> tot_cnt<span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">)</span> <span class="token keyword">if</span> tot_cnt <span class="token keyword">else</span> tot_cnt
  f_dstct_cnt <span class="token operator">=</span> <span class="token builtin">len</span><span class="token punctuation">(</span>df<span class="token punctuation">[</span>field<span class="token punctuation">]</span><span class="token punctuation">.</span>unique<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
  f_dstct_prct <span class="token operator">=</span> <span class="token builtin">round</span><span class="token punctuation">(</span><span class="token number">100.0</span> <span class="token operator">*</span> f_dstct_cnt <span class="token operator">/</span> tot_cnt<span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">)</span> <span class="token keyword">if</span> tot_cnt <span class="token keyword">else</span> tot_cnt
  f_dup_cnt <span class="token operator">=</span> f_cnt <span class="token operator">-</span> f_dstct_cnt <span class="token keyword">if</span> f_cnt <span class="token operator">&gt;</span> f_dstct_cnt <span class="token keyword">else</span> <span class="token number">0</span>

  f_min_len <span class="token operator">=</span> df<span class="token punctuation">[</span>field<span class="token punctuation">]</span><span class="token punctuation">.</span><span class="token builtin">apply</span><span class="token punctuation">(</span><span class="token builtin">str</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token builtin">str</span><span class="token punctuation">.</span><span class="token builtin">len</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token builtin">min</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
  f_max_len <span class="token operator">=</span> df<span class="token punctuation">[</span>field<span class="token punctuation">]</span><span class="token punctuation">.</span><span class="token builtin">apply</span><span class="token punctuation">(</span><span class="token builtin">str</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token builtin">str</span><span class="token punctuation">.</span><span class="token builtin">len</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token builtin">max</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
  f_avg_len <span class="token operator">=</span> df<span class="token punctuation">[</span>field<span class="token punctuation">]</span><span class="token punctuation">.</span><span class="token builtin">apply</span><span class="token punctuation">(</span><span class="token builtin">str</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token builtin">str</span><span class="token punctuation">.</span><span class="token builtin">len</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span>mean<span class="token punctuation">(</span><span class="token punctuation">)</span>

  <span class="token keyword">try</span><span class="token punctuation">:</span> std <span class="token operator">=</span> df<span class="token punctuation">[</span>field<span class="token punctuation">]</span><span class="token punctuation">.</span>std<span class="token punctuation">(</span><span class="token punctuation">)</span>
  <span class="token keyword">except</span> TypeError<span class="token punctuation">:</span> std <span class="token operator">=</span> <span class="token boolean">None</span>

  <span class="token keyword">try</span><span class="token punctuation">:</span> f_prctl_25 <span class="token operator">=</span> df<span class="token punctuation">[</span>field<span class="token punctuation">]</span><span class="token punctuation">.</span>quantile<span class="token punctuation">(</span>q<span class="token operator">=</span><span class="token number">0.25</span><span class="token punctuation">)</span>
  <span class="token keyword">except</span> TypeError<span class="token punctuation">:</span> f_prctl_25 <span class="token operator">=</span> <span class="token boolean">None</span>

  <span class="token keyword">try</span><span class="token punctuation">:</span> f_prctl_50 <span class="token operator">=</span> df<span class="token punctuation">[</span>field<span class="token punctuation">]</span><span class="token punctuation">.</span>quantile<span class="token punctuation">(</span>q<span class="token operator">=</span><span class="token number">0.50</span><span class="token punctuation">)</span>
  <span class="token keyword">except</span> TypeError<span class="token punctuation">:</span> f_prctl_50 <span class="token operator">=</span> <span class="token boolean">None</span>

  <span class="token keyword">try</span><span class="token punctuation">:</span> f_prctl_75 <span class="token operator">=</span> df<span class="token punctuation">[</span>field<span class="token punctuation">]</span><span class="token punctuation">.</span>quantile<span class="token punctuation">(</span>q<span class="token operator">=</span><span class="token number">0.75</span><span class="token punctuation">)</span>
  <span class="token keyword">except</span> TypeError<span class="token punctuation">:</span> f_prctl_75 <span class="token operator">=</span> <span class="token boolean">None</span>

  <span class="token keyword">try</span><span class="token punctuation">:</span> f_min <span class="token operator">=</span> df<span class="token punctuation">[</span>field<span class="token punctuation">]</span><span class="token punctuation">.</span><span class="token builtin">min</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
  <span class="token keyword">except</span> TypeError<span class="token punctuation">:</span> f_min <span class="token operator">=</span> <span class="token boolean">None</span>

  <span class="token keyword">try</span><span class="token punctuation">:</span> f_max <span class="token operator">=</span> df<span class="token punctuation">[</span>field<span class="token punctuation">]</span><span class="token punctuation">.</span><span class="token builtin">max</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
  <span class="token keyword">except</span> TypeError<span class="token punctuation">:</span> f_max <span class="token operator">=</span> <span class="token boolean">None</span>

  <span class="token keyword">try</span><span class="token punctuation">:</span> f_avg <span class="token operator">=</span> df<span class="token punctuation">[</span>field<span class="token punctuation">]</span><span class="token punctuation">.</span>mean<span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token keyword">if</span> fields_types<span class="token punctuation">[</span>field<span class="token punctuation">]</span> <span class="token keyword">in</span> <span class="token punctuation">(</span><span class="token string">'integer'</span><span class="token punctuation">,</span> <span class="token string">'decimal'</span><span class="token punctuation">)</span> <span class="token keyword">else</span> <span class="token boolean">None</span>
  <span class="token keyword">except</span> TypeError<span class="token punctuation">:</span> f_avg <span class="token operator">=</span> <span class="token boolean">None</span>

  <span class="token keyword">if</span> f_avg_len <span class="token operator">&lt;</span> <span class="token number">50</span><span class="token punctuation">:</span>
    mode <span class="token operator">=</span> df<span class="token punctuation">[</span>field<span class="token punctuation">]</span><span class="token punctuation">.</span>mode<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>  mode <span class="token operator">=</span> mode<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span> <span class="token keyword">if</span> <span class="token builtin">len</span><span class="token punctuation">(</span>mode<span class="token punctuation">)</span> <span class="token keyword">else</span> <span class="token boolean">None</span>
    sample <span class="token operator">=</span> <span class="token string">' | '</span><span class="token punctuation">.</span>join<span class="token punctuation">(</span><span class="token punctuation">[</span>
      <span class="token builtin">str</span><span class="token punctuation">(</span>v<span class="token punctuation">)</span> <span class="token keyword">for</span> v <span class="token keyword">in</span>
      <span class="token builtin">list</span><span class="token punctuation">(</span>df<span class="token punctuation">[</span>field<span class="token punctuation">]</span><span class="token punctuation">.</span>sample<span class="token punctuation">(</span>n<span class="token operator">=</span>samples_n <span class="token keyword">if</span> tot_cnt <span class="token operator">&gt;</span> samples_n <span class="token keyword">else</span> tot_cnt<span class="token punctuation">)</span><span class="token punctuation">)</span>
    <span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">.</span>replace<span class="token punctuation">(</span><span class="token string">'\n'</span><span class="token punctuation">,</span> <span class="token string">' '</span><span class="token punctuation">)</span><span class="token punctuation">.</span>replace<span class="token punctuation">(</span><span class="token string">'\\'</span><span class="token punctuation">,</span> <span class="token string">'\\\\'</span><span class="token punctuation">)</span> <span class="token keyword">if</span> tot_cnt <span class="token keyword">else</span> <span class="token string">''</span>
    distro_cnt <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">[</span><span class="token builtin">getattr</span><span class="token punctuation">(</span>row<span class="token punctuation">,</span> field<span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token builtin">int</span><span class="token punctuation">(</span>row<span class="token punctuation">.</span>cnt<span class="token punctuation">)</span><span class="token punctuation">]</span> <span class="token keyword">for</span> row <span class="token keyword">in</span>
      df<span class="token punctuation">.</span>groupby<span class="token punctuation">(</span><span class="token punctuation">[</span>field<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">.</span>size<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span>reset_index<span class="token punctuation">(</span>name<span class="token operator">=</span><span class="token string">'cnt'</span><span class="token punctuation">)</span><span class="token punctuation">.</span>sort_values<span class="token punctuation">(</span><span class="token string">'cnt'</span><span class="token punctuation">,</span> ascending<span class="token operator">=</span><span class="token boolean">False</span><span class="token punctuation">)</span><span class="token punctuation">.</span>head<span class="token punctuation">(</span>n<span class="token operator">=</span>top_n<span class="token punctuation">)</span><span class="token punctuation">.</span>itertuples<span class="token punctuation">(</span>index<span class="token operator">=</span><span class="token boolean">False</span><span class="token punctuation">)</span><span class="token punctuation">]</span>
    distro_prct <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">[</span>row<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">,</span> row<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token builtin">round</span><span class="token punctuation">(</span><span class="token number">100.0</span><span class="token operator">*</span>row<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token operator">/</span>tot_cnt<span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">]</span> <span class="token keyword">for</span> row <span class="token keyword">in</span> distro_cnt<span class="token punctuation">]</span>
    distro_str <span class="token operator">=</span> <span class="token builtin">str</span><span class="token punctuation">(</span>distro_prct<span class="token punctuation">)</span><span class="token punctuation">.</span>replace<span class="token punctuation">(</span><span class="token string">'\n'</span><span class="token punctuation">,</span> <span class="token string">' '</span><span class="token punctuation">)</span><span class="token punctuation">.</span>replace<span class="token punctuation">(</span><span class="token string">'\\'</span><span class="token punctuation">,</span> <span class="token string">'\\\\'</span><span class="token punctuation">)</span>
  <span class="token keyword">else</span><span class="token punctuation">:</span>
    mode <span class="token operator">=</span> <span class="token boolean">None</span>
    sample <span class="token operator">=</span> <span class="token string">''</span>
    distro_cnt <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span>
    distro_prct <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span>
    distro_str <span class="token operator">=</span> <span class="token string">''</span>
  
  dd <span class="token operator">=</span> <span class="token builtin">dict</span><span class="token punctuation">(</span>
    field<span class="token operator">=</span>field<span class="token punctuation">,</span>
    data_type<span class="token operator">=</span>data_type<span class="token punctuation">,</span>
    tot_cnt<span class="token operator">=</span>tot_cnt<span class="token punctuation">,</span>
    f_cnt<span class="token operator">=</span>f_cnt<span class="token punctuation">,</span>
    f_null_cnt<span class="token operator">=</span>f_null_cnt<span class="token punctuation">,</span>
    f_null_prct<span class="token operator">=</span>f_null_prct<span class="token punctuation">,</span>
    f_dstct_cnt<span class="token operator">=</span>f_dstct_cnt<span class="token punctuation">,</span>
    f_dstct_prct<span class="token operator">=</span>f_dstct_prct<span class="token punctuation">,</span>
    f_dup_cnt<span class="token operator">=</span>f_dup_cnt<span class="token punctuation">,</span>
    std<span class="token operator">=</span>std<span class="token punctuation">,</span>
    f_prctl_25<span class="token operator">=</span>f_prctl_25<span class="token punctuation">,</span>
    f_prctl_50<span class="token operator">=</span>f_prctl_50<span class="token punctuation">,</span>
    f_prctl_75<span class="token operator">=</span>f_prctl_75<span class="token punctuation">,</span>
    f_min<span class="token operator">=</span>f_min<span class="token punctuation">,</span>
    f_max<span class="token operator">=</span>f_max<span class="token punctuation">,</span>
    f_avg<span class="token operator">=</span>f_avg<span class="token punctuation">,</span>
    f_min_len<span class="token operator">=</span><span class="token builtin">round</span><span class="token punctuation">(</span>f_min_len<span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
    f_max_len<span class="token operator">=</span><span class="token builtin">round</span><span class="token punctuation">(</span>f_max_len<span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
    f_avg_len<span class="token operator">=</span><span class="token builtin">round</span><span class="token punctuation">(</span>f_avg_len<span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
    mode<span class="token operator">=</span>mode<span class="token punctuation">,</span>
    sample<span class="token operator">=</span>sample<span class="token punctuation">,</span>
    distro<span class="token operator">=</span>distro_str<span class="token punctuation">,</span>
    distro_cnt<span class="token operator">=</span>distro_cnt<span class="token punctuation">,</span>
    distro_prct<span class="token operator">=</span>distro_prct<span class="token punctuation">,</span>
  <span class="token punctuation">)</span>

  <span class="token keyword">return</span> dd


<span class="token keyword">def</span> <span class="token function">process_date_distro</span><span class="token punctuation">(</span>args<span class="token punctuation">)</span><span class="token punctuation">:</span>
  log<span class="token punctuation">(</span><span class="token string">'Processing dates'</span><span class="token punctuation">)</span>
  <span class="token punctuation">(</span>df<span class="token punctuation">,</span> date_field<span class="token punctuation">)</span> <span class="token operator">=</span> args
  <span class="token keyword">if</span> <span class="token keyword">not</span> date_field<span class="token punctuation">:</span> <span class="token keyword">return</span> <span class="token punctuation">{</span><span class="token punctuation">}</span>

  tot_cnt <span class="token operator">=</span> <span class="token builtin">len</span><span class="token punctuation">(</span>df<span class="token punctuation">)</span>

  ym_field <span class="token operator">=</span> <span class="token string">'year_month'</span>
  <span class="token keyword">while</span> ym_field <span class="token keyword">in</span> df<span class="token punctuation">.</span>columns<span class="token punctuation">:</span>
    ym_field <span class="token operator">=</span> ym_field <span class="token operator">+</span> <span class="token string">'_'</span>
  
  cols <span class="token operator">=</span> df<span class="token punctuation">.</span>columns
  <span class="token keyword">try</span><span class="token punctuation">:</span>
    df<span class="token punctuation">[</span>ym_field<span class="token punctuation">]</span> <span class="token operator">=</span> df<span class="token punctuation">[</span>date_field<span class="token punctuation">]</span><span class="token punctuation">.</span><span class="token builtin">map</span><span class="token punctuation">(</span><span class="token keyword">lambda</span> x<span class="token punctuation">:</span> x<span class="token punctuation">.</span>strftime<span class="token punctuation">(</span><span class="token string">'%Y-%m'</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
  <span class="token keyword">except</span> ValueError<span class="token punctuation">:</span>
    df <span class="token operator">=</span> df<span class="token punctuation">.</span>dropna<span class="token punctuation">(</span><span class="token punctuation">)</span>
    df<span class="token punctuation">[</span>ym_field<span class="token punctuation">]</span> <span class="token operator">=</span> df<span class="token punctuation">[</span>date_field<span class="token punctuation">]</span><span class="token punctuation">.</span><span class="token builtin">map</span><span class="token punctuation">(</span><span class="token keyword">lambda</span> x<span class="token punctuation">:</span> x<span class="token punctuation">.</span>strftime<span class="token punctuation">(</span><span class="token string">'%Y-%m'</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
  
  df2 <span class="token operator">=</span> df<span class="token punctuation">.</span>groupby<span class="token punctuation">(</span>ym_field<span class="token punctuation">)</span><span class="token punctuation">[</span>cols<span class="token punctuation">]</span><span class="token punctuation">.</span>count<span class="token punctuation">(</span><span class="token punctuation">)</span>

  field_date_distros <span class="token operator">=</span> OrderedDict<span class="token punctuation">(</span><span class="token punctuation">)</span>
  <span class="token comment"># get_ym = lambda row: [getattr(row, ym_field).split('-')[0], getattr(row, ym_field).split('-')[1]]</span>
  get_ym <span class="token operator">=</span> <span class="token keyword">lambda</span> row<span class="token punctuation">:</span> <span class="token punctuation">[</span><span class="token builtin">getattr</span><span class="token punctuation">(</span>row<span class="token punctuation">,</span> ym_field<span class="token punctuation">)</span><span class="token punctuation">]</span>
  <span class="token keyword">for</span> col <span class="token keyword">in</span> df2<span class="token punctuation">.</span>columns<span class="token punctuation">:</span>
    df2<span class="token punctuation">[</span>ym_field<span class="token punctuation">]</span> <span class="token operator">=</span> df2<span class="token punctuation">.</span>index
    df3 <span class="token operator">=</span> df2<span class="token punctuation">[</span><span class="token punctuation">[</span>ym_field<span class="token punctuation">,</span> col<span class="token punctuation">]</span><span class="token punctuation">]</span><span class="token punctuation">.</span>rename<span class="token punctuation">(</span>columns<span class="token operator">=</span><span class="token punctuation">{</span>col<span class="token punctuation">:</span> <span class="token string">&quot;cnt&quot;</span><span class="token punctuation">}</span><span class="token punctuation">)</span>
    df3<span class="token punctuation">[</span><span class="token string">'prct'</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token number">100.0</span> <span class="token operator">*</span> df3<span class="token punctuation">[</span><span class="token string">'cnt'</span><span class="token punctuation">]</span> <span class="token operator">/</span> tot_cnt
    field_date_distros<span class="token punctuation">[</span>col<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token punctuation">[</span>get_ym<span class="token punctuation">(</span>row<span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token punctuation">[</span><span class="token builtin">int</span><span class="token punctuation">(</span>row<span class="token punctuation">.</span>cnt<span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token builtin">round</span><span class="token punctuation">(</span>row<span class="token punctuation">.</span>prct<span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">]</span> <span class="token keyword">for</span> row <span class="token keyword">in</span>
      df3<span class="token punctuation">.</span>itertuples<span class="token punctuation">(</span>index<span class="token operator">=</span><span class="token boolean">False</span><span class="token punctuation">)</span><span class="token punctuation">]</span>
  
  <span class="token keyword">return</span> field_date_distros
</code></pre></div><h3 id="array"><a href="#array" aria-hidden="true" class="header-anchor">#</a> Array</h3> <p><a href="https://docs.python.org/2/library/array.html" target="_blank" rel="noopener noreferrer">https://docs.python.org/2/library/array.html<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></p> <p>Arrays are 10x more efficient than lists.</p> <table><thead><tr><th><strong>Type code</strong></th> <th><strong>C Type</strong></th> <th><strong>Python Type</strong></th> <th><strong>Minimum size in bytes</strong></th></tr></thead> <tbody><tr><td>'c'</td> <td>char</td> <td>character</td> <td>1</td></tr> <tr><td>'b'</td> <td>signed char</td> <td>int</td> <td>1</td></tr> <tr><td>'B'</td> <td>unsigned char</td> <td>int</td> <td>1</td></tr> <tr><td>'u'</td> <td>Py_UNICODE</td> <td>Unicode character</td> <td>2 (see note)</td></tr> <tr><td>'h'</td> <td>signed short</td> <td>int</td> <td>2</td></tr> <tr><td>'H'</td> <td>unsigned short</td> <td>int</td> <td>2</td></tr> <tr><td>'i'</td> <td>signed int</td> <td>int</td> <td>2</td></tr> <tr><td>'I'</td> <td>unsigned int</td> <td>long</td> <td>2</td></tr> <tr><td>'l'</td> <td>signed long</td> <td>int</td> <td>4</td></tr> <tr><td>'L'</td> <td>unsigned long</td> <td>long</td> <td>4</td></tr> <tr><td>'f'</td> <td>float</td> <td>float</td> <td>4</td></tr> <tr><td>'d'</td> <td>double</td> <td>float</td> <td>8</td></tr></tbody></table> <div class="language-python extra-class"><pre class="language-python"><code><span class="token keyword">import</span> array
data_array <span class="token operator">=</span> array<span class="token punctuation">.</span>array<span class="token punctuation">(</span><span class="token string">'i'</span><span class="token punctuation">,</span> <span class="token builtin">range</span><span class="token punctuation">(</span>size<span class="token punctuation">)</span><span class="token punctuation">)</span>
data_array<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token number">1</span>
data_array<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token number">2</span>
</code></pre></div><h3 id="list"><a href="#list" aria-hidden="true" class="header-anchor">#</a> List</h3> <div class="language-python extra-class"><pre class="language-python"><code>data_array <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span>
value <span class="token operator">=</span> <span class="token number">0.1</span>
data_array<span class="token punctuation">.</span>append<span class="token punctuation">(</span>value<span class="token punctuation">)</span>
size <span class="token operator">=</span> <span class="token builtin">len</span><span class="token punctuation">(</span>data_array<span class="token punctuation">)</span>

<span class="token keyword">for</span> value <span class="token keyword">in</span> data_array<span class="token punctuation">:</span>
  <span class="token keyword">print</span><span class="token punctuation">(</span>value<span class="token punctuation">)</span>
</code></pre></div><h3 id="tuple-vs-list"><a href="#tuple-vs-list" aria-hidden="true" class="header-anchor">#</a> Tuple vs List</h3> <p>**BOTTOM LINE: **</p> <ul><li><strong>If array of items will never be changed (no appending and no change of inner-item), use Tuple</strong></li> <li><strong>If array of items will require lots of changes (many appends or change of inner-item), use List</strong> <strong>Performance</strong></li></ul> <p>Python makes this very easy: timeit is your friend.</p> <div class="language-python extra-class"><pre class="language-python"><code>python <span class="token operator">-</span>m timeit <span class="token operator">-</span>s <span class="token string">&quot;x=(1,2,3,4,5,6,7,8)&quot;</span>
<span class="token number">100000000</span> loops<span class="token punctuation">,</span> best of <span class="token number">3</span><span class="token punctuation">:</span> <span class="token number">0.017</span> usec per loop

python <span class="token operator">-</span>m timeit <span class="token operator">-</span>s <span class="token string">&quot;x=[1,2,3,4,5,6,7,8]&quot;</span>
<span class="token number">100000000</span> loops<span class="token punctuation">,</span> best of <span class="token number">3</span><span class="token punctuation">:</span> <span class="token number">0.0143</span> usec per loop
</code></pre></div><p>and...</p> <div class="language-python extra-class"><pre class="language-python"><code>$ python <span class="token operator">-</span>m timeit <span class="token operator">-</span>s <span class="token string">&quot;x=(1,2,3,4,5,6,7,8)&quot;</span> <span class="token string">&quot;y=x[3]&quot;</span>
<span class="token number">10000000</span> loops<span class="token punctuation">,</span> best of <span class="token number">3</span><span class="token punctuation">:</span> <span class="token number">0.0938</span> usec per loop

$ python <span class="token operator">-</span>m timeit <span class="token operator">-</span>s <span class="token string">&quot;x=[1,2,3,4,5,6,7,8]&quot;</span> <span class="token string">&quot;y=x[3]&quot;</span>
<span class="token number">10000000</span> loops<span class="token punctuation">,</span> best of <span class="token number">3</span><span class="token punctuation">:</span> <span class="token number">0.0649</span> usec per loop
</code></pre></div><p>So in this case, instantiation is almost an order of magnitude faster for the tuple, but item access is actually somewhat faster for the list! So if you're creating a few tuples and accessing them many many times, it may actually be faster to use lists instead.</p> <p>Of course if you want to change an item, the list will definitely be faster since you'd need to create an entire new tuple to change one item of it (since tuples are immutable).</p> <h3 id="mutable-immutable"><a href="#mutable-immutable" aria-hidden="true" class="header-anchor">#</a> Mutable/Immutable</h3> <div class="language-python extra-class"><pre class="language-python"><code>x <span class="token operator">=</span> something <span class="token comment"># immutable type</span>
<span class="token keyword">print</span> x
func<span class="token punctuation">(</span>x<span class="token punctuation">)</span>
<span class="token keyword">print</span> x <span class="token comment"># prints the same thing</span>

x <span class="token operator">=</span> something <span class="token comment"># mutable type</span>
<span class="token keyword">print</span> x
func<span class="token punctuation">(</span>x<span class="token punctuation">)</span>
<span class="token keyword">print</span> x <span class="token comment"># might print something different</span>

x <span class="token operator">=</span> something <span class="token comment"># immutable type</span>
y <span class="token operator">=</span> x
<span class="token keyword">print</span> x
<span class="token comment"># some statement that operates on y</span>
<span class="token keyword">print</span> x <span class="token comment"># prints the same thing</span>

x <span class="token operator">=</span> something <span class="token comment"># mutable type</span>
y <span class="token operator">=</span> x
<span class="token keyword">print</span> x
<span class="token comment"># some statement that operates on y</span>
<span class="token keyword">print</span> x <span class="token comment"># might print something different</span>
</code></pre></div><p>The value of mutable objects can be changed after they are created.</p> <p>Immutable objects are fundamentally expensive to &quot;change&quot;, because doing so involves creating a copy, hence the creation of a new object (as shown below).</p> <p>Changing mutable objects is cheap.</p> <p><strong>Strings are immutable:</strong></p> <div class="language-python extra-class"><pre class="language-python"><code><span class="token operator">&gt;&gt;</span><span class="token operator">&gt;</span> a <span class="token operator">=</span> <span class="token string">'h'</span>
<span class="token operator">&gt;&gt;</span><span class="token operator">&gt;</span> <span class="token builtin">id</span><span class="token punctuation">(</span>a<span class="token punctuation">)</span>
46448768L
<span class="token operator">&gt;&gt;</span><span class="token operator">&gt;</span> a <span class="token operator">+=</span> <span class="token string">'g'</span>
<span class="token operator">&gt;&gt;</span><span class="token operator">&gt;</span> a
<span class="token string">'hg'</span>
<span class="token operator">&gt;&gt;</span><span class="token operator">&gt;</span> <span class="token builtin">id</span><span class="token punctuation">(</span>a<span class="token punctuation">)</span>
47561744L
</code></pre></div><p><strong>Numbers are immutable:</strong></p> <div class="language-python extra-class"><pre class="language-python"><code><span class="token operator">&gt;&gt;</span><span class="token operator">&gt;</span> a <span class="token operator">=</span> <span class="token number">1</span>
<span class="token operator">&gt;&gt;</span><span class="token operator">&gt;</span> <span class="token builtin">id</span><span class="token punctuation">(</span>a<span class="token punctuation">)</span>
36478936L
<span class="token operator">&gt;&gt;</span><span class="token operator">&gt;</span> a <span class="token operator">+=</span> <span class="token number">1</span>
<span class="token operator">&gt;&gt;</span><span class="token operator">&gt;</span> a
<span class="token number">2</span>
<span class="token operator">&gt;&gt;</span><span class="token operator">&gt;</span> <span class="token builtin">id</span><span class="token punctuation">(</span>a<span class="token punctuation">)</span>
36478912L

<span class="token operator">&gt;&gt;</span><span class="token operator">&gt;</span> a <span class="token operator">=</span> <span class="token number">5.6</span>
<span class="token operator">&gt;&gt;</span><span class="token operator">&gt;</span> <span class="token builtin">id</span><span class="token punctuation">(</span>a<span class="token punctuation">)</span>
36539176L
<span class="token operator">&gt;&gt;</span><span class="token operator">&gt;</span> a <span class="token operator">+=</span> <span class="token number">6.0</span>
<span class="token operator">&gt;&gt;</span><span class="token operator">&gt;</span> a
<span class="token number">11.6</span>
<span class="token operator">&gt;&gt;</span><span class="token operator">&gt;</span> <span class="token builtin">id</span><span class="token punctuation">(</span>a<span class="token punctuation">)</span>
36539224L
</code></pre></div><p><strong>Tuple are Immutable</strong></p> <div class="language-python extra-class"><pre class="language-python"><code><span class="token operator">&gt;&gt;</span><span class="token operator">&gt;</span> a <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token number">2</span><span class="token punctuation">)</span>
<span class="token operator">&gt;&gt;</span><span class="token operator">&gt;</span> <span class="token builtin">id</span><span class="token punctuation">(</span>a<span class="token punctuation">)</span>
46922376L
<span class="token operator">&gt;&gt;</span><span class="token operator">&gt;</span> a <span class="token operator">=</span> a <span class="token operator">+</span> <span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">,</span><span class="token punctuation">)</span>
<span class="token operator">&gt;&gt;</span><span class="token operator">&gt;</span> a
<span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">)</span>
<span class="token operator">&gt;&gt;</span><span class="token operator">&gt;</span> <span class="token builtin">id</span><span class="token punctuation">(</span>a<span class="token punctuation">)</span>
47525608L
</code></pre></div><p><strong>Lists are Mutable</strong></p> <div class="language-python extra-class"><pre class="language-python"><code><span class="token operator">&gt;&gt;</span><span class="token operator">&gt;</span> a <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span>
<span class="token operator">&gt;&gt;</span><span class="token operator">&gt;</span> <span class="token builtin">id</span><span class="token punctuation">(</span>a<span class="token punctuation">)</span>
47533064L
<span class="token operator">&gt;&gt;</span><span class="token operator">&gt;</span> a<span class="token punctuation">.</span>append<span class="token punctuation">(</span><span class="token string">'1'</span><span class="token punctuation">)</span>
<span class="token operator">&gt;&gt;</span><span class="token operator">&gt;</span> <span class="token builtin">id</span><span class="token punctuation">(</span>a<span class="token punctuation">)</span>
47533064L
</code></pre></div><p><strong>Dicts are Mutable</strong></p> <div class="language-python extra-class"><pre class="language-python"><code><span class="token operator">&gt;&gt;</span><span class="token operator">&gt;</span> a <span class="token operator">=</span> <span class="token punctuation">{</span><span class="token string">'a'</span><span class="token punctuation">:</span> <span class="token number">2</span><span class="token punctuation">}</span>
<span class="token operator">&gt;&gt;</span><span class="token operator">&gt;</span> <span class="token builtin">id</span><span class="token punctuation">(</span>a<span class="token punctuation">)</span>
47578376L
<span class="token operator">&gt;&gt;</span><span class="token operator">&gt;</span> a<span class="token punctuation">[</span><span class="token string">'d'</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token number">4</span>
<span class="token operator">&gt;&gt;</span><span class="token operator">&gt;</span> a
<span class="token punctuation">{</span><span class="token string">'a'</span><span class="token punctuation">:</span> <span class="token number">2</span><span class="token punctuation">,</span> <span class="token string">'d'</span><span class="token punctuation">:</span> <span class="token number">4</span><span class="token punctuation">}</span>
<span class="token operator">&gt;&gt;</span><span class="token operator">&gt;</span> <span class="token builtin">id</span><span class="token punctuation">(</span>a<span class="token punctuation">)</span>
47578376L
</code></pre></div><h3 id="copying-objects"><a href="#copying-objects" aria-hidden="true" class="header-anchor">#</a> Copying Objects</h3> <p><strong>Mutable Custom Objects</strong></p> <div class="language-python extra-class"><pre class="language-python"><code><span class="token keyword">import</span> copy

newobj <span class="token operator">=</span> copy<span class="token punctuation">.</span>copy<span class="token punctuation">(</span>oldobj<span class="token punctuation">)</span> <span class="token comment"># shallow copy</span>
newobj <span class="token operator">=</span> copy<span class="token punctuation">.</span>deepcopy<span class="token punctuation">(</span>oldobj<span class="token punctuation">)</span> <span class="token comment"># deep (recursive) copy</span>
</code></pre></div><p><strong>Dicts</strong></p> <div class="language-python extra-class"><pre class="language-python"><code>newdict <span class="token operator">=</span> olddict<span class="token punctuation">.</span>copy<span class="token punctuation">(</span><span class="token punctuation">)</span>
new_dict <span class="token operator">=</span> <span class="token builtin">dict</span><span class="token punctuation">(</span>olddict<span class="token punctuation">)</span> <span class="token comment"># copy</span>
</code></pre></div><p><strong>List</strong></p> <div class="language-python extra-class"><pre class="language-python"><code>new_list <span class="token operator">=</span> L<span class="token punctuation">[</span><span class="token punctuation">:</span><span class="token punctuation">]</span>
new_list <span class="token operator">=</span> <span class="token builtin">list</span><span class="token punctuation">(</span>L<span class="token punctuation">)</span> <span class="token comment"># copy</span>
</code></pre></div><p><strong>Set</strong></p> <div class="language-python extra-class"><pre class="language-python"><code>new_set <span class="token operator">=</span> <span class="token builtin">set</span><span class="token punctuation">(</span>L<span class="token punctuation">)</span> <span class="token comment"># convert list to set</span>
</code></pre></div><h4 id="deep-copy-vs-shallow-copy"><a href="#deep-copy-vs-shallow-copy" aria-hidden="true" class="header-anchor">#</a> Deep Copy VS Shallow Copy</h4> <div class="language-python extra-class"><pre class="language-python"><code><span class="token keyword">import</span> copy

a <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">]</span>
b <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token number">4</span><span class="token punctuation">,</span> <span class="token number">5</span><span class="token punctuation">,</span> <span class="token number">6</span><span class="token punctuation">]</span>
c <span class="token operator">=</span> <span class="token punctuation">[</span>a<span class="token punctuation">,</span> b<span class="token punctuation">]</span>
</code></pre></div><p><strong>Using normal assignment operatings to copy:</strong></p> <div class="language-python extra-class"><pre class="language-python"><code>d <span class="token operator">=</span> c

<span class="token keyword">print</span> <span class="token builtin">id</span><span class="token punctuation">(</span>c<span class="token punctuation">)</span> <span class="token operator">==</span> <span class="token builtin">id</span><span class="token punctuation">(</span>d<span class="token punctuation">)</span>          <span class="token comment"># True - d is the same object as c</span>
<span class="token keyword">print</span> <span class="token builtin">id</span><span class="token punctuation">(</span>c<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">)</span> <span class="token operator">==</span> <span class="token builtin">id</span><span class="token punctuation">(</span>d<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">)</span>    <span class="token comment"># True - d[0] is the same object as c[0]</span>
</code></pre></div><p><strong>Using a shallow copy:</strong></p> <div class="language-python extra-class"><pre class="language-python"><code>d <span class="token operator">=</span> copy<span class="token punctuation">.</span>copy<span class="token punctuation">(</span>c<span class="token punctuation">)</span>
<span class="token keyword">print</span> <span class="token builtin">id</span><span class="token punctuation">(</span>c<span class="token punctuation">)</span> <span class="token operator">==</span> <span class="token builtin">id</span><span class="token punctuation">(</span>d<span class="token punctuation">)</span>          <span class="token comment"># False - d is now a new object</span>
<span class="token keyword">print</span> <span class="token builtin">id</span><span class="token punctuation">(</span>c<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">)</span> <span class="token operator">==</span> <span class="token builtin">id</span><span class="token punctuation">(</span>d<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">)</span>    <span class="token comment"># True - d[0] is the same object as c[0]</span>
</code></pre></div><p><strong>Using a deep copy:</strong></p> <div class="language-python extra-class"><pre class="language-python"><code>d <span class="token operator">=</span> copy<span class="token punctuation">.</span>deepcopy<span class="token punctuation">(</span>c<span class="token punctuation">)</span>
<span class="token keyword">print</span> <span class="token builtin">id</span><span class="token punctuation">(</span>c<span class="token punctuation">)</span> <span class="token operator">==</span> <span class="token builtin">id</span><span class="token punctuation">(</span>d<span class="token punctuation">)</span>          <span class="token comment"># False - d is now a new object</span>
<span class="token keyword">print</span> <span class="token builtin">id</span><span class="token punctuation">(</span>c<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">)</span> <span class="token operator">==</span> <span class="token builtin">id</span><span class="token punctuation">(</span>d<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">)</span>    <span class="token comment"># False - d[0] is now a new object</span>
</code></pre></div><h3 id="performance-times"><a href="#performance-times" aria-hidden="true" class="header-anchor">#</a> Performance Times</h3> <p><strong>Way to measure</strong></p> <div class="language-python extra-class"><pre class="language-python"><code><span class="token keyword">def</span> <span class="token function">test1</span><span class="token punctuation">(</span>times <span class="token operator">=</span> <span class="token number">100</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
  <span class="token keyword">def</span> <span class="token function">test_unit</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token keyword">pass</span>

  <span class="token keyword">def</span> <span class="token function">t</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
    t0 <span class="token operator">=</span> time<span class="token punctuation">.</span>perf_counter<span class="token punctuation">(</span><span class="token punctuation">)</span>
    test_unit<span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token keyword">return</span> time<span class="token punctuation">.</span>perf_counter<span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">-</span> t0

  results <span class="token operator">=</span> <span class="token punctuation">[</span>t<span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token keyword">for</span> i <span class="token keyword">in</span> <span class="token builtin">range</span><span class="token punctuation">(</span>times<span class="token punctuation">)</span><span class="token punctuation">]</span>
  <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token builtin">sum</span><span class="token punctuation">(</span>results<span class="token punctuation">)</span> <span class="token operator">/</span> <span class="token builtin">len</span><span class="token punctuation">(</span>results<span class="token punctuation">)</span>
</code></pre></div><div class="language-python extra-class"><pre class="language-python"><code><span class="token keyword">import</span> timeit


setup_tuple <span class="token operator">=</span> <span class="token triple-quoted-string string">'''
headers = [f'col_{i}' for i in range(256)]
'''</span>
res_tuple <span class="token operator">=</span> <span class="token builtin">min</span><span class="token punctuation">(</span>timeit<span class="token punctuation">.</span>Timer<span class="token punctuation">(</span><span class="token string">'headers'</span><span class="token punctuation">,</span> setup<span class="token operator">=</span>setup_tuple<span class="token punctuation">)</span><span class="token punctuation">.</span>repeat<span class="token punctuation">(</span><span class="token number">7</span><span class="token punctuation">,</span> <span class="token number">10000</span><span class="token punctuation">)</span><span class="token punctuation">)</span>

setup_pyspark <span class="token operator">=</span> <span class="token triple-quoted-string string">'''
from pyspark.sql import Row
headers = [f'col_{i}' for i in range(252)]
Rec = Row(headers)
'''</span>
res_pyspark <span class="token operator">=</span> <span class="token builtin">min</span><span class="token punctuation">(</span>timeit<span class="token punctuation">.</span>Timer<span class="token punctuation">(</span><span class="token string">'rec = Rec(*headers)'</span><span class="token punctuation">,</span> setup<span class="token operator">=</span>setup_pyspark<span class="token punctuation">)</span><span class="token punctuation">.</span>repeat<span class="token punctuation">(</span><span class="token number">7</span><span class="token punctuation">,</span> <span class="token number">10000</span><span class="token punctuation">)</span><span class="token punctuation">)</span>


setup_nt <span class="token operator">=</span> <span class="token triple-quoted-string string">'''
from collections import namedtuple
headers = [f'col_{i}' for i in range(255)]
Rec = namedtuple(&quot;rec&quot;, headers)
'''</span>
res_nt <span class="token operator">=</span> <span class="token builtin">min</span><span class="token punctuation">(</span>timeit<span class="token punctuation">.</span>Timer<span class="token punctuation">(</span><span class="token string">'rec = Rec(*headers)'</span><span class="token punctuation">,</span> setup<span class="token operator">=</span>setup_nt<span class="token punctuation">)</span><span class="token punctuation">.</span>repeat<span class="token punctuation">(</span><span class="token number">7</span><span class="token punctuation">,</span> <span class="token number">10000</span><span class="token punctuation">)</span><span class="token punctuation">)</span>

setup_kt <span class="token operator">=</span> <span class="token triple-quoted-string string">'''
from sqlalchemy.util import KeyedTuple
headers = [f'col_{i}' for i in range(252)]
'''</span>
res_kt <span class="token operator">=</span> <span class="token builtin">min</span><span class="token punctuation">(</span>timeit<span class="token punctuation">.</span>Timer<span class="token punctuation">(</span><span class="token string">&quot;rec = KeyedTuple(headers, labels=headers)&quot;</span><span class="token punctuation">,</span> setup<span class="token operator">=</span>setup_kt<span class="token punctuation">)</span><span class="token punctuation">.</span>repeat<span class="token punctuation">(</span><span class="token number">7</span><span class="token punctuation">,</span> <span class="token number">10000</span><span class="token punctuation">)</span><span class="token punctuation">)</span>

setup_po <span class="token operator">=</span> <span class="token triple-quoted-string string">'''
import plain_obj
headers = [f'col_{i}' for i in range(252)]
Rec = plain_obj.new_type('Rec', headers)
'''</span>
res_po <span class="token operator">=</span> <span class="token builtin">min</span><span class="token punctuation">(</span>timeit<span class="token punctuation">.</span>Timer<span class="token punctuation">(</span><span class="token string">&quot;rec = Rec(*headers)&quot;</span><span class="token punctuation">,</span> setup<span class="token operator">=</span>setup_po<span class="token punctuation">)</span><span class="token punctuation">.</span>repeat<span class="token punctuation">(</span><span class="token number">7</span><span class="token punctuation">,</span> <span class="token number">10000</span><span class="token punctuation">)</span><span class="token punctuation">)</span>

setup_rec <span class="token operator">=</span> <span class="token triple-quoted-string string">'''
headers = [f'col_{i}' for i in range(252)]
class Rec:
  def __init__(self, fields, values):
    for i, field in enumerate(fields):
      setattr(self, field, values[i])
'''</span>
res_rec <span class="token operator">=</span> <span class="token builtin">min</span><span class="token punctuation">(</span>timeit<span class="token punctuation">.</span>Timer<span class="token punctuation">(</span><span class="token string">&quot;Rec(headers, headers)&quot;</span><span class="token punctuation">,</span> setup<span class="token operator">=</span>setup_rec<span class="token punctuation">)</span><span class="token punctuation">.</span>repeat<span class="token punctuation">(</span><span class="token number">7</span><span class="token punctuation">,</span> <span class="token number">10000</span><span class="token punctuation">)</span><span class="token punctuation">)</span>

<span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string-interpolation"><span class="token string">f'''
PySPark Row: </span><span class="token interpolation"><span class="token punctuation">{</span>res_pyspark<span class="token punctuation">}</span></span><span class="token string">
NamedTuple:  </span><span class="token interpolation"><span class="token punctuation">{</span>res_nt<span class="token punctuation">}</span></span><span class="token string">
KeyedTuple:  </span><span class="token interpolation"><span class="token punctuation">{</span>res_kt<span class="token punctuation">}</span></span><span class="token string">
plain_obj:  </span><span class="token interpolation"><span class="token punctuation">{</span>res_po<span class="token punctuation">}</span></span><span class="token string">
res_tuple:  </span><span class="token interpolation"><span class="token punctuation">{</span>res_tuple<span class="token punctuation">}</span></span><span class="token string">
'''</span></span><span class="token punctuation">)</span>
</code></pre></div><p>Smaller is better, three level: &lt;, &lt;&lt;, &lt;&lt;&lt;</p> <p><strong>If Order is not priority, use</strong> dict <strong>keys to store data, <em>as they write/append much faster</em> and <em>read as fast as list</em>.</strong></p> <p><strong>declare dict = declare list</strong></p> <div class="language-python extra-class"><pre class="language-python"><code>python <span class="token operator">-</span>m timeit <span class="token operator">-</span>s <span class="token string">&quot;a = {'a':2} &quot;</span>
<span class="token number">100000000</span> loops<span class="token punctuation">,</span> best of <span class="token number">3</span><span class="token punctuation">:</span> <span class="token number">0.0143</span> usec per loop

python <span class="token operator">-</span>m timeit <span class="token operator">-</span>s <span class="token string">&quot;a = ['a'] &quot;</span>
<span class="token number">100000000</span> loops<span class="token punctuation">,</span> best of <span class="token number">3</span><span class="token punctuation">:</span> <span class="token number">0.0145</span> usec per loop
</code></pre></div><p><strong>read from list &lt; read from dict</strong></p> <div class="language-python extra-class"><pre class="language-python"><code>python <span class="token operator">-</span>m timeit <span class="token operator">-</span>s <span class="token string">&quot;a = ['a'] &quot;</span> <span class="token string">&quot;a[0]&quot;</span>
<span class="token number">10000000</span> loops<span class="token punctuation">,</span> best of <span class="token number">3</span><span class="token punctuation">:</span> <span class="token number">0.0309</span> usec per loop

python <span class="token operator">-</span>m timeit <span class="token operator">-</span>s <span class="token string">&quot;a = {'a':2} &quot;</span> <span class="token string">&quot;a['a']&quot;</span>
<span class="token number">10000000</span> loops<span class="token punctuation">,</span> best of <span class="token number">3</span><span class="token punctuation">:</span> <span class="token number">0.0364</span> usec per loop
</code></pre></div><p><strong>write to dict &lt;&lt; append to list</strong></p> <div class="language-python extra-class"><pre class="language-python"><code>python <span class="token operator">-</span>m timeit <span class="token operator">-</span>s <span class="token string">&quot;a = {} &quot;</span> <span class="token string">&quot;a['a'] = 1&quot;</span> <span class="token string">&quot;a['b'] = 1&quot;</span> <span class="token string">&quot;a['c'] = 1&quot;</span> <span class="token string">&quot;a['d'] = 1&quot;</span>
<span class="token number">1000000</span> loops<span class="token punctuation">,</span> best of <span class="token number">3</span><span class="token punctuation">:</span> <span class="token number">0.224</span> usec per loop

python <span class="token operator">-</span>m timeit <span class="token operator">-</span>s <span class="token string">&quot;a = [] &quot;</span> <span class="token string">&quot;a.append('a')&quot;</span> <span class="token string">&quot;a.append('a')&quot;</span> <span class="token string">&quot;a.append('a')&quot;</span> <span class="token string">&quot;a.append('a')&quot;</span>
<span class="token number">1000000</span> loops<span class="token punctuation">,</span> best of <span class="token number">3</span><span class="token punctuation">:</span> <span class="token number">0.414</span> usec per loop
</code></pre></div><p><strong>Iterating lists &lt;&lt; xrange</strong></p> <div class="language-python extra-class"><pre class="language-python"><code>python <span class="token operator">-</span>m timeit <span class="token operator">-</span>s <span class="token string">&quot;x=[1,2,3,4,5,6,7,8]&quot;</span> <span class="token string">&quot;for i in x: i&quot;</span>
<span class="token number">1000000</span> loops<span class="token punctuation">,</span> best of <span class="token number">3</span><span class="token punctuation">:</span> <span class="token number">0.292</span> usec per loop

python <span class="token operator">-</span>m timeit <span class="token operator">-</span>s <span class="token string">&quot;x=[1,2,3,4,5,6,7,8]&quot;</span> <span class="token string">&quot;for i in xrange(len(x)): x[i]&quot;</span>
<span class="token number">1000000</span> loops<span class="token punctuation">,</span> best of <span class="token number">3</span><span class="token punctuation">:</span> <span class="token number">0.525</span> usec per loop
</code></pre></div><p><strong>Iterating tuple = iterating lists</strong></p> <div class="language-python extra-class"><pre class="language-python"><code>python <span class="token operator">-</span>m timeit <span class="token operator">-</span>s <span class="token string">&quot;x=[1,2,3,4,5,6,7,8]&quot;</span> <span class="token string">&quot;for i in x: i&quot;</span>
<span class="token number">1000000</span> loops<span class="token punctuation">,</span> best of <span class="token number">3</span><span class="token punctuation">:</span> <span class="token number">0.292</span> usec per loop

python <span class="token operator">-</span>m timeit <span class="token operator">-</span>s <span class="token string">&quot;x=(1,2,3,4,5,6,7,8)&quot;</span> <span class="token string">&quot;for i in x: i&quot;</span>
<span class="token number">1000000</span> loops<span class="token punctuation">,</span> best of <span class="token number">3</span><span class="token punctuation">:</span> <span class="token number">0.254</span> usec per loop
</code></pre></div><p><strong>Iterating lists &lt;&lt; iterating dict values</strong></p> <div class="language-python extra-class"><pre class="language-python"><code>python <span class="token operator">-</span>m timeit <span class="token operator">-</span>s <span class="token string">&quot;x=[1,2,3,4,5,6,7,8]&quot;</span> <span class="token string">&quot;for i in x: i&quot;</span>
<span class="token number">1000000</span> loops<span class="token punctuation">,</span> best of <span class="token number">3</span><span class="token punctuation">:</span> <span class="token number">0.292</span> usec per loop

python <span class="token operator">-</span>m timeit <span class="token operator">-</span>s <span class="token string">&quot;x={'a':1,'b':2,'c':3,'d':4,'e':5,'f':6,'i':7,'j':8}&quot;</span> <span class="token string">&quot;for i in x: x[i]&quot;</span>
<span class="token number">1000000</span> loops<span class="token punctuation">,</span> best of <span class="token number">3</span><span class="token punctuation">:</span> <span class="token number">0.472</span> usec per loop

python <span class="token operator">-</span>m timeit <span class="token operator">-</span>s <span class="token string">&quot;x={'a':1,'b':2,'c':3,'d':4,'e':5,'f':6,'i':7,'j':8}&quot;</span> <span class="token string">&quot;for i in x: i&quot;</span>
<span class="token number">1000000</span> loops<span class="token punctuation">,</span> best of <span class="token number">3</span><span class="token punctuation">:</span> <span class="token number">0.266</span> usec per loop
</code></pre></div><p><strong>Dict lookup &lt;&lt; list lookup</strong></p> <div class="language-python extra-class"><pre class="language-python"><code>python <span class="token operator">-</span>m timeit <span class="token operator">-</span>s <span class="token string">&quot;x={'a':1,'b':2,'c':3,'d':4,'e':5,'f':6,'i':7,'j':8}&quot;</span> <span class="token string">&quot;'a' in x&quot;</span>
<span class="token number">10000000</span> loops<span class="token punctuation">,</span> best of <span class="token number">3</span><span class="token punctuation">:</span> <span class="token number">0.0558</span> usec per loop

python <span class="token operator">-</span>m timeit <span class="token operator">-</span>s <span class="token string">&quot;x=[1,2,3,4,5,6,7,8]&quot;</span> <span class="token string">&quot;1 in x&quot;</span>
<span class="token number">10000000</span> loops<span class="token punctuation">,</span> best of <span class="token number">3</span><span class="token punctuation">:</span> <span class="token number">0.0628</span> usec per loop

python <span class="token operator">-</span>m timeit <span class="token operator">-</span>s <span class="token string">&quot;x=[1,2,3,4,5,6,7,8]&quot;</span> <span class="token string">&quot;8 in x&quot;</span>
<span class="token number">1000000</span> loops<span class="token punctuation">,</span> best of <span class="token number">3</span><span class="token punctuation">:</span> <span class="token number">0.29</span> usec per loop

python <span class="token operator">-</span>m timeit <span class="token operator">-</span>s <span class="token string">&quot;x={'a':1,'b':2,'c':3,'d':4,'e':5,'f':6,'i':7,'j':8}&quot;</span> <span class="token string">&quot;'b' in x&quot;</span>
<span class="token number">10000000</span> loops<span class="token punctuation">,</span> best of <span class="token number">3</span><span class="token punctuation">:</span> <span class="token number">0.058</span> usec per loop

python <span class="token operator">-</span>m timeit <span class="token operator">-</span>s <span class="token string">&quot;x={'a':1,'b':2,'c':3,'d':4,'e':5,'f':6,'i':7,'j':8}&quot;</span> <span class="token string">&quot;'j' in x&quot;</span>
<span class="token number">10000000</span> loops<span class="token punctuation">,</span> best of <span class="token number">3</span><span class="token punctuation">:</span> <span class="token number">0.049</span> usec per loop
</code></pre></div><h3 id="sorting"><a href="#sorting" aria-hidden="true" class="header-anchor">#</a> Sorting</h3> <p><strong>Sorting Dict by value</strong></p> <p><a href="http://stackoverflow.com/questions/613183/sort-a-python-dictionary-by-value" target="_blank" rel="noopener noreferrer">http://stackoverflow.com/questions/613183/sort-a-python-dictionary-by-value<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></p> <div class="language-python extra-class"><pre class="language-python"><code><span class="token keyword">for</span> path_ <span class="token keyword">in</span> <span class="token builtin">sorted</span><span class="token punctuation">(</span>paths<span class="token punctuation">.</span>items<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> key<span class="token operator">=</span><span class="token keyword">lambda</span> x<span class="token punctuation">:</span> x<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">,</span> reverse<span class="token operator">=</span><span class="token boolean">True</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
        path <span class="token operator">=</span> path_<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span>
        <span class="token keyword">print</span> path <span class="token operator">+</span> <span class="token string">' ['</span> <span class="token operator">+</span> <span class="token builtin">str</span><span class="token punctuation">(</span>paths<span class="token punctuation">[</span>path<span class="token punctuation">]</span><span class="token punctuation">)</span>
</code></pre></div><h2 id="collections"><a href="#collections" aria-hidden="true" class="header-anchor">#</a> Collections</h2> <p>https://docs.python.org/3/library/collections.html</p> <table><thead><tr><th>Collection</th> <th>Desciption</th></tr></thead> <tbody><tr><td>namedtuple()</td> <td>factory function for creating tuple subclasses with named fields</td></tr> <tr><td>deque</td> <td>list-like container with fast appends and pops on either end</td></tr> <tr><td>ChainMap</td> <td>dict-like class for creating a single view of multiple mappings</td></tr> <tr><td>Counter</td> <td>dict subclass for counting hashable objects</td></tr> <tr><td>OrderedDict</td> <td>dict subclass that remembers the order entries were added</td></tr> <tr><td>defaultdict</td> <td>dict subclass that calls a factory function to supply missing values</td></tr> <tr><td>UserDict</td> <td>wrapper around dictionary objects for easier dict subclassing</td></tr> <tr><td>UserList</td> <td>wrapper around list objects for easier list subclassing</td></tr> <tr><td>UserString</td> <td>wrapper around string objects for easier string subclassing</td></tr></tbody></table> <h2 id="path"><a href="#path" aria-hidden="true" class="header-anchor">#</a> Path</h2> <div class="language-python extra-class"><pre class="language-python"><code><span class="token keyword">from</span> pathlib <span class="token keyword">import</span> Path

dataset <span class="token operator">=</span> <span class="token string">'wiki_images'</span>
datasets_root <span class="token operator">=</span> Path<span class="token punctuation">(</span><span class="token string">'/path/to/datasets/'</span><span class="token punctuation">)</span>

train_path <span class="token operator">=</span> datasets_root <span class="token operator">/</span> dataset <span class="token operator">/</span> <span class="token string">'train'</span>
test_path <span class="token operator">=</span> datasets_root <span class="token operator">/</span> dataset <span class="token operator">/</span> <span class="token string">'test'</span>

<span class="token keyword">for</span> image_path <span class="token keyword">in</span> train_path<span class="token punctuation">.</span>iterdir<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token keyword">with</span> image_path<span class="token punctuation">.</span><span class="token builtin">open</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token keyword">as</span> f<span class="token punctuation">:</span> <span class="token comment"># note, open is a method of Path object</span>
        <span class="token comment"># do something with an image</span>
</code></pre></div><h2 id="date"><a href="#date" aria-hidden="true" class="header-anchor">#</a> Date</h2> <h3 id="sql-datetime"><a href="#sql-datetime" aria-hidden="true" class="header-anchor">#</a> SQL Datetime</h3> <div class="language-python extra-class"><pre class="language-python"><code>sql_date <span class="token operator">=</span> time<span class="token punctuation">.</span>strftime<span class="token punctuation">(</span><span class="token string">'%Y-%m-%d %H:%M:%S'</span><span class="token punctuation">)</span>

start_time <span class="token operator">=</span> time<span class="token punctuation">.</span>time<span class="token punctuation">(</span><span class="token punctuation">)</span>
end_time <span class="token operator">=</span> time<span class="token punctuation">.</span>time<span class="token punctuation">(</span><span class="token punctuation">)</span>
delta_time <span class="token operator">=</span> end_time <span class="token operator">-</span> start_time
</code></pre></div><h3 id="operations"><a href="#operations" aria-hidden="true" class="header-anchor">#</a> Operations</h3> <div class="language-python extra-class"><pre class="language-python"><code><span class="token operator">&gt;&gt;</span><span class="token operator">&gt;</span> <span class="token keyword">import</span> datetime
<span class="token operator">&gt;&gt;</span><span class="token operator">&gt;</span> s <span class="token operator">=</span> <span class="token string">'04/21/2013'</span>
<span class="token operator">&gt;&gt;</span><span class="token operator">&gt;</span> d <span class="token operator">=</span> datetime<span class="token punctuation">.</span>datetime<span class="token punctuation">.</span>strptime<span class="token punctuation">(</span>s<span class="token punctuation">,</span> <span class="token string">'%m/%d/%Y'</span><span class="token punctuation">)</span> <span class="token operator">+</span> datetime<span class="token punctuation">.</span>timedelta<span class="token punctuation">(</span>days<span class="token operator">=</span><span class="token number">1</span><span class="token punctuation">)</span>
packet<span class="token punctuation">[</span><span class="token string">'time'</span><span class="token punctuation">]</span> <span class="token operator">=</span> datetime<span class="token punctuation">.</span>datetime<span class="token punctuation">.</span>strptime<span class="token punctuation">(</span><span class="token string">' '</span><span class="token punctuation">.</span>join<span class="token punctuation">(</span>part1_arr<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">:</span><span class="token number">2</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token string">'%Y-%m-%d %H:%M:%S.%f'</span><span class="token punctuation">)</span>
<span class="token operator">&gt;&gt;</span><span class="token operator">&gt;</span> <span class="token keyword">print</span> d<span class="token punctuation">.</span>strftime<span class="token punctuation">(</span><span class="token string">'%m/%d/%Y'</span><span class="token punctuation">)</span>
<span class="token number">04</span><span class="token operator">/</span><span class="token number">22</span><span class="token operator">/</span><span class="token number">2013</span>

date_1 <span class="token operator">=</span> datetime<span class="token punctuation">.</span>datetime<span class="token punctuation">.</span>strptime<span class="token punctuation">(</span>start_date<span class="token punctuation">,</span> <span class="token string">&quot;%m/%d/%y&quot;</span><span class="token punctuation">)</span>
date_today <span class="token operator">=</span> datetime<span class="token punctuation">.</span>datetime<span class="token punctuation">.</span>now<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span>now<span class="token punctuation">(</span><span class="token punctuation">)</span>

posting_date <span class="token operator">=</span> datetime<span class="token punctuation">.</span>datetime<span class="token punctuation">.</span>now<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span>now<span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">-</span> datetime<span class="token punctuation">.</span>timedelta<span class="token punctuation">(</span>days<span class="token operator">=</span><span class="token builtin">int</span><span class="token punctuation">(</span>posting_date_offset<span class="token punctuation">)</span><span class="token punctuation">)</span>
self<span class="token punctuation">.</span>posting_date <span class="token operator">=</span> posting_date<span class="token punctuation">.</span>strftime<span class="token punctuation">(</span><span class="token string">'%Y-%m-%d'</span><span class="token punctuation">)</span>
</code></pre></div><h3 id="convert-to-utc"><a href="#convert-to-utc" aria-hidden="true" class="header-anchor">#</a> Convert to UTC</h3> <div class="language-python extra-class"><pre class="language-python"><code>utc_delta <span class="token operator">=</span> datetime<span class="token punctuation">.</span>datetime<span class="token punctuation">.</span>utcnow<span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">-</span> datetime<span class="token punctuation">.</span>datetime<span class="token punctuation">.</span>now<span class="token punctuation">(</span><span class="token punctuation">)</span>
time_in_utc <span class="token operator">=</span> datetime<span class="token punctuation">.</span>datetime<span class="token punctuation">.</span>now<span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">+</span> datetime<span class="token punctuation">.</span>timedelta<span class="token punctuation">(</span>seconds<span class="token operator">=</span><span class="token builtin">round</span><span class="token punctuation">(</span>utc_delta<span class="token punctuation">.</span>total_seconds<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
</code></pre></div><h2 id="file-read-write"><a href="#file-read-write" aria-hidden="true" class="header-anchor">#</a> File Read/Write</h2> <h3 id="read"><a href="#read" aria-hidden="true" class="header-anchor">#</a> Read</h3> <div class="language-python extra-class"><pre class="language-python"><code><span class="token keyword">with</span> <span class="token builtin">open</span><span class="token punctuation">(</span><span class="token string">&quot;/tmp/mining/test.txt&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;rb&quot;</span><span class="token punctuation">)</span> <span class="token keyword">as</span> fileobj<span class="token punctuation">:</span>
    <span class="token keyword">for</span> line <span class="token keyword">in</span> fileobj<span class="token punctuation">:</span>
        line <span class="token operator">=</span> line<span class="token punctuation">.</span>rstrip<span class="token punctuation">(</span><span class="token punctuation">)</span>
</code></pre></div><p><strong>Read whole file</strong></p> <div class="language-python extra-class"><pre class="language-python"><code><span class="token keyword">with</span> <span class="token builtin">open</span><span class="token punctuation">(</span><span class="token string">'Path/to/file'</span><span class="token punctuation">,</span> <span class="token string">'r'</span><span class="token punctuation">)</span> <span class="token keyword">as</span> content_file<span class="token punctuation">:</span>
    content <span class="token operator">=</span> content_file<span class="token punctuation">.</span>read<span class="token punctuation">(</span><span class="token punctuation">)</span>
</code></pre></div><p><strong>Convert to Ascii</strong></p> <div class="language-python extra-class"><pre class="language-python"><code>lines0 <span class="token operator">=</span> <span class="token builtin">open</span><span class="token punctuation">(</span>file_path<span class="token punctuation">,</span><span class="token string">'rb'</span><span class="token punctuation">)</span><span class="token punctuation">.</span>read<span class="token punctuation">(</span><span class="token punctuation">)</span>
lines <span class="token operator">=</span> lines0<span class="token punctuation">.</span>decode<span class="token punctuation">(</span><span class="token string">'utf-16-le'</span><span class="token punctuation">)</span><span class="token punctuation">.</span>encode<span class="token punctuation">(</span><span class="token string">'ascii'</span><span class="token punctuation">,</span> <span class="token string">'ignore'</span><span class="token punctuation">)</span>
</code></pre></div><h4 id="xml"><a href="#xml" aria-hidden="true" class="header-anchor">#</a> XML</h4> <p><a href="http://lxml.de/tutorial.html" target="_blank" rel="noopener noreferrer">http://lxml.de/tutorial.html<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></p> <div class="language-python extra-class"><pre class="language-python"><code><span class="token keyword">import</span> os<span class="token punctuation">,</span> lxml
<span class="token keyword">from</span> lxml <span class="token keyword">import</span> etree

<span class="token comment"># open xml</span>
xml_file_path <span class="token operator">=</span> <span class="token string">&quot;/tmp/s_email.xml&quot;</span>
xml_tree <span class="token operator">=</span> etree<span class="token punctuation">.</span>parse<span class="token punctuation">(</span>xml_file_path<span class="token punctuation">)</span>

output_file_path <span class="token operator">=</span> <span class="token string">'/tmp/data_files'</span>

data_row <span class="token operator">=</span> <span class="token punctuation">{</span><span class="token punctuation">}</span>
headers_order <span class="token operator">=</span> <span class="token punctuation">[</span>
    <span class="token string">'FOLDER'</span><span class="token punctuation">,</span>
    <span class="token string">'TYPE'</span><span class="token punctuation">,</span>
    <span class="token string">'DATABASETYPE'</span><span class="token punctuation">,</span>
    <span class="token string">'DBDNAME'</span><span class="token punctuation">,</span>
    <span class="token string">'OWNERNAME'</span><span class="token punctuation">,</span>
    <span class="token string">'NAME'</span><span class="token punctuation">,</span>
    <span class="token string">'FIELDNUMBER'</span><span class="token punctuation">,</span>
    <span class="token string">'FIELDNAME'</span><span class="token punctuation">,</span>
    <span class="token string">'DATATYPE'</span><span class="token punctuation">,</span>
    <span class="token string">'PRECISION'</span><span class="token punctuation">,</span>
    <span class="token string">'KEYTYPE'</span>
<span class="token punctuation">]</span>

data_variables <span class="token operator">=</span> <span class="token punctuation">{</span><span class="token punctuation">}</span>
<span class="token keyword">for</span> header <span class="token keyword">in</span> headers_order<span class="token punctuation">:</span>
    data_variables<span class="token punctuation">[</span>header<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token string">'v_'</span> <span class="token operator">+</span> header

<span class="token comment"># for each FOLDER</span>
<span class="token keyword">for</span> element <span class="token keyword">in</span> xml_tree<span class="token punctuation">.</span><span class="token builtin">iter</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">&quot;%s - %s&quot;</span> <span class="token operator">%</span> <span class="token punctuation">(</span>element<span class="token punctuation">.</span>tag<span class="token punctuation">,</span> element<span class="token punctuation">.</span>text<span class="token punctuation">)</span><span class="token punctuation">)</span>
    <span class="token keyword">if</span> element<span class="token punctuation">.</span>tag <span class="token operator">==</span> <span class="token string">'FOLDER'</span><span class="token punctuation">:</span> v_FOLDER <span class="token operator">=</span> element<span class="token punctuation">[</span><span class="token string">'NAME'</span><span class="token punctuation">]</span>
    <span class="token keyword">if</span> element<span class="token punctuation">.</span>tag <span class="token keyword">in</span> <span class="token punctuation">(</span><span class="token string">'SOURCE'</span><span class="token punctuation">,</span><span class="token string">'TARGET'</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
        v_TYPE <span class="token operator">=</span> element<span class="token punctuation">.</span>tag
        v_DATABASETYPE <span class="token operator">=</span> element<span class="token punctuation">[</span><span class="token string">'DATABASETYPE'</span><span class="token punctuation">]</span>
        v_DBDNAME <span class="token operator">=</span> element<span class="token punctuation">[</span><span class="token string">'DBDNAME'</span><span class="token punctuation">]</span>
        v_OWNERNAME <span class="token operator">=</span> element<span class="token punctuation">[</span><span class="token string">'OWNERNAME'</span><span class="token punctuation">]</span>
        v_NAME <span class="token operator">=</span> element<span class="token punctuation">[</span><span class="token string">'NAME'</span><span class="token punctuation">]</span>
    <span class="token keyword">if</span> element<span class="token punctuation">.</span>tag <span class="token keyword">in</span> <span class="token punctuation">(</span><span class="token string">'SOURCEFIELD'</span><span class="token punctuation">,</span><span class="token string">'TARGETFIELD'</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
        v_FIELDNUMBER <span class="token operator">=</span> element<span class="token punctuation">[</span><span class="token string">'FIELDNUMBER'</span><span class="token punctuation">]</span>
        v_FIELDNAME <span class="token operator">=</span> element<span class="token punctuation">[</span><span class="token string">'FIELDNAME'</span><span class="token punctuation">]</span>
        v_PRECISION <span class="token operator">=</span> element<span class="token punctuation">[</span><span class="token string">'PRECISION'</span><span class="token punctuation">]</span>
        v_KEYTYPE <span class="token operator">=</span> element<span class="token punctuation">[</span><span class="token string">'KEYTYPE'</span><span class="token punctuation">]</span>
</code></pre></div><h3 id="write"><a href="#write" aria-hidden="true" class="header-anchor">#</a> Write</h3> <div class="language-python extra-class"><pre class="language-python"><code><span class="token comment"># Write</span>
<span class="token comment"># Open the File</span>
target_file <span class="token operator">=</span> <span class="token builtin">open</span><span class="token punctuation">(</span>target_file_path<span class="token punctuation">,</span> <span class="token string">'w'</span><span class="token punctuation">)</span>

target_file<span class="token punctuation">.</span>write<span class="token punctuation">(</span>delimiter<span class="token punctuation">.</span>join<span class="token punctuation">(</span>line_text_array<span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token string">'\n'</span><span class="token punctuation">)</span>
target_file<span class="token punctuation">.</span>close<span class="token punctuation">(</span><span class="token punctuation">)</span>

<span class="token comment"># Append</span>
self<span class="token punctuation">.</span>log_file <span class="token operator">=</span> <span class="token builtin">open</span><span class="token punctuation">(</span>self<span class="token punctuation">.</span>log_folder_path <span class="token operator">+</span> <span class="token string">'/informatica_python_log.txt'</span><span class="token punctuation">,</span> <span class="token string">'a'</span><span class="token punctuation">)</span>
</code></pre></div><h4 id="xml-2"><a href="#xml-2" aria-hidden="true" class="header-anchor">#</a> XML</h4> <div class="language-python extra-class"><pre class="language-python"><code><span class="token keyword">def</span> <span class="token function">create_xml</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> jobs<span class="token punctuation">,</span> folder_path <span class="token operator">=</span> <span class="token string">'/data/jobs_header'</span><span class="token punctuation">)</span><span class="token punctuation">:</span>

	root <span class="token operator">=</span> etree<span class="token punctuation">.</span>Element<span class="token punctuation">(</span><span class="token string">'AllJobs'</span><span class="token punctuation">)</span>

	<span class="token keyword">for</span> key<span class="token punctuation">,</span> job <span class="token keyword">in</span> jobs<span class="token punctuation">.</span>iteritems<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
		<span class="token comment"># key is url, value is job_class</span>
		<span class="token keyword">print</span><span class="token punctuation">(</span>key <span class="token operator">+</span> <span class="token string">' '</span> <span class="token operator">+</span> job<span class="token punctuation">)</span>

		job_branch <span class="token operator">=</span> etree<span class="token punctuation">.</span>Element<span class="token punctuation">(</span><span class="token string">'job'</span><span class="token punctuation">,</span> url<span class="token operator">=</span>job<span class="token punctuation">.</span>url<span class="token punctuation">)</span>

		<span class="token comment"># get all attributes</span>
		atts <span class="token operator">=</span> <span class="token punctuation">[</span>a <span class="token keyword">for</span> a <span class="token keyword">in</span> <span class="token builtin">dir</span><span class="token punctuation">(</span>jobs<span class="token punctuation">)</span> <span class="token keyword">if</span> <span class="token keyword">not</span> a<span class="token punctuation">.</span>startswith<span class="token punctuation">(</span><span class="token string">'__'</span><span class="token punctuation">)</span> <span class="token keyword">and</span> <span class="token keyword">not</span> <span class="token builtin">callable</span><span class="token punctuation">(</span><span class="token builtin">getattr</span><span class="token punctuation">(</span>jobs<span class="token punctuation">,</span>a<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">]</span> <span class="token comment"># gets all non-function attributes of object - self in this case</span>
		<span class="token comment"># create sub-branch for each attribute</span>
		<span class="token keyword">for</span> att <span class="token keyword">in</span> atts<span class="token punctuation">:</span>
			code <span class="token operator">=</span> <span class="token string">&quot;sub_branch = etree.Element('%s')&quot;</span> <span class="token operator">%</span> <span class="token punctuation">(</span>att<span class="token punctuation">)</span>
			<span class="token keyword">exec</span> code

			code <span class="token operator">=</span> <span class="token string">&quot;sub_branch.text = job.%s&quot;</span> <span class="token operator">%</span> <span class="token punctuation">(</span>att<span class="token punctuation">)</span>
			<span class="token keyword">exec</span> code

			job_branch<span class="token punctuation">.</span>append<span class="token punctuation">(</span>sub_branch<span class="token punctuation">)</span>

		root<span class="token punctuation">.</span>append<span class="token punctuation">(</span>job_branch<span class="token punctuation">)</span>


	xml_body <span class="token operator">=</span> etree<span class="token punctuation">.</span>tostring<span class="token punctuation">(</span>root<span class="token punctuation">,</span> pretty_print<span class="token operator">=</span><span class="token boolean">True</span><span class="token punctuation">)</span>
	timestamp <span class="token operator">=</span> <span class="token string">&quot;%.5f&quot;</span> <span class="token operator">%</span> time<span class="token punctuation">.</span>time<span class="token punctuation">(</span><span class="token punctuation">)</span>
	target_file_path <span class="token operator">=</span> folder_path <span class="token operator">+</span> <span class="token string">'/'</span> <span class="token operator">+</span> self<span class="token punctuation">.</span>class_name <span class="token operator">+</span> timestamp <span class="token operator">+</span> <span class="token string">'.xml'</span>
	SaveTexttoFile<span class="token punctuation">(</span>xml_body<span class="token punctuation">.</span>encode<span class="token punctuation">(</span><span class="token string">'utf-8'</span><span class="token punctuation">)</span><span class="token punctuation">,</span> target_file_path<span class="token punctuation">)</span>
</code></pre></div><h2 id="random"><a href="#random" aria-hidden="true" class="header-anchor">#</a> Random</h2> <h3 id="numbers"><a href="#numbers" aria-hidden="true" class="header-anchor">#</a> Numbers</h3> <div class="language-python extra-class"><pre class="language-python"><code>random<span class="token punctuation">.</span>random<span class="token punctuation">(</span><span class="token punctuation">)</span>        <span class="token comment"># Random float x, 0.0 &lt;= x &lt; 1.0</span>
<span class="token number">0.37444887175646646</span>

random<span class="token punctuation">.</span>uniform<span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">10</span><span class="token punctuation">)</span>  <span class="token comment"># Random float x, 1.0 &lt;= x &lt; 10.0</span>
<span class="token number">1.1800146073117523</span>

random<span class="token punctuation">.</span>randint<span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">10</span><span class="token punctuation">)</span>  <span class="token comment"># Integer from 1 to 10, endpoints included</span>
<span class="token number">7</span>

random<span class="token punctuation">.</span>randrange<span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">101</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">)</span>  <span class="token comment"># Even integer from 0 to 100</span>
<span class="token number">26</span>

random<span class="token punctuation">.</span>choice<span class="token punctuation">(</span><span class="token string">'abcdefghij'</span><span class="token punctuation">)</span>  <span class="token comment"># Choose a random element</span>
<span class="token string">'c'</span>

items <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">,</span> <span class="token number">4</span><span class="token punctuation">,</span> <span class="token number">5</span><span class="token punctuation">,</span> <span class="token number">6</span><span class="token punctuation">,</span> <span class="token number">7</span><span class="token punctuation">]</span>
random<span class="token punctuation">.</span>shuffle<span class="token punctuation">(</span>items<span class="token punctuation">)</span>
items
<span class="token punctuation">[</span><span class="token number">7</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">,</span> <span class="token number">5</span><span class="token punctuation">,</span> <span class="token number">6</span><span class="token punctuation">,</span> <span class="token number">4</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">]</span>

random<span class="token punctuation">.</span>sample<span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">,</span> <span class="token number">4</span><span class="token punctuation">,</span> <span class="token number">5</span><span class="token punctuation">]</span><span class="token punctuation">,</span>  <span class="token number">3</span><span class="token punctuation">)</span>  <span class="token comment"># Choose 3 elements</span>
<span class="token punctuation">[</span><span class="token number">4</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">5</span><span class="token punctuation">]</span>
</code></pre></div><h3 id="strings"><a href="#strings" aria-hidden="true" class="header-anchor">#</a> Strings</h3> <div class="language-python extra-class"><pre class="language-python"><code><span class="token keyword">import</span> string<span class="token punctuation">,</span> random
N <span class="token operator">=</span> <span class="token number">6</span>
<span class="token string">''</span><span class="token punctuation">.</span>join<span class="token punctuation">(</span>random<span class="token punctuation">.</span>SystemRandom<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span>choice<span class="token punctuation">(</span>string<span class="token punctuation">.</span>ascii_uppercase <span class="token operator">+</span> string<span class="token punctuation">.</span>digits<span class="token punctuation">)</span> <span class="token keyword">for</span> _ <span class="token keyword">in</span> <span class="token builtin">range</span><span class="token punctuation">(</span>N<span class="token punctuation">)</span><span class="token punctuation">)</span>
</code></pre></div><h3 id="unicode"><a href="#unicode" aria-hidden="true" class="header-anchor">#</a> Unicode</h3> <p><strong>TypeError: Can't convert 'bytes' object to str implicitly</strong></p> <div class="language-python extra-class"><pre class="language-python"><code>ascii_string <span class="token operator">=</span> unicode_string<span class="token punctuation">.</span>decode<span class="token punctuation">(</span><span class="token string">'utf8'</span><span class="token punctuation">)</span>
unicode_string <span class="token operator">=</span> ascii_string<span class="token punctuation">.</span>encode<span class="token punctuation">(</span><span class="token string">'utf8'</span><span class="token punctuation">)</span>

ascii_string <span class="token operator">=</span> unicode_string<span class="token punctuation">.</span>encode<span class="token punctuation">(</span><span class="token string">'ascii'</span><span class="token punctuation">,</span> errors<span class="token operator">=</span><span class="token string">'replace'</span><span class="token punctuation">)</span><span class="token punctuation">.</span>decode<span class="token punctuation">(</span><span class="token string">'ascii'</span><span class="token punctuation">)</span>
</code></pre></div><h2 id="for-loop"><a href="#for-loop" aria-hidden="true" class="header-anchor">#</a> FOR Loop</h2> <h3 id="range"><a href="#range" aria-hidden="true" class="header-anchor">#</a> Range</h3> <div class="language-python extra-class"><pre class="language-python"><code><span class="token operator">&gt;&gt;</span><span class="token operator">&gt;</span> <span class="token comment"># One parameter</span>
<span class="token operator">&gt;&gt;</span><span class="token operator">&gt;</span> <span class="token keyword">for</span> i <span class="token keyword">in</span> <span class="token builtin">range</span><span class="token punctuation">(</span><span class="token number">5</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
<span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>     <span class="token keyword">print</span><span class="token punctuation">(</span>i<span class="token punctuation">)</span>
<span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>
<span class="token number">0</span>
<span class="token number">1</span>
<span class="token number">2</span>
<span class="token number">3</span>
<span class="token number">4</span>
<span class="token operator">&gt;&gt;</span><span class="token operator">&gt;</span> <span class="token comment"># Two parameters</span>
<span class="token operator">&gt;&gt;</span><span class="token operator">&gt;</span> <span class="token keyword">for</span> i <span class="token keyword">in</span> <span class="token builtin">range</span><span class="token punctuation">(</span><span class="token number">3</span><span class="token punctuation">,</span> <span class="token number">6</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
<span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>     <span class="token keyword">print</span><span class="token punctuation">(</span>i<span class="token punctuation">)</span>
<span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>
<span class="token number">3</span>
<span class="token number">4</span>
<span class="token number">5</span>
<span class="token operator">&gt;&gt;</span><span class="token operator">&gt;</span> <span class="token comment"># Three parameters</span>
<span class="token operator">&gt;&gt;</span><span class="token operator">&gt;</span> <span class="token keyword">for</span> i <span class="token keyword">in</span> <span class="token builtin">range</span><span class="token punctuation">(</span><span class="token number">4</span><span class="token punctuation">,</span> <span class="token number">10</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
<span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>     <span class="token keyword">print</span><span class="token punctuation">(</span>i<span class="token punctuation">)</span>
<span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>
<span class="token number">4</span>
<span class="token number">6</span>
<span class="token number">8</span>
<span class="token operator">&gt;&gt;</span><span class="token operator">&gt;</span> <span class="token comment"># Going backwards</span>
<span class="token operator">&gt;&gt;</span><span class="token operator">&gt;</span> <span class="token keyword">for</span> i <span class="token keyword">in</span> <span class="token builtin">range</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span> <span class="token operator">-</span><span class="token number">10</span><span class="token punctuation">,</span> <span class="token operator">-</span><span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
<span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>     <span class="token keyword">print</span><span class="token punctuation">(</span>i<span class="token punctuation">)</span>
<span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>
<span class="token number">0</span>
<span class="token operator">-</span><span class="token number">2</span>
<span class="token operator">-</span><span class="token number">4</span>
<span class="token operator">-</span><span class="token number">6</span>
<span class="token operator">-</span><span class="token number">8</span>
</code></pre></div><h3 id="lambda"><a href="#lambda" aria-hidden="true" class="header-anchor">#</a> Lambda</h3> <p><a href="http://www.secnetix.de/olli/Python/lambda_functions.hawk" target="_blank" rel="noopener noreferrer">http://www.secnetix.de/olli/Python/lambda_functions.hawk<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></p> <div class="language-python extra-class"><pre class="language-python"><code>transformation_types <span class="token operator">=</span> <span class="token punctuation">[</span>
    <span class="token punctuation">{</span>
        <span class="token string">&quot;NAME&quot;</span><span class="token punctuation">:</span><span class="token string">&quot;Source Qualifier&quot;</span><span class="token punctuation">,</span>
        <span class="token string">&quot;TABLEATTRIBUTE&quot;</span> <span class="token punctuation">:</span> <span class="token punctuation">{</span>
            <span class="token string">&quot;Sql Query&quot;</span><span class="token punctuation">:</span> <span class="token string">&quot;&quot;</span><span class="token punctuation">,</span>
            <span class="token string">&quot;User Defined Join&quot;</span><span class="token punctuation">:</span><span class="token string">&quot;&quot;</span><span class="token punctuation">,</span>
            <span class="token string">&quot;Source Filter&quot;</span><span class="token punctuation">:</span><span class="token string">&quot;&quot;</span><span class="token punctuation">,</span>
            <span class="token string">&quot;Number Of Sorted Ports&quot;</span><span class="token punctuation">:</span><span class="token string">&quot;0&quot;</span><span class="token punctuation">,</span>
            <span class="token string">&quot;Tracing Level&quot;</span><span class="token punctuation">:</span><span class="token string">&quot;Normal&quot;</span><span class="token punctuation">,</span>
            <span class="token string">&quot;Select Distinct&quot;</span><span class="token punctuation">:</span><span class="token string">&quot;NO&quot;</span><span class="token punctuation">,</span>
            <span class="token string">&quot;Is Partitionable&quot;</span><span class="token punctuation">:</span><span class="token string">&quot;NO&quot;</span><span class="token punctuation">,</span>
            <span class="token string">&quot;Pre SQL&quot;</span><span class="token punctuation">:</span><span class="token string">&quot;&quot;</span><span class="token punctuation">,</span>
            <span class="token string">&quot;Post SQL&quot;</span><span class="token punctuation">:</span><span class="token string">&quot;&quot;</span><span class="token punctuation">,</span>
            <span class="token string">&quot;Output is deterministic&quot;</span><span class="token punctuation">:</span><span class="token string">&quot;NO&quot;</span><span class="token punctuation">,</span>
            <span class="token string">&quot;Output is repeatable&quot;</span><span class="token punctuation">:</span><span class="token string">&quot;Never&quot;</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token punctuation">{</span>
        <span class="token string">&quot;NAME&quot;</span><span class="token punctuation">:</span><span class="token string">&quot;Lookup Procedure&quot;</span><span class="token punctuation">,</span>
        <span class="token string">&quot;TABLEATTRIBUTE&quot;</span> <span class="token punctuation">:</span> <span class="token punctuation">{</span>
            <span class="token string">&quot;Sql Query&quot;</span><span class="token punctuation">:</span> <span class="token string">&quot;&quot;</span><span class="token punctuation">,</span>
            <span class="token string">&quot;User Defined Join&quot;</span><span class="token punctuation">:</span><span class="token string">&quot;&quot;</span><span class="token punctuation">,</span>
            <span class="token string">&quot;Source Filter&quot;</span><span class="token punctuation">:</span><span class="token string">&quot;&quot;</span><span class="token punctuation">,</span>
            <span class="token string">&quot;Number Of Sorted Ports&quot;</span><span class="token punctuation">:</span><span class="token string">&quot;0&quot;</span><span class="token punctuation">,</span>
            <span class="token string">&quot;Tracing Level&quot;</span><span class="token punctuation">:</span><span class="token string">&quot;Normal&quot;</span><span class="token punctuation">,</span>
            <span class="token string">&quot;Select Distinct&quot;</span><span class="token punctuation">:</span><span class="token string">&quot;NO&quot;</span><span class="token punctuation">,</span>
            <span class="token string">&quot;Is Partitionable&quot;</span><span class="token punctuation">:</span><span class="token string">&quot;NO&quot;</span><span class="token punctuation">,</span>
            <span class="token string">&quot;Pre SQL&quot;</span><span class="token punctuation">:</span><span class="token string">&quot;&quot;</span><span class="token punctuation">,</span>
            <span class="token string">&quot;Post SQL&quot;</span><span class="token punctuation">:</span><span class="token string">&quot;&quot;</span><span class="token punctuation">,</span>
            <span class="token string">&quot;Output is deterministic&quot;</span><span class="token punctuation">:</span><span class="token string">&quot;NO&quot;</span><span class="token punctuation">,</span>
            <span class="token string">&quot;Output is repeatable&quot;</span><span class="token punctuation">:</span><span class="token string">&quot;Never&quot;</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
<span class="token punctuation">]</span>

<span class="token builtin">type</span> <span class="token operator">=</span> <span class="token string">&quot;Source Qualifier&quot;</span>
transformation_type_choices <span class="token operator">=</span> <span class="token punctuation">[</span>t<span class="token punctuation">[</span><span class="token string">&quot;NAME&quot;</span><span class="token punctuation">]</span> <span class="token keyword">for</span> t <span class="token keyword">in</span> transformation_types<span class="token punctuation">]</span>

<span class="token builtin">filter</span><span class="token punctuation">(</span><span class="token keyword">lambda</span> t<span class="token punctuation">:</span> t<span class="token punctuation">[</span><span class="token string">&quot;NAME&quot;</span><span class="token punctuation">]</span> <span class="token operator">==</span> <span class="token builtin">type</span><span class="token punctuation">,</span> transformation_types<span class="token punctuation">)</span><span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token string">'TABLEATTRIBUTE'</span><span class="token punctuation">]</span>

atts <span class="token operator">=</span> <span class="token punctuation">[</span>a <span class="token keyword">for</span> a <span class="token keyword">in</span> <span class="token builtin">dir</span><span class="token punctuation">(</span>self<span class="token punctuation">)</span> <span class="token keyword">if</span> <span class="token keyword">not</span> a<span class="token punctuation">.</span>startswith<span class="token punctuation">(</span><span class="token string">'__'</span><span class="token punctuation">)</span> <span class="token keyword">and</span> <span class="token keyword">not</span> <span class="token builtin">callable</span><span class="token punctuation">(</span><span class="token builtin">getattr</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span>a<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">]</span>
</code></pre></div><p><a href="http://www.python-course.eu/lambda.php" target="_blank" rel="noopener noreferrer">http://www.python-course.eu/lambda.php<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></p> <h3 id="context-manager"><a href="#context-manager" aria-hidden="true" class="header-anchor">#</a> Context Manager</h3> <p><a href="https://docs.python.org/3/library/contextlib.html" target="_blank" rel="noopener noreferrer">https://docs.python.org/3/library/contextlib.html<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></p> <div class="language-python extra-class"><pre class="language-python"><code><span class="token keyword">from</span> contextlib <span class="token keyword">import</span> contextmanager

@contextmanager
<span class="token keyword">def</span> <span class="token function">closing</span><span class="token punctuation">(</span>thing<span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token keyword">try</span><span class="token punctuation">:</span>
        <span class="token keyword">yield</span> thing
    <span class="token keyword">finally</span><span class="token punctuation">:</span>
        thing<span class="token punctuation">.</span>close<span class="token punctuation">(</span><span class="token punctuation">)</span>
</code></pre></div><h3 id="list-to-dict"><a href="#list-to-dict" aria-hidden="true" class="header-anchor">#</a> List to Dict</h3> <div class="language-python extra-class"><pre class="language-python"><code>object_dict <span class="token operator">=</span> <span class="token builtin">dict</span><span class="token punctuation">(</span><span class="token punctuation">(</span>x<span class="token punctuation">,</span> x<span class="token punctuation">)</span> <span class="token keyword">for</span> x <span class="token keyword">in</span> object_list<span class="token punctuation">)</span>
</code></pre></div><h2 id="database"><a href="#database" aria-hidden="true" class="header-anchor">#</a> Database</h2> <h3 id="sql-statement-model"><a href="#sql-statement-model" aria-hidden="true" class="header-anchor">#</a> SQL statement model</h3> <p><strong>For Insert / Replace</strong></p> <div class="language-python extra-class"><pre class="language-python"><code>sql <span class="token operator">=</span> <span class="token triple-quoted-string string">&quot;&quot;&quot;REPLACE INTO Reservations ({fields}) VALUES ({values})&quot;&quot;&quot;</span>
sql <span class="token operator">=</span> sql<span class="token punctuation">.</span><span class="token builtin">format</span><span class="token punctuation">(</span>fields<span class="token operator">=</span><span class="token string">','</span><span class="token punctuation">.</span>join<span class="token punctuation">(</span>data<span class="token punctuation">)</span><span class="token punctuation">,</span> values<span class="token operator">=</span><span class="token string">','</span><span class="token punctuation">.</span>join<span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token string">&quot;'%s'&quot;</span><span class="token punctuation">]</span><span class="token operator">*</span><span class="token builtin">len</span><span class="token punctuation">(</span>data<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token operator">%</span> <span class="token builtin">tuple</span><span class="token punctuation">(</span>data<span class="token punctuation">.</span>values<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
db_target<span class="token punctuation">.</span>query_cursor<span class="token punctuation">(</span>sql<span class="token punctuation">)</span>
</code></pre></div><p><strong>For Update</strong></p> <div class="language-python extra-class"><pre class="language-python"><code>For Update
sql <span class="token operator">=</span> <span class="token triple-quoted-string string">'''UPDATE session_stats SET {set_fields} WHERE {where_fields}'''</span>
sql <span class="token operator">=</span> sql<span class="token punctuation">.</span><span class="token builtin">format</span><span class="token punctuation">(</span>set_fields<span class="token operator">=</span><span class="token string">' = ?, '</span><span class="token punctuation">.</span>join<span class="token punctuation">(</span>session_hash<span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token string">' = ?'</span><span class="token punctuation">,</span> where_fields<span class="token operator">=</span><span class="token string">' = ? AND '</span><span class="token punctuation">.</span>join<span class="token punctuation">(</span>session_pk_fields<span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token string">' = ?'</span><span class="token punctuation">)</span>
cursor<span class="token punctuation">.</span>execute<span class="token punctuation">(</span>sql<span class="token punctuation">,</span> <span class="token builtin">tuple</span><span class="token punctuation">(</span>session_hash<span class="token punctuation">.</span>values<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token builtin">tuple</span><span class="token punctuation">(</span><span class="token punctuation">[</span>session_hash<span class="token punctuation">[</span>k<span class="token punctuation">]</span> <span class="token keyword">for</span> k <span class="token keyword">in</span> session_pk_fields<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
</code></pre></div><p><strong>For MySQL</strong></p> <div class="language-python extra-class"><pre class="language-python"><code>sql <span class="token operator">=</span> <span class="token triple-quoted-string string">&quot;&quot;&quot;INSERT INTO db1.router_traffic (`{fields}`) VALUES (&quot;{values}&quot;)&quot;&quot;&quot;</span><span class="token punctuation">.</span><span class="token builtin">format</span><span class="token punctuation">(</span>fields<span class="token operator">=</span><span class="token string">'`,`'</span><span class="token punctuation">.</span>join<span class="token punctuation">(</span>record<span class="token punctuation">)</span><span class="token punctuation">,</span> values<span class="token operator">=</span><span class="token string">'&quot;,&quot;'</span><span class="token punctuation">.</span>join<span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token string">'%s'</span><span class="token punctuation">]</span><span class="token operator">*</span><span class="token builtin">len</span><span class="token punctuation">(</span>record<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token operator">%</span> <span class="token builtin">tuple</span><span class="token punctuation">(</span>record<span class="token punctuation">.</span>values<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>



result <span class="token operator">=</span> <span class="token punctuation">{</span>
    <span class="token string">&quot;Sale_Rent&quot;</span><span class="token punctuation">:</span> Sale_Rent_result<span class="token punctuation">,</span>
    <span class="token string">&quot;Type&quot;</span><span class="token punctuation">:</span> Type_result<span class="token punctuation">,</span>
    <span class="token string">&quot;Area&quot;</span><span class="token punctuation">:</span> area_result<span class="token punctuation">,</span>
    <span class="token string">&quot;Nearby&quot;</span><span class="token punctuation">:</span> nearby_result<span class="token punctuation">,</span>
    <span class="token string">&quot;Title&quot;</span><span class="token punctuation">:</span> title_result<span class="token punctuation">,</span>
    <span class="token string">&quot;Price&quot;</span><span class="token punctuation">:</span> price_result<span class="token punctuation">,</span>
    <span class="token string">&quot;PricePerSqrFt&quot;</span><span class="token punctuation">:</span> Pricepersq_result<span class="token punctuation">,</span>
    <span class="token string">&quot;Bedroom&quot;</span><span class="token punctuation">:</span> bedroom_result<span class="token punctuation">,</span>
    <span class="token string">&quot;Agency_Fee&quot;</span><span class="token punctuation">:</span> agencyfee_result<span class="token punctuation">,</span>
    <span class="token string">&quot;Bathroom&quot;</span><span class="token punctuation">:</span> bathroom_result<span class="token punctuation">,</span>
    <span class="token string">&quot;Size&quot;</span><span class="token punctuation">:</span> size_result<span class="token punctuation">,</span>
    <span class="token string">&quot;ZonedFor&quot;</span><span class="token punctuation">:</span> Zoned_for_result<span class="token punctuation">,</span>
    <span class="token string">&quot;Freehold&quot;</span><span class="token punctuation">:</span> Freehold_result<span class="token punctuation">,</span>
    <span class="token string">&quot;Prop_ref&quot;</span><span class="token punctuation">:</span> propertyref_result<span class="token punctuation">,</span>
    <span class="token string">&quot;Furnished_status&quot;</span><span class="token punctuation">:</span> furnished_result<span class="token punctuation">,</span>
    <span class="token string">&quot;Rent_payment&quot;</span><span class="token punctuation">:</span> rent_is_paid_result<span class="token punctuation">,</span>
    <span class="token string">&quot;Building_info&quot;</span><span class="token punctuation">:</span> building_result<span class="token punctuation">,</span>
    <span class="token string">&quot;Amenities&quot;</span><span class="token punctuation">:</span> Amenities_result<span class="token punctuation">,</span>
    <span class="token string">&quot;Trade_name&quot;</span><span class="token punctuation">:</span> tradename_result<span class="token punctuation">,</span>
    <span class="token string">&quot;Licence&quot;</span><span class="token punctuation">:</span> licencenum_result<span class="token punctuation">,</span>
    <span class="token string">&quot;RERA_ID&quot;</span><span class="token punctuation">:</span> reraid_result<span class="token punctuation">,</span>
    <span class="token string">&quot;Phone_info&quot;</span><span class="token punctuation">:</span> phone_result<span class="token punctuation">,</span>
    <span class="token string">&quot;Short_link&quot;</span><span class="token punctuation">:</span> link_result<span class="token punctuation">,</span>
<span class="token punctuation">}</span>

db<span class="token operator">=</span> MySQLdb<span class="token punctuation">.</span>connect<span class="token punctuation">(</span><span class="token string">&quot;localhost&quot;</span><span class="token punctuation">,</span><span class="token string">&quot;XXX&quot;</span><span class="token punctuation">,</span><span class="token string">&quot;XXX&quot;</span><span class="token punctuation">,</span><span class="token string">&quot;hmm_Raw_Data&quot;</span><span class="token punctuation">)</span>
cursor<span class="token operator">=</span>db<span class="token punctuation">.</span>cursor<span class="token punctuation">(</span><span class="token punctuation">)</span>


<span class="token comment">#checking phase to stop scrapping</span>


sql <span class="token operator">=</span> <span class="token triple-quoted-string string">&quot;&quot;&quot;SELECT Short_link FROM RentalWanted WHERE Short_link=%s&quot;&quot;&quot;</span>

rows <span class="token operator">=</span> cursor<span class="token punctuation">.</span>execute<span class="token punctuation">(</span>sql<span class="token punctuation">,</span><span class="token punctuation">(</span>result<span class="token punctuation">[</span><span class="token string">&quot;Short_link&quot;</span><span class="token punctuation">]</span><span class="token punctuation">,</span><span class="token punctuation">)</span><span class="token punctuation">)</span>

<span class="token keyword">if</span> rows<span class="token operator">&gt;=</span><span class="token number">1</span><span class="token punctuation">:</span>
    duplicate_count<span class="token operator">+=</span><span class="token number">1</span>
    <span class="token keyword">print</span> duplicate_count

    <span class="token comment"># if duplicate_count&gt;=15:</span>
    <span class="token comment">#   print &quot;The program has started getting duplicates now- The program is terminating&quot;</span>
    <span class="token comment">#   sys.exit()</span>
<span class="token keyword">else</span><span class="token punctuation">:</span>
    query <span class="token operator">=</span> <span class="token triple-quoted-string string">&quot;&quot;&quot;INSERT INTO RentalWanted (&quot;{fields}&quot;) VALUES (&quot;{values}&quot;)&quot;&quot;&quot;</span>
    query <span class="token operator">=</span> query<span class="token punctuation">.</span><span class="token builtin">format</span><span class="token punctuation">(</span>fields<span class="token operator">=</span><span class="token string">'&quot;,&quot;'</span><span class="token punctuation">.</span>join<span class="token punctuation">(</span>result<span class="token punctuation">)</span><span class="token punctuation">,</span> values<span class="token operator">=</span><span class="token string">'&quot;,&quot;'</span><span class="token punctuation">.</span>join<span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token string">'%s'</span><span class="token punctuation">]</span><span class="token operator">*</span><span class="token builtin">len</span><span class="token punctuation">(</span>result<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
    cursor<span class="token punctuation">.</span>execute<span class="token punctuation">(</span>query <span class="token operator">%</span> <span class="token builtin">tuple</span><span class="token punctuation">(</span>result<span class="token punctuation">.</span>values<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span>

db<span class="token punctuation">.</span>commit<span class="token punctuation">(</span><span class="token punctuation">)</span>
cursor<span class="token punctuation">.</span>close<span class="token punctuation">(</span><span class="token punctuation">)</span>
db<span class="token punctuation">.</span>close<span class="token punctuation">(</span><span class="token punctuation">)</span>
</code></pre></div><h4 id="for-postgres"><a href="#for-postgres" aria-hidden="true" class="header-anchor">#</a> For Postgres</h4> <div class="language-python extra-class"><pre class="language-python"><code>sql_upsert <span class="token operator">=</span> <span class="token triple-quoted-string string">'''
INSERT INTO {table} ({fields})
VALUES ({fields_values})
ON CONFLICT ({primary_key})
DO UPDATE
SET {fields_equal_key}
'''</span>

no_space <span class="token operator">=</span> <span class="token keyword">lambda</span> x<span class="token punctuation">:</span> x<span class="token punctuation">.</span>replace<span class="token punctuation">(</span><span class="token string">' '</span><span class="token punctuation">,</span> <span class="token string">'_'</span><span class="token punctuation">)</span><span class="token punctuation">.</span>replace<span class="token punctuation">(</span><span class="token string">'/'</span><span class="token punctuation">,</span><span class="token string">'_'</span><span class="token punctuation">)</span><span class="token punctuation">.</span>replace<span class="token punctuation">(</span><span class="token string">'-'</span><span class="token punctuation">,</span><span class="token string">'_'</span><span class="token punctuation">)</span><span class="token punctuation">.</span>replace<span class="token punctuation">(</span><span class="token string">'&amp;'</span><span class="token punctuation">,</span><span class="token string">'_'</span><span class="token punctuation">)</span>
q <span class="token operator">=</span> <span class="token keyword">lambda</span> x<span class="token punctuation">:</span> <span class="token string">'&quot;'</span> <span class="token operator">+</span> x <span class="token operator">+</span> <span class="token string">'&quot;'</span>

result <span class="token operator">=</span> conn<span class="token punctuation">.</span>execute<span class="token punctuation">(</span>text<span class="token punctuation">(</span>sql_upsert<span class="token punctuation">.</span><span class="token builtin">format</span><span class="token punctuation">(</span>
    table<span class="token operator">=</span><span class="token string">'schema.table'</span><span class="token punctuation">,</span>
    fields<span class="token operator">=</span><span class="token string">','</span><span class="token punctuation">.</span>join<span class="token punctuation">(</span><span class="token punctuation">[</span>q<span class="token punctuation">(</span>no_space<span class="token punctuation">(</span>h<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token keyword">for</span> h <span class="token keyword">in</span> headers<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
    fields_values<span class="token operator">=</span><span class="token string">','</span><span class="token punctuation">.</span>join<span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token string">&quot;:&quot;</span> <span class="token operator">+</span> no_space<span class="token punctuation">(</span>h<span class="token punctuation">)</span> <span class="token keyword">for</span> h <span class="token keyword">in</span> headers<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
    primary_key<span class="token operator">=</span><span class="token string">','</span><span class="token punctuation">.</span>join<span class="token punctuation">(</span><span class="token string">'&quot;COL1&quot; &quot;COL1&quot;'</span><span class="token punctuation">.</span>split<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
    fields_equal_key<span class="token operator">=</span><span class="token string">','</span><span class="token punctuation">.</span>join<span class="token punctuation">(</span><span class="token punctuation">[</span>q<span class="token punctuation">(</span>no_space<span class="token punctuation">(</span>h<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token string">&quot;=:&quot;</span> <span class="token operator">+</span> no_space<span class="token punctuation">(</span>h<span class="token punctuation">)</span> <span class="token keyword">for</span> h <span class="token keyword">in</span> headers<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
  <span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token operator">**</span>record<span class="token punctuation">)</span>
</code></pre></div><h3 id="import-from-csv"><a href="#import-from-csv" aria-hidden="true" class="header-anchor">#</a> Import from CSV</h3> <div class="language-python extra-class"><pre class="language-python"><code><span class="token keyword">import</span> pandas <span class="token keyword">as</span> pd
df <span class="token operator">=</span> pd<span class="token punctuation">.</span>read_csv<span class="token punctuation">(</span><span class="token string">'mypath.csv'</span><span class="token punctuation">)</span>
df<span class="token punctuation">.</span>columns <span class="token operator">=</span> <span class="token punctuation">[</span>c<span class="token punctuation">.</span>lower<span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token keyword">for</span> c <span class="token keyword">in</span> df<span class="token punctuation">.</span>columns<span class="token punctuation">]</span>

<span class="token keyword">from</span> sqlalchemy <span class="token keyword">import</span> create_engine
engine <span class="token operator">=</span> create_engine<span class="token punctuation">(</span><span class="token string">'postgresql://username:password@localhost:5432/dbname'</span><span class="token punctuation">)</span>

df<span class="token punctuation">.</span>to_sql<span class="token punctuation">(</span><span class="token string">&quot;fhrs&quot;</span><span class="token punctuation">,</span> engine<span class="token punctuation">)</span>
</code></pre></div><h3 id="install-mysql-connector"><a href="#install-mysql-connector" aria-hidden="true" class="header-anchor">#</a> Install MySQL Connector</h3> <p><strong>GO HERE:</strong> <a href="https://dev.mysql.com/downloads/connector/python/" target="_blank" rel="noopener noreferrer">https://dev.mysql.com/downloads/connector/python/<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></p> <p><strong>For Ubuntu</strong></p> <p>Starting with a vanilla Lucid install [1], install pip and upgrade to the latest version:</p> <div class="language-bash extra-class"><pre class="language-bash"><code><span class="token function">apt-get</span> <span class="token function">install</span> python-pip

pip <span class="token function">install</span> -U pip
</code></pre></div><p>Next, install the required development packages:</p> <div class="language-bash extra-class"><pre class="language-bash"><code><span class="token function">apt-get</span> <span class="token function">install</span> -y python-dev libmysqlclient-dev gcc mysql-devel mysql-common mysql-libs

<span class="token function">sudo</span> <span class="token function">apt-get</span> <span class="token function">install</span> libmysqlclient-dev
</code></pre></div><p>OR</p> <div class="language-bash extra-class"><pre class="language-bash"><code>yum <span class="token function">install</span> -y python-devel mysql-devel

yum <span class="token function">install</span> -y mysql mysql-devel mysql-common mysql-libs gcc
</code></pre></div><p>then</p> <div class="language-bash extra-class"><pre class="language-bash"><code>pip <span class="token function">install</span> MySQL-python

pip <span class="token function">install</span> mysql-connector-python --allow-external mysql-connector-python
</code></pre></div><p><strong>Alternate</strong></p> <div class="language-bash extra-class"><pre class="language-bash"><code><span class="token function">git</span> clone https://github.com/mysql/mysql-connector-python.git

<span class="token function">cd</span> mysql-connector-python

python ./setup.py build

<span class="token function">sudo</span> python ./setup.py <span class="token function">install</span>
</code></pre></div><h3 id="orm"><a href="#orm" aria-hidden="true" class="header-anchor">#</a> ORM</h3> <p><a href="http://www.fullstackpython.com/object-relational-mappers-orms.html" target="_blank" rel="noopener noreferrer">http://www.fullstackpython.com/object-relational-mappers-orms.html<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></p> <p>ORMs (Object Relational Mapper) provide a high-level abstraction upon a relational database that allows a developer to write Python code instead of SQL to create, read, update and delete data and schemas in their database. Developers can use the programming language they are comfortable with to work with a database instead of writing SQL statements or stored procedures.</p> <p>ORM Libraries:</p> <ul><li>The Django ORM</li> <li>SQLAlchemy</li> <li>Peewee</li> <li>PonyORM</li> <li>SQLObject</li></ul> <h3 id="sqlite"><a href="#sqlite" aria-hidden="true" class="header-anchor">#</a> SQLite</h3> <h4 id="insert-auto-type-conversion"><a href="#insert-auto-type-conversion" aria-hidden="true" class="header-anchor">#</a> Insert Auto-Type Conversion</h4> <div class="language-python extra-class"><pre class="language-python"><code><span class="token keyword">def</span> <span class="token function">extract_insert</span><span class="token punctuation">(</span>text<span class="token punctuation">,</span> cursor<span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token keyword">if</span> <span class="token string">'\n'</span> <span class="token keyword">in</span> text<span class="token punctuation">:</span> text <span class="token operator">=</span> text<span class="token punctuation">.</span>splitlines<span class="token punctuation">(</span><span class="token punctuation">)</span>
    result_hash <span class="token operator">=</span> <span class="token punctuation">{</span><span class="token punctuation">}</span>
    key <span class="token operator">=</span> <span class="token boolean">None</span>
    <span class="token keyword">for</span> line <span class="token keyword">in</span> text<span class="token punctuation">:</span>
        <span class="token keyword">if</span> <span class="token string">': ['</span> <span class="token keyword">in</span> line <span class="token keyword">and</span> line<span class="token punctuation">[</span><span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">:</span><span class="token punctuation">]</span> <span class="token operator">==</span> <span class="token string">&quot;]&quot;</span><span class="token punctuation">:</span>
            arr <span class="token operator">=</span> line<span class="token punctuation">.</span>split<span class="token punctuation">(</span><span class="token string">': ['</span><span class="token punctuation">)</span>
            key <span class="token operator">=</span> arr<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">.</span>replace<span class="token punctuation">(</span><span class="token string">&quot; &quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;_&quot;</span><span class="token punctuation">)</span>
            result_hash<span class="token punctuation">[</span>key<span class="token punctuation">]</span> <span class="token operator">=</span> arr<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">.</span>replace<span class="token punctuation">(</span><span class="token string">&quot;]&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;&quot;</span><span class="token punctuation">)</span>
            key <span class="token operator">=</span> <span class="token boolean">None</span>
        <span class="token keyword">elif</span> <span class="token string">': ['</span> <span class="token keyword">in</span> line <span class="token keyword">and</span> line<span class="token punctuation">[</span><span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">:</span><span class="token punctuation">]</span> <span class="token operator">!=</span> <span class="token string">&quot;]&quot;</span><span class="token punctuation">:</span>
            arr <span class="token operator">=</span> line<span class="token punctuation">.</span>split<span class="token punctuation">(</span><span class="token string">': ['</span><span class="token punctuation">)</span>
            key <span class="token operator">=</span> arr<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">.</span>replace<span class="token punctuation">(</span><span class="token string">&quot; &quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;_&quot;</span><span class="token punctuation">)</span>
            result_hash<span class="token punctuation">[</span>key<span class="token punctuation">]</span> <span class="token operator">=</span> arr<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span>
        <span class="token keyword">elif</span> key <span class="token operator">!=</span> <span class="token boolean">None</span><span class="token punctuation">:</span>
            result_hash<span class="token punctuation">[</span>key<span class="token punctuation">]</span> <span class="token operator">=</span> result_hash<span class="token punctuation">[</span>key<span class="token punctuation">]</span> <span class="token operator">+</span> <span class="token string">'\n'</span> <span class="token operator">+</span> line


    result_hash<span class="token punctuation">[</span><span class="token string">&quot;Start_time&quot;</span><span class="token punctuation">]</span> <span class="token operator">=</span> to_sql_datetime<span class="token punctuation">(</span>result_hash<span class="token punctuation">[</span><span class="token string">&quot;Start_time&quot;</span><span class="token punctuation">]</span><span class="token punctuation">)</span>
    result_hash<span class="token punctuation">[</span><span class="token string">&quot;End_time&quot;</span><span class="token punctuation">]</span> <span class="token operator">=</span> to_sql_datetime<span class="token punctuation">(</span>result_hash<span class="token punctuation">[</span><span class="token string">&quot;End_time&quot;</span><span class="token punctuation">]</span><span class="token punctuation">)</span>

    sql <span class="token operator">=</span> <span class="token triple-quoted-string string">'''REPLACE INTO workflow_stats (&quot;{fields}&quot;) VALUES ({values})'''</span>
    sql <span class="token operator">=</span> sql<span class="token punctuation">.</span><span class="token builtin">format</span><span class="token punctuation">(</span>fields<span class="token operator">=</span><span class="token string">'&quot;,&quot;'</span><span class="token punctuation">.</span>join<span class="token punctuation">(</span>result_hash<span class="token punctuation">)</span><span class="token punctuation">,</span> values<span class="token operator">=</span><span class="token string">', '</span><span class="token punctuation">.</span>join<span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token string">'?'</span><span class="token punctuation">]</span><span class="token operator">*</span><span class="token builtin">len</span><span class="token punctuation">(</span>result_hash<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
    cursor<span class="token punctuation">.</span>execute<span class="token punctuation">(</span>sql<span class="token punctuation">,</span> <span class="token builtin">tuple</span><span class="token punctuation">(</span>result_hash<span class="token punctuation">.</span>values<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
</code></pre></div><h4 id="select"><a href="#select" aria-hidden="true" class="header-anchor">#</a> Select</h4> <div class="language-python extra-class"><pre class="language-python"><code><span class="token comment"># print column names</span>
c<span class="token punctuation">.</span>execute<span class="token punctuation">(</span><span class="token string">&quot;SELECT * FROM my_db&quot;</span><span class="token punctuation">)</span>
col_name_list <span class="token operator">=</span> <span class="token punctuation">[</span>tup<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span> <span class="token keyword">for</span> tup <span class="token keyword">in</span> c<span class="token punctuation">.</span>description<span class="token punctuation">]</span>
<span class="token keyword">print</span> col_name_list

<span class="token comment"># print all lines ordered by integer value in my_var2</span>
<span class="token keyword">for</span> row <span class="token keyword">in</span> c<span class="token punctuation">.</span>execute<span class="token punctuation">(</span><span class="token string">'SELECT * FROM my_db ORDER BY my_var2'</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token keyword">print</span> row

<span class="token comment"># print all lines that have &quot;YES&quot; as my_var1 value</span>
<span class="token comment"># and have an integer value &lt;= 7 in my_var2</span>
t <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token string">'YES'</span><span class="token punctuation">,</span><span class="token number">7</span><span class="token punctuation">,</span><span class="token punctuation">)</span>
<span class="token keyword">for</span> row <span class="token keyword">in</span> c<span class="token punctuation">.</span>execute<span class="token punctuation">(</span><span class="token string">'SELECT * FROM my_db WHERE my_var1=? AND my_var2 &lt;= ?'</span><span class="token punctuation">,</span> t<span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token keyword">print</span> row

<span class="token comment"># print all lines that have &quot;YES&quot; as my_var1 value</span>
<span class="token comment"># and have an integer value &lt;= 7 in my_var2</span>
t <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token string">'YES'</span><span class="token punctuation">,</span><span class="token number">7</span><span class="token punctuation">,</span><span class="token punctuation">)</span>
c<span class="token punctuation">.</span>execute<span class="token punctuation">(</span><span class="token string">'SELECT * FROM my_db WHERE my_var1=? AND my_var2 &lt;= ?'</span><span class="token punctuation">,</span> t<span class="token punctuation">)</span>
rows <span class="token operator">=</span> c<span class="token punctuation">.</span>fetchall<span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token keyword">for</span> r <span class="token keyword">in</span> rows<span class="token punctuation">:</span>
    <span class="token keyword">print</span> r
</code></pre></div><h2 id="system"><a href="#system" aria-hidden="true" class="header-anchor">#</a> System</h2> <h3 id="progress-bar"><a href="#progress-bar" aria-hidden="true" class="header-anchor">#</a> Progress bar:</h3> <div class="language-python extra-class"><pre class="language-python"><code><span class="token keyword">from</span> tqdm <span class="token keyword">import</span> tqdm
<span class="token keyword">for</span> i <span class="token keyword">in</span> tqdm<span class="token punctuation">(</span><span class="token builtin">range</span><span class="token punctuation">(</span><span class="token number">10000</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
</code></pre></div><p>OR</p> <div class="language-python extra-class"><pre class="language-python"><code>status<span class="token operator">=</span><span class="token string">'{}% complete\r'</span><span class="token punctuation">.</span><span class="token builtin">format</span><span class="token punctuation">(</span><span class="token builtin">int</span><span class="token punctuation">(</span>i<span class="token operator">*</span><span class="token number">100</span><span class="token operator">/</span><span class="token builtin">len</span><span class="token punctuation">(</span>list0<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
sys<span class="token punctuation">.</span>stdout<span class="token punctuation">.</span>write<span class="token punctuation">(</span><span class="token string">'\r'</span><span class="token operator">+</span>status<span class="token punctuation">)</span>
sys<span class="token punctuation">.</span>stdout<span class="token punctuation">.</span>flush<span class="token punctuation">(</span><span class="token punctuation">)</span>
</code></pre></div><h3 id="concurrent-processing"><a href="#concurrent-processing" aria-hidden="true" class="header-anchor">#</a> Concurrent Processing</h3> <p>Example:</p> <div class="language-python extra-class"><pre class="language-python"><code><span class="token keyword">import</span> concurrent<span class="token punctuation">.</span>futures
<span class="token keyword">from</span> multiprocessing<span class="token punctuation">.</span>pool <span class="token keyword">import</span> ThreadPool
<span class="token keyword">from</span> concurrent<span class="token punctuation">.</span>futures <span class="token keyword">import</span> ThreadPoolExecutor<span class="token punctuation">,</span> ProcessPoolExecutor
<span class="token keyword">from</span> multiprocessing <span class="token keyword">import</span> Pool<span class="token punctuation">,</span> Manager

<span class="token keyword">def</span> <span class="token function">collect</span><span class="token punctuation">(</span>df<span class="token punctuation">)</span><span class="token punctuation">:</span>
  <span class="token keyword">for</span> i<span class="token punctuation">,</span> col <span class="token keyword">in</span> <span class="token builtin">enumerate</span><span class="token punctuation">(</span>df<span class="token punctuation">.</span>columns<span class="token punctuation">)</span><span class="token punctuation">:</span>
    df1 <span class="token operator">=</span> df<span class="token punctuation">[</span><span class="token punctuation">[</span>col<span class="token punctuation">]</span><span class="token punctuation">]</span>
    <span class="token comment"># df1 = df.iloc[:, i]</span>
    <span class="token keyword">yield</span> <span class="token punctuation">(</span>df1<span class="token punctuation">,</span> col<span class="token punctuation">,</span> fields_types<span class="token punctuation">,</span> samples_n<span class="token punctuation">)</span>

<span class="token comment">## Traditional Pool ##</span>
pool <span class="token operator">=</span> Pool<span class="token punctuation">(</span>workers<span class="token punctuation">)</span>
<span class="token keyword">for</span> i<span class="token punctuation">,</span> rec_dict <span class="token keyword">in</span> <span class="token builtin">enumerate</span><span class="token punctuation">(</span>pool<span class="token punctuation">.</span>imap<span class="token punctuation">(</span>process_one_field<span class="token punctuation">,</span> collect<span class="token punctuation">(</span>df<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
  pprogress<span class="token punctuation">(</span>i<span class="token operator">+</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token builtin">len</span><span class="token punctuation">(</span>df<span class="token punctuation">.</span>columns<span class="token punctuation">)</span><span class="token punctuation">,</span> show_time<span class="token operator">=</span><span class="token boolean">False</span><span class="token punctuation">)</span>
  field <span class="token operator">=</span> rec_dict<span class="token punctuation">[</span><span class="token string">'field'</span><span class="token punctuation">]</span>
  fields_dict<span class="token punctuation">[</span>field<span class="token punctuation">]</span> <span class="token operator">=</span> rec_dict


<span class="token comment">### Same as above ##</span>
<span class="token comment"># with ProcessPoolExecutor(workers) as pool:</span>
<span class="token comment">#   threads = [pool.submit(process_one_field, args) for args in collect(df)]</span>

<span class="token comment"># for i, thread in enumerate(threads):</span>
<span class="token comment">#   rec_dict = thread.result()</span>
<span class="token comment">#   pprogress(i+1, len(df.columns), show_time=False)</span>
<span class="token comment">#   field = rec_dict['field']</span>
<span class="token comment">#   fields_dict[field] = rec_dict</span>

<span class="token comment">### Does not work fast due to GIL ! ##</span>
<span class="token comment"># with ThreadPoolExecutor(workers) as pool:</span>
<span class="token comment">#   threads = [pool.submit(process_one_field, args) for args in collect(df)]</span>

<span class="token comment"># for i, thread in enumerate(threads):</span>
<span class="token comment">#   rec_dict = thread.result()</span>
<span class="token comment">#   pprogress(i+1, len(df.columns), show_time=False)</span>
<span class="token comment">#   field = rec_dict['field']</span>
<span class="token comment">#   fields_dict[field] = rec_dict</span>
</code></pre></div><h4 id="multiprocessing"><a href="#multiprocessing" aria-hidden="true" class="header-anchor">#</a> Multiprocessing</h4> <p><strong>Pros</strong></p> <ul><li><p>Separate memory space</p></li> <li><p>Code is usually straightforward</p></li> <li><p>Takes advantage of multiple CPUs &amp; cores</p></li> <li><p>Avoids GIL limitations for cPython</p></li> <li><p>Eliminates most needs for synchronization primitives unless if you use shared memory (instead, it's more of a communication odel for IPC)</p></li> <li><p>Child processes are interruptible/killable</p></li> <li><p>Python multiprocessing module includes useful abstractions with an interface much like threading.Thread</p></li> <li><p>A must with cPython for CPU-bound processing</p></li></ul> <p><strong>Cons</strong></p> <ul><li>IPC a little more complicated with more overhead (communication model vs. shared memory/objects)</li> <li>Larger memory footprint</li></ul> <h4 id="threading"><a href="#threading" aria-hidden="true" class="header-anchor">#</a> Threading</h4> <p><strong>Pros</strong></p> <ul><li>Lightweight - low memory footprint</li> <li>Shared memory - makes access to state from another context easier</li> <li>Allows you to easily make responsive UIs</li> <li>cPython C extension modules that properly release the GIL will run in parallel</li> <li>Great option for I/O-bound applications</li></ul> <p><strong>Cons</strong></p> <ul><li><p>cPython - subject to the GIL</p></li> <li><p>Not interruptible/killable</p></li> <li><p>If not following a command queue/message pump model (using the Queue module), then manual use of synchronization primitives ecome a necessity (decisions are needed for the granularity of locking)</p></li> <li><p>Code is usually harder to understand and to get right - the potential for race conditions increases dramatically</p></li></ul> <h3 id="performance"><a href="#performance" aria-hidden="true" class="header-anchor">#</a> Performance</h3> <p>Windows PowerShell:</p> <div class="language-powershell extra-class"><pre class="language-powershell"><code><span class="token function">Measure-Command</span> <span class="token punctuation">{</span>python script<span class="token punctuation">.</span>py<span class="token punctuation">}</span>
</code></pre></div><p>Linux:</p> <div class="language-bash extra-class"><pre class="language-bash"><code><span class="token function">time</span> python script.py
</code></pre></div><h3 id="directory"><a href="#directory" aria-hidden="true" class="header-anchor">#</a> Directory</h3> <div class="language-python extra-class"><pre class="language-python"><code><span class="token keyword">import</span> os

list_of_files <span class="token operator">=</span> os<span class="token punctuation">.</span>listdir<span class="token punctuation">(</span><span class="token string">&quot;C:\\temp&quot;</span><span class="token punctuation">)</span>
<span class="token keyword">for</span> filename <span class="token keyword">in</span> list_of_files<span class="token punctuation">:</span>
    <span class="token keyword">print</span>  filename
</code></pre></div><h4 id="check-existing-make"><a href="#check-existing-make" aria-hidden="true" class="header-anchor">#</a> Check existing / Make</h4> <div class="language-python extra-class"><pre class="language-python"><code><span class="token keyword">if</span> <span class="token keyword">not</span> os<span class="token punctuation">.</span>path<span class="token punctuation">.</span>exists<span class="token punctuation">(</span>folder_path<span class="token punctuation">)</span><span class="token punctuation">:</span> os<span class="token punctuation">.</span>makedirs<span class="token punctuation">(</span>folder_path<span class="token punctuation">)</span>
</code></pre></div><h4 id="delete-all-files-in-folder"><a href="#delete-all-files-in-folder" aria-hidden="true" class="header-anchor">#</a> Delete all files in folder:</h4> <div class="language-python extra-class"><pre class="language-python"><code><span class="token keyword">import</span> glob
<span class="token keyword">for</span> f <span class="token keyword">in</span> glob<span class="token punctuation">.</span>glob<span class="token punctuation">(</span>params_mapping_passthrough<span class="token punctuation">[</span><span class="token string">'xml_new_files_folder_path'</span><span class="token punctuation">]</span> <span class="token operator">+</span> <span class="token string">'/*'</span><span class="token punctuation">)</span><span class="token punctuation">:</span> os<span class="token punctuation">.</span>remove<span class="token punctuation">(</span>f<span class="token punctuation">)</span>
</code></pre></div><h3 id="file-exists"><a href="#file-exists" aria-hidden="true" class="header-anchor">#</a> File Exists</h3> <div class="language-python extra-class"><pre class="language-python"><code><span class="token keyword">if</span> os<span class="token punctuation">.</span>path<span class="token punctuation">.</span>isfile<span class="token punctuation">(</span>file_path<span class="token punctuation">)</span><span class="token punctuation">:</span>
</code></pre></div><h3 id="delete-file"><a href="#delete-file" aria-hidden="true" class="header-anchor">#</a> Delete File</h3> <div class="language-python extra-class"><pre class="language-python"><code>os<span class="token punctuation">.</span>remove<span class="token punctuation">(</span>f<span class="token punctuation">)</span>
</code></pre></div><h3 id="environment-path"><a href="#environment-path" aria-hidden="true" class="header-anchor">#</a> Environment Path</h3> <div class="language-python extra-class"><pre class="language-python"><code><span class="token keyword">import</span> os
os<span class="token punctuation">.</span>environ<span class="token punctuation">[</span><span class="token string">&quot;PATH&quot;</span><span class="token punctuation">]</span> <span class="token operator">+=</span> os<span class="token punctuation">.</span>pathsep <span class="token operator">+</span> <span class="token string">&quot;;/client/bin&quot;</span>
</code></pre></div><p><strong>Change Current Directory</strong></p> <div class="language-python extra-class"><pre class="language-python"><code>os<span class="token punctuation">.</span>chdir<span class="token punctuation">(</span>path<span class="token punctuation">)</span>
</code></pre></div><h3 id="stdin-stdout"><a href="#stdin-stdout" aria-hidden="true" class="header-anchor">#</a> stdin / stdout</h3> <div class="language-python extra-class"><pre class="language-python"><code><span class="token keyword">import</span> sys
<span class="token keyword">for</span> line <span class="token keyword">in</span> sys<span class="token punctuation">.</span>stdin<span class="token punctuation">:</span>
    <span class="token keyword">print</span> line
</code></pre></div><h3 id="command-line-arguments"><a href="#command-line-arguments" aria-hidden="true" class="header-anchor">#</a> Command Line Arguments</h3> <p><a href="https://docs.python.org/2/library/argparse.html#module-argparse" target="_blank" rel="noopener noreferrer">https://docs.python.org/2/library/argparse.html#module-argparse<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></p> <div class="language-python extra-class"><pre class="language-python"><code><span class="token keyword">import</span> argparse

parser <span class="token operator">=</span> argparse<span class="token punctuation">.</span>ArgumentParser<span class="token punctuation">(</span><span class="token punctuation">)</span>

parser<span class="token punctuation">.</span>add_argument<span class="token punctuation">(</span><span class="token string">'-s'</span><span class="token punctuation">,</span> action<span class="token operator">=</span><span class="token string">'store'</span><span class="token punctuation">,</span> dest<span class="token operator">=</span><span class="token string">'simple_value'</span><span class="token punctuation">,</span>
                    <span class="token builtin">help</span><span class="token operator">=</span><span class="token string">'Store a simple value'</span><span class="token punctuation">)</span>

parser<span class="token punctuation">.</span>add_argument<span class="token punctuation">(</span><span class="token string">'-c'</span><span class="token punctuation">,</span> action<span class="token operator">=</span><span class="token string">'store_const'</span><span class="token punctuation">,</span> dest<span class="token operator">=</span><span class="token string">'constant_value'</span><span class="token punctuation">,</span>
                    const<span class="token operator">=</span><span class="token string">'value-to-store'</span><span class="token punctuation">,</span>
                    <span class="token builtin">help</span><span class="token operator">=</span><span class="token string">'Store a constant value'</span><span class="token punctuation">)</span>

parser<span class="token punctuation">.</span>add_argument<span class="token punctuation">(</span><span class="token string">'-t'</span><span class="token punctuation">,</span> action<span class="token operator">=</span><span class="token string">'store_true'</span><span class="token punctuation">,</span> default<span class="token operator">=</span><span class="token boolean">False</span><span class="token punctuation">,</span>
                    dest<span class="token operator">=</span><span class="token string">'boolean_switch'</span><span class="token punctuation">,</span>
                    <span class="token builtin">help</span><span class="token operator">=</span><span class="token string">'Set a switch to true'</span><span class="token punctuation">)</span>
parser<span class="token punctuation">.</span>add_argument<span class="token punctuation">(</span><span class="token string">'-f'</span><span class="token punctuation">,</span> action<span class="token operator">=</span><span class="token string">'store_false'</span><span class="token punctuation">,</span> default<span class="token operator">=</span><span class="token boolean">False</span><span class="token punctuation">,</span>
                    dest<span class="token operator">=</span><span class="token string">'boolean_switch'</span><span class="token punctuation">,</span>
                    <span class="token builtin">help</span><span class="token operator">=</span><span class="token string">'Set a switch to false'</span><span class="token punctuation">)</span>

parser<span class="token punctuation">.</span>add_argument<span class="token punctuation">(</span><span class="token string">'-a'</span><span class="token punctuation">,</span> action<span class="token operator">=</span><span class="token string">'append'</span><span class="token punctuation">,</span> dest<span class="token operator">=</span><span class="token string">'collection'</span><span class="token punctuation">,</span>
                    default<span class="token operator">=</span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
                    <span class="token builtin">help</span><span class="token operator">=</span><span class="token string">'Add repeated values to a list'</span><span class="token punctuation">,</span>
                    <span class="token punctuation">)</span>

parser<span class="token punctuation">.</span>add_argument<span class="token punctuation">(</span><span class="token string">'-A'</span><span class="token punctuation">,</span> action<span class="token operator">=</span><span class="token string">'append_const'</span><span class="token punctuation">,</span> dest<span class="token operator">=</span><span class="token string">'const_collection'</span><span class="token punctuation">,</span>
                    const<span class="token operator">=</span><span class="token string">'value-1-to-append'</span><span class="token punctuation">,</span>
                    default<span class="token operator">=</span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
                    <span class="token builtin">help</span><span class="token operator">=</span><span class="token string">'Add different values to list'</span><span class="token punctuation">)</span>
parser<span class="token punctuation">.</span>add_argument<span class="token punctuation">(</span><span class="token string">'-B'</span><span class="token punctuation">,</span> action<span class="token operator">=</span><span class="token string">'append_const'</span><span class="token punctuation">,</span> dest<span class="token operator">=</span><span class="token string">'const_collection'</span><span class="token punctuation">,</span>
                    const<span class="token operator">=</span><span class="token string">'value-2-to-append'</span><span class="token punctuation">,</span>
                    <span class="token builtin">help</span><span class="token operator">=</span><span class="token string">'Add different values to list'</span><span class="token punctuation">)</span>

parser<span class="token punctuation">.</span>add_argument<span class="token punctuation">(</span><span class="token string">'--version'</span><span class="token punctuation">,</span> action<span class="token operator">=</span><span class="token string">'version'</span><span class="token punctuation">,</span> version<span class="token operator">=</span><span class="token string">'%(prog)s 1.0'</span><span class="token punctuation">)</span>

results <span class="token operator">=</span> parser<span class="token punctuation">.</span>parse_args<span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token keyword">print</span> <span class="token string">'simple_value     ='</span><span class="token punctuation">,</span> results<span class="token punctuation">.</span>simple_value
<span class="token keyword">print</span> <span class="token string">'constant_value   ='</span><span class="token punctuation">,</span> results<span class="token punctuation">.</span>constant_value
<span class="token keyword">print</span> <span class="token string">'boolean_switch   ='</span><span class="token punctuation">,</span> results<span class="token punctuation">.</span>boolean_switch
<span class="token keyword">print</span> <span class="token string">'collection       ='</span><span class="token punctuation">,</span> results<span class="token punctuation">.</span>collection
<span class="token keyword">print</span> <span class="token string">'const_collection ='</span><span class="token punctuation">,</span> results<span class="token punctuation">.</span>const_collection
</code></pre></div><p><a href="https://pymotw.com/2/argparse/" target="_blank" rel="noopener noreferrer">https://pymotw.com/2/argparse/<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></p> <div class="language-python extra-class"><pre class="language-python"><code><span class="token keyword">import</span> argparse

parser <span class="token operator">=</span> argparse<span class="token punctuation">.</span>ArgumentParser<span class="token punctuation">(</span>description<span class="token operator">=</span><span class="token string">'Process some integers.'</span><span class="token punctuation">)</span>
parser<span class="token punctuation">.</span>add_argument<span class="token punctuation">(</span><span class="token string">'integers'</span><span class="token punctuation">,</span> metavar<span class="token operator">=</span><span class="token string">'N'</span><span class="token punctuation">,</span> <span class="token builtin">type</span><span class="token operator">=</span><span class="token builtin">int</span><span class="token punctuation">,</span> nargs<span class="token operator">=</span><span class="token string">'+'</span><span class="token punctuation">,</span>
                   <span class="token builtin">help</span><span class="token operator">=</span><span class="token string">'an integer for the accumulator'</span><span class="token punctuation">)</span>
parser<span class="token punctuation">.</span>add_argument<span class="token punctuation">(</span><span class="token string">'--sum'</span><span class="token punctuation">,</span> dest<span class="token operator">=</span><span class="token string">'accumulate'</span><span class="token punctuation">,</span> action<span class="token operator">=</span><span class="token string">'store_const'</span><span class="token punctuation">,</span>
                   const<span class="token operator">=</span><span class="token builtin">sum</span><span class="token punctuation">,</span> default<span class="token operator">=</span><span class="token builtin">max</span><span class="token punctuation">,</span>
                   <span class="token builtin">help</span><span class="token operator">=</span><span class="token string">'sum the integers (default: find the max)'</span><span class="token punctuation">)</span>

args <span class="token operator">=</span> parser<span class="token punctuation">.</span>parse_args<span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token keyword">print</span> args<span class="token punctuation">.</span>accumulate<span class="token punctuation">(</span>args<span class="token punctuation">.</span>integers<span class="token punctuation">)</span>
</code></pre></div><div class="language-python extra-class"><pre class="language-python"><code>python <span class="token operator">/</span>usr<span class="token operator">/</span>sbin<span class="token operator">/</span>denyhosts <span class="token operator">-</span><span class="token operator">-</span>daemon <span class="token operator">-</span><span class="token operator">-</span>purge <span class="token operator">-</span><span class="token operator">-</span>config<span class="token operator">=</span><span class="token operator">/</span>etc<span class="token operator">/</span>denyhosts<span class="token punctuation">.</span>conf

<span class="token keyword">import</span> sys
<span class="token keyword">import</span> getopt

args <span class="token operator">=</span> sys<span class="token punctuation">.</span>argv<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">:</span><span class="token punctuation">]</span>
<span class="token keyword">try</span><span class="token punctuation">:</span>
    <span class="token punctuation">(</span>opts<span class="token punctuation">,</span> getopts<span class="token punctuation">)</span> <span class="token operator">=</span> getopt<span class="token punctuation">.</span>getopt<span class="token punctuation">(</span>args<span class="token punctuation">,</span> <span class="token string">'f:c:dinuvps?hV'</span><span class="token punctuation">,</span>
                                    <span class="token punctuation">[</span><span class="token string">&quot;file=&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;ignore&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;verbose&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;debug&quot;</span><span class="token punctuation">,</span>
                                     <span class="token string">&quot;help&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;noemail&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;config=&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;version&quot;</span><span class="token punctuation">,</span>
                                     <span class="token string">&quot;migrate&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;purge&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;daemon&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;foreground&quot;</span><span class="token punctuation">,</span>
                                     <span class="token string">&quot;sync&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;upgrade099&quot;</span><span class="token punctuation">]</span><span class="token punctuation">)</span>
<span class="token keyword">except</span><span class="token punctuation">:</span>
    <span class="token keyword">print</span> <span class="token string">&quot;\nInvalid command line option detected.&quot;</span>
    usage<span class="token punctuation">(</span><span class="token punctuation">)</span>
    sys<span class="token punctuation">.</span>exit<span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span>

<span class="token keyword">for</span> opt<span class="token punctuation">,</span> arg <span class="token keyword">in</span> opts<span class="token punctuation">:</span>
    <span class="token keyword">if</span> opt <span class="token keyword">in</span> <span class="token punctuation">(</span><span class="token string">'-h'</span><span class="token punctuation">,</span> <span class="token string">'-?'</span><span class="token punctuation">,</span> <span class="token string">'--help'</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
        usage<span class="token punctuation">(</span><span class="token punctuation">)</span>
        sys<span class="token punctuation">.</span>exit<span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span>
    <span class="token keyword">if</span> opt <span class="token keyword">in</span> <span class="token punctuation">(</span><span class="token string">'-f'</span><span class="token punctuation">,</span> <span class="token string">'--file'</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
        logfiles<span class="token punctuation">.</span>append<span class="token punctuation">(</span>arg<span class="token punctuation">)</span>
    <span class="token keyword">if</span> opt <span class="token keyword">in</span> <span class="token punctuation">(</span><span class="token string">'-i'</span><span class="token punctuation">,</span> <span class="token string">'--ignore'</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
        ignore_offset <span class="token operator">=</span> <span class="token number">1</span>
    <span class="token keyword">if</span> opt <span class="token keyword">in</span> <span class="token punctuation">(</span><span class="token string">'-n'</span><span class="token punctuation">,</span> <span class="token string">'--noemail'</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
        noemail <span class="token operator">=</span> <span class="token number">1</span>
    <span class="token keyword">if</span> opt <span class="token keyword">in</span> <span class="token punctuation">(</span><span class="token string">'-v'</span><span class="token punctuation">,</span> <span class="token string">'--verbose'</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
        verbose <span class="token operator">=</span> <span class="token number">1</span>
    <span class="token keyword">if</span> opt <span class="token keyword">in</span> <span class="token punctuation">(</span><span class="token string">'-d'</span><span class="token punctuation">,</span> <span class="token string">'--debug'</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
        enable_debug <span class="token operator">=</span> <span class="token number">1</span>
    <span class="token keyword">if</span> opt <span class="token keyword">in</span> <span class="token punctuation">(</span><span class="token string">'-c'</span><span class="token punctuation">,</span> <span class="token string">'--config'</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
        config_file <span class="token operator">=</span> arg
    <span class="token keyword">if</span> opt <span class="token keyword">in</span> <span class="token punctuation">(</span><span class="token string">'-m'</span><span class="token punctuation">,</span> <span class="token string">'--migrate'</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
        migrate <span class="token operator">=</span> <span class="token number">1</span>
    <span class="token keyword">if</span> opt <span class="token keyword">in</span> <span class="token punctuation">(</span><span class="token string">'-p'</span><span class="token punctuation">,</span> <span class="token string">'--purge'</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
        purge <span class="token operator">=</span> <span class="token number">1</span>
    <span class="token keyword">if</span> opt <span class="token keyword">in</span> <span class="token punctuation">(</span><span class="token string">'-s'</span><span class="token punctuation">,</span> <span class="token string">'--sync'</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
        sync_mode <span class="token operator">=</span> <span class="token number">1</span>
    <span class="token keyword">if</span> opt <span class="token operator">==</span> <span class="token string">'--daemon'</span><span class="token punctuation">:</span>
        daemon <span class="token operator">=</span> <span class="token number">1</span>
    <span class="token keyword">if</span> opt <span class="token operator">==</span> <span class="token string">'--foreground'</span><span class="token punctuation">:</span>
        foreground <span class="token operator">=</span> <span class="token number">1</span>
    <span class="token keyword">if</span> opt <span class="token operator">==</span> <span class="token string">'--upgrade099'</span><span class="token punctuation">:</span>
        upgrade099 <span class="token operator">=</span> <span class="token number">1</span>
    <span class="token keyword">if</span> opt <span class="token operator">==</span> <span class="token string">'--version'</span><span class="token punctuation">:</span>
        <span class="token keyword">print</span> <span class="token string">&quot;DenyHosts version:&quot;</span><span class="token punctuation">,</span> VERSION
        sys<span class="token punctuation">.</span>exit<span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span>
</code></pre></div><h3 id="commands"><a href="#commands" aria-hidden="true" class="header-anchor">#</a> Commands</h3> <h4 id="one-way-simple"><a href="#one-way-simple" aria-hidden="true" class="header-anchor">#</a> One way simple</h4> <p>from subprocess import call</p> <div class="language-python extra-class"><pre class="language-python"><code><span class="token keyword">from</span> subprocess <span class="token keyword">import</span> call
call<span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token string">&quot;ls&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;-l&quot;</span><span class="token punctuation">]</span><span class="token punctuation">)</span>
</code></pre></div><h3 id="simple-to-get-output"><a href="#simple-to-get-output" aria-hidden="true" class="header-anchor">#</a> Simple to get output</h3> <div class="language- extra-class"><pre class="language-text"><code>import subprocess
out = subprocess.getoutput(lcmd)
</code></pre></div><h4 id="to-get-all-output"><a href="#to-get-all-output" aria-hidden="true" class="header-anchor">#</a> To get All output</h4> <p>This <strong>BLOCKS/WAITS</strong> until process is done.</p> <div class="language-python extra-class"><pre class="language-python"><code><span class="token keyword">import</span> subprocess

p <span class="token operator">=</span> subprocess<span class="token punctuation">.</span>Popen<span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token string">&quot;ls&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;-l&quot;</span><span class="token punctuation">]</span><span class="token punctuation">,</span> shell<span class="token operator">=</span><span class="token boolean">True</span><span class="token punctuation">,</span> stdout<span class="token operator">=</span>subprocess<span class="token punctuation">.</span>PIPE<span class="token punctuation">,</span> stderr<span class="token operator">=</span>subprocess<span class="token punctuation">.</span>STDOUT<span class="token punctuation">)</span>
<span class="token keyword">for</span> line <span class="token keyword">in</span> p<span class="token punctuation">.</span>stdout<span class="token punctuation">.</span>readlines<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span> <span class="token keyword">print</span> line<span class="token punctuation">.</span>rstrip<span class="token punctuation">(</span><span class="token punctuation">)</span>
retval <span class="token operator">=</span> p<span class="token punctuation">.</span>wait<span class="token punctuation">(</span><span class="token punctuation">)</span>
</code></pre></div><h4 id="to-get-live-output"><a href="#to-get-live-output" aria-hidden="true" class="header-anchor">#</a> To get live output</h4> <p>This <strong>DOES NOT</strong> block/wait until process is done:</p> <div class="language-python extra-class"><pre class="language-python"><code><span class="token keyword">import</span> subprocess

p <span class="token operator">=</span> subprocess<span class="token punctuation">.</span>Popen<span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token string">&quot;ls&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;-l&quot;</span><span class="token punctuation">]</span><span class="token punctuation">,</span> shell<span class="token operator">=</span><span class="token boolean">True</span><span class="token punctuation">,</span> stdout<span class="token operator">=</span>subprocess<span class="token punctuation">.</span>PIPE<span class="token punctuation">,</span> stderr<span class="token operator">=</span>subprocess<span class="token punctuation">.</span>STDOUT<span class="token punctuation">)</span>
lines <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span>
<span class="token keyword">for</span> line <span class="token keyword">in</span> <span class="token builtin">iter</span><span class="token punctuation">(</span>p<span class="token punctuation">.</span>stdout<span class="token punctuation">.</span>readline<span class="token punctuation">,</span> <span class="token string">''</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
    lines<span class="token punctuation">.</span>append<span class="token punctuation">(</span>line<span class="token punctuation">.</span>rstrip<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
</code></pre></div><h2 id="web-json"><a href="#web-json" aria-hidden="true" class="header-anchor">#</a> Web / JSON</h2> <h3 id="urllib2"><a href="#urllib2" aria-hidden="true" class="header-anchor">#</a> urllib2</h3> <div class="language-python extra-class"><pre class="language-python"><code><span class="token keyword">from</span> urllib2 <span class="token keyword">import</span> Request<span class="token punctuation">,</span> urlopen
<span class="token keyword">import</span> json

headers <span class="token operator">=</span> <span class="token punctuation">{</span>
  <span class="token string">'Content-type'</span><span class="token punctuation">:</span> <span class="token string">'application/json'</span>
<span class="token punctuation">}</span>

values <span class="token operator">=</span> <span class="token triple-quoted-string string">&quot;&quot;&quot;
{
  &quot;request&quot;: {
    &quot;slice&quot;: [
      {
        &quot;origin&quot;: &quot;FLL&quot;,
        &quot;destination&quot;: &quot;PAP&quot;,
        &quot;date&quot;: &quot;2015-07-30&quot;
      },
      {
        &quot;origin&quot;: &quot;PAP&quot;,
        &quot;destination&quot;: &quot;FLL&quot;,
        &quot;date&quot;: &quot;2015-08-02&quot;
      }
    ],
    &quot;passengers&quot;: {
      &quot;adultCount&quot;: 1,
      &quot;infantInLapCount&quot;: 0,
      &quot;infantInSeatCount&quot;: 0,
      &quot;childCount&quot;: 0,
      &quot;seniorCount&quot;: 0
    },
    &quot;solutions&quot;: 50,
    &quot;refundable&quot;: false
  }
}
&quot;&quot;&quot;</span>

api_key <span class="token operator">=</span> <span class="token string">'AIzaSyDY1GHnC28WaABzyMdHKapVt2Mc0yCeigc'</span>
base_url <span class="token operator">=</span> <span class="token string">'https://www.googleapis.com/qpxExpress/v1/trips/search?key='</span>
request <span class="token operator">=</span> Request<span class="token punctuation">(</span>base_url <span class="token operator">+</span> api_key<span class="token punctuation">,</span> data<span class="token operator">=</span>values<span class="token punctuation">)</span>

<span class="token keyword">for</span> k<span class="token punctuation">,</span>v <span class="token keyword">in</span> headers<span class="token punctuation">.</span>iteritems<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
    request<span class="token punctuation">.</span>add_header<span class="token punctuation">(</span>k<span class="token punctuation">,</span> v<span class="token punctuation">)</span>

json_data <span class="token operator">=</span> json<span class="token punctuation">.</span>load<span class="token punctuation">(</span>urlopen<span class="token punctuation">(</span>request<span class="token punctuation">)</span><span class="token punctuation">)</span>
</code></pre></div><h4 id="use-proxy"><a href="#use-proxy" aria-hidden="true" class="header-anchor">#</a> Use Proxy</h4> <div class="language-python extra-class"><pre class="language-python"><code>proxy <span class="token operator">=</span> urllib2<span class="token punctuation">.</span>ProxyHandler<span class="token punctuation">(</span><span class="token punctuation">{</span><span class="token string">'http'</span><span class="token punctuation">:</span> <span class="token string">'127.0.0.1'</span><span class="token punctuation">}</span><span class="token punctuation">)</span>
opener <span class="token operator">=</span> urllib2<span class="token punctuation">.</span>build_opener<span class="token punctuation">(</span>proxy<span class="token punctuation">)</span>
urllib2<span class="token punctuation">.</span>install_opener<span class="token punctuation">(</span>opener<span class="token punctuation">)</span>
urllib2<span class="token punctuation">.</span>urlopen<span class="token punctuation">(</span><span class="token string">'http://www.google.com'</span><span class="token punctuation">)</span>
</code></pre></div><h3 id="nltm-windows-auth"><a href="#nltm-windows-auth" aria-hidden="true" class="header-anchor">#</a> NLTM Windows Auth</h3> <div class="language-python extra-class"><pre class="language-python"><code><span class="token keyword">import</span> requests
<span class="token keyword">from</span> requests<span class="token punctuation">.</span>auth <span class="token keyword">import</span> HTTPBasicAuth
<span class="token keyword">from</span> requests_ntlm <span class="token keyword">import</span> HttpNtlmAuth

requests<span class="token punctuation">.</span>get<span class="token punctuation">(</span>sharepoint_url<span class="token punctuation">,</span> auth<span class="token operator">=</span>HttpNtlmAuth<span class="token punctuation">(</span><span class="token string">'domain\\user'</span><span class="token punctuation">,</span><span class="token string">'password'</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
</code></pre></div><h3 id="selenium"><a href="#selenium" aria-hidden="true" class="header-anchor">#</a> Selenium</h3> <h4 id="use-proxy-2"><a href="#use-proxy-2" aria-hidden="true" class="header-anchor">#</a> Use Proxy</h4> <div class="language-python extra-class"><pre class="language-python"><code><span class="token keyword">from</span> selenium <span class="token keyword">import</span> webdriver
<span class="token keyword">from</span> selenium<span class="token punctuation">.</span>webdriver<span class="token punctuation">.</span>common<span class="token punctuation">.</span>proxy <span class="token keyword">import</span> <span class="token operator">*</span>

myProxy <span class="token operator">=</span> <span class="token string">&quot;host:8080&quot;</span>

proxy <span class="token operator">=</span> Proxy<span class="token punctuation">(</span><span class="token punctuation">{</span>
    <span class="token string">'proxyType'</span><span class="token punctuation">:</span> ProxyType<span class="token punctuation">.</span>MANUAL<span class="token punctuation">,</span>
    <span class="token string">'httpProxy'</span><span class="token punctuation">:</span> myProxy<span class="token punctuation">,</span>
    <span class="token string">'ftpProxy'</span><span class="token punctuation">:</span> myProxy<span class="token punctuation">,</span>
    <span class="token string">'sslProxy'</span><span class="token punctuation">:</span> myProxy<span class="token punctuation">,</span>
    <span class="token string">'noProxy'</span><span class="token punctuation">:</span> <span class="token string">''</span> <span class="token comment"># set this value as desired</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span>

driver <span class="token operator">=</span> webdriver<span class="token punctuation">.</span>Firefox<span class="token punctuation">(</span>proxy<span class="token operator">=</span>proxy<span class="token punctuation">)</span>
</code></pre></div><h3 id="a-proxy-server"><a href="#a-proxy-server" aria-hidden="true" class="header-anchor">#</a> A Proxy Server</h3> <div class="language-python extra-class"><pre class="language-python"><code><span class="token comment">#!/usr/bin/python</span>
<span class="token comment"># This is a simple port-forward / proxy, written using only the default python</span>
<span class="token comment"># library. If you want to make a suggestion or fix something you can contact-me</span>
<span class="token comment"># at voorloop_at_gmail.com</span>
<span class="token comment"># Distributed over IDC(I Don't Care) license</span>
<span class="token keyword">import</span> socket
<span class="token keyword">import</span> select
<span class="token keyword">import</span> time
<span class="token keyword">import</span> sys

<span class="token comment"># Changing the buffer_size and delay, you can improve the speed and bandwidth.</span>
<span class="token comment"># But when buffer get to high or delay go too down, you can broke things</span>
buffer_size <span class="token operator">=</span> <span class="token number">4096</span>
delay <span class="token operator">=</span> <span class="token number">0.0001</span>
forward_to <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token string">'smtp.zaz.ufsk.br'</span><span class="token punctuation">,</span> <span class="token number">25</span><span class="token punctuation">)</span>

<span class="token keyword">class</span> <span class="token class-name">Forward</span><span class="token punctuation">:</span>
    <span class="token keyword">def</span> <span class="token function">__init__</span><span class="token punctuation">(</span>self<span class="token punctuation">)</span><span class="token punctuation">:</span>
        self<span class="token punctuation">.</span>forward <span class="token operator">=</span> socket<span class="token punctuation">.</span>socket<span class="token punctuation">(</span>socket<span class="token punctuation">.</span>AF_INET<span class="token punctuation">,</span> socket<span class="token punctuation">.</span>SOCK_STREAM<span class="token punctuation">)</span>

    <span class="token keyword">def</span> <span class="token function">start</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> host<span class="token punctuation">,</span> port<span class="token punctuation">)</span><span class="token punctuation">:</span>
        <span class="token keyword">try</span><span class="token punctuation">:</span>
            self<span class="token punctuation">.</span>forward<span class="token punctuation">.</span>connect<span class="token punctuation">(</span><span class="token punctuation">(</span>host<span class="token punctuation">,</span> port<span class="token punctuation">)</span><span class="token punctuation">)</span>
            <span class="token keyword">return</span> self<span class="token punctuation">.</span>forward
        <span class="token keyword">except</span> Exception<span class="token punctuation">,</span> e<span class="token punctuation">:</span>
            <span class="token keyword">print</span> e
            <span class="token keyword">return</span> <span class="token boolean">False</span>

<span class="token keyword">class</span> <span class="token class-name">TheServer</span><span class="token punctuation">:</span>
    input_list <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span>
    channel <span class="token operator">=</span> <span class="token punctuation">{</span><span class="token punctuation">}</span>

    <span class="token keyword">def</span> <span class="token function">__init__</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> host<span class="token punctuation">,</span> port<span class="token punctuation">)</span><span class="token punctuation">:</span>
        self<span class="token punctuation">.</span>server <span class="token operator">=</span> socket<span class="token punctuation">.</span>socket<span class="token punctuation">(</span>socket<span class="token punctuation">.</span>AF_INET<span class="token punctuation">,</span> socket<span class="token punctuation">.</span>SOCK_STREAM<span class="token punctuation">)</span>
        self<span class="token punctuation">.</span>server<span class="token punctuation">.</span>setsockopt<span class="token punctuation">(</span>socket<span class="token punctuation">.</span>SOL_SOCKET<span class="token punctuation">,</span> socket<span class="token punctuation">.</span>SO_REUSEADDR<span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">)</span>
        self<span class="token punctuation">.</span>server<span class="token punctuation">.</span>bind<span class="token punctuation">(</span><span class="token punctuation">(</span>host<span class="token punctuation">,</span> port<span class="token punctuation">)</span><span class="token punctuation">)</span>
        self<span class="token punctuation">.</span>server<span class="token punctuation">.</span>listen<span class="token punctuation">(</span><span class="token number">200</span><span class="token punctuation">)</span>

    <span class="token keyword">def</span> <span class="token function">main_loop</span><span class="token punctuation">(</span>self<span class="token punctuation">)</span><span class="token punctuation">:</span>
        self<span class="token punctuation">.</span>input_list<span class="token punctuation">.</span>append<span class="token punctuation">(</span>self<span class="token punctuation">.</span>server<span class="token punctuation">)</span>
        <span class="token keyword">while</span> <span class="token number">1</span><span class="token punctuation">:</span>
            time<span class="token punctuation">.</span>sleep<span class="token punctuation">(</span>delay<span class="token punctuation">)</span>
            ss <span class="token operator">=</span> select<span class="token punctuation">.</span>select
            inputready<span class="token punctuation">,</span> outputready<span class="token punctuation">,</span> exceptready <span class="token operator">=</span> ss<span class="token punctuation">(</span>self<span class="token punctuation">.</span>input_list<span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">)</span>
            <span class="token keyword">for</span> self<span class="token punctuation">.</span>s <span class="token keyword">in</span> inputready<span class="token punctuation">:</span>
                <span class="token keyword">if</span> self<span class="token punctuation">.</span>s <span class="token operator">==</span> self<span class="token punctuation">.</span>server<span class="token punctuation">:</span>
                    self<span class="token punctuation">.</span>on_accept<span class="token punctuation">(</span><span class="token punctuation">)</span>
                    <span class="token keyword">break</span>

                self<span class="token punctuation">.</span>data <span class="token operator">=</span> self<span class="token punctuation">.</span>s<span class="token punctuation">.</span>recv<span class="token punctuation">(</span>buffer_size<span class="token punctuation">)</span>
                <span class="token keyword">if</span> <span class="token builtin">len</span><span class="token punctuation">(</span>self<span class="token punctuation">.</span>data<span class="token punctuation">)</span> <span class="token operator">==</span> <span class="token number">0</span><span class="token punctuation">:</span>
                    self<span class="token punctuation">.</span>on_close<span class="token punctuation">(</span><span class="token punctuation">)</span>
                    <span class="token keyword">break</span>
                <span class="token keyword">else</span><span class="token punctuation">:</span>
                    self<span class="token punctuation">.</span>on_recv<span class="token punctuation">(</span><span class="token punctuation">)</span>

    <span class="token keyword">def</span> <span class="token function">on_accept</span><span class="token punctuation">(</span>self<span class="token punctuation">)</span><span class="token punctuation">:</span>
        forward <span class="token operator">=</span> Forward<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span>start<span class="token punctuation">(</span>forward_to<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">,</span> forward_to<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">)</span>
        clientsock<span class="token punctuation">,</span> clientaddr <span class="token operator">=</span> self<span class="token punctuation">.</span>server<span class="token punctuation">.</span>accept<span class="token punctuation">(</span><span class="token punctuation">)</span>
        <span class="token keyword">if</span> forward<span class="token punctuation">:</span>
            <span class="token keyword">print</span> clientaddr<span class="token punctuation">,</span> <span class="token string">&quot;has connected&quot;</span>
            self<span class="token punctuation">.</span>input_list<span class="token punctuation">.</span>append<span class="token punctuation">(</span>clientsock<span class="token punctuation">)</span>
            self<span class="token punctuation">.</span>input_list<span class="token punctuation">.</span>append<span class="token punctuation">(</span>forward<span class="token punctuation">)</span>
            self<span class="token punctuation">.</span>channel<span class="token punctuation">[</span>clientsock<span class="token punctuation">]</span> <span class="token operator">=</span> forward
            self<span class="token punctuation">.</span>channel<span class="token punctuation">[</span>forward<span class="token punctuation">]</span> <span class="token operator">=</span> clientsock
        <span class="token keyword">else</span><span class="token punctuation">:</span>
            <span class="token keyword">print</span> <span class="token string">&quot;Can't establish connection with remote server.&quot;</span><span class="token punctuation">,</span>
            <span class="token keyword">print</span> <span class="token string">&quot;Closing connection with client side&quot;</span><span class="token punctuation">,</span> clientaddr
            clientsock<span class="token punctuation">.</span>close<span class="token punctuation">(</span><span class="token punctuation">)</span>

    <span class="token keyword">def</span> <span class="token function">on_close</span><span class="token punctuation">(</span>self<span class="token punctuation">)</span><span class="token punctuation">:</span>
        <span class="token keyword">print</span> self<span class="token punctuation">.</span>s<span class="token punctuation">.</span>getpeername<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token string">&quot;has disconnected&quot;</span>
        <span class="token comment">#remove objects from input_list</span>
        self<span class="token punctuation">.</span>input_list<span class="token punctuation">.</span>remove<span class="token punctuation">(</span>self<span class="token punctuation">.</span>s<span class="token punctuation">)</span>
        self<span class="token punctuation">.</span>input_list<span class="token punctuation">.</span>remove<span class="token punctuation">(</span>self<span class="token punctuation">.</span>channel<span class="token punctuation">[</span>self<span class="token punctuation">.</span>s<span class="token punctuation">]</span><span class="token punctuation">)</span>
        out <span class="token operator">=</span> self<span class="token punctuation">.</span>channel<span class="token punctuation">[</span>self<span class="token punctuation">.</span>s<span class="token punctuation">]</span>
        <span class="token comment"># close the connection with client</span>
        self<span class="token punctuation">.</span>channel<span class="token punctuation">[</span>out<span class="token punctuation">]</span><span class="token punctuation">.</span>close<span class="token punctuation">(</span><span class="token punctuation">)</span>  <span class="token comment"># equivalent to do self.s.close()</span>
        <span class="token comment"># close the connection with remote server</span>
        self<span class="token punctuation">.</span>channel<span class="token punctuation">[</span>self<span class="token punctuation">.</span>s<span class="token punctuation">]</span><span class="token punctuation">.</span>close<span class="token punctuation">(</span><span class="token punctuation">)</span>
        <span class="token comment"># delete both objects from channel dict</span>
        <span class="token keyword">del</span> self<span class="token punctuation">.</span>channel<span class="token punctuation">[</span>out<span class="token punctuation">]</span>
        <span class="token keyword">del</span> self<span class="token punctuation">.</span>channel<span class="token punctuation">[</span>self<span class="token punctuation">.</span>s<span class="token punctuation">]</span>

    <span class="token keyword">def</span> <span class="token function">on_recv</span><span class="token punctuation">(</span>self<span class="token punctuation">)</span><span class="token punctuation">:</span>
        data <span class="token operator">=</span> self<span class="token punctuation">.</span>data
        <span class="token comment"># here we can parse and/or modify the data before send forward</span>
        <span class="token keyword">print</span> data
        self<span class="token punctuation">.</span>channel<span class="token punctuation">[</span>self<span class="token punctuation">.</span>s<span class="token punctuation">]</span><span class="token punctuation">.</span>send<span class="token punctuation">(</span>data<span class="token punctuation">)</span>

<span class="token keyword">if</span> __name__ <span class="token operator">==</span> <span class="token string">'__main__'</span><span class="token punctuation">:</span>
        server <span class="token operator">=</span> TheServer<span class="token punctuation">(</span><span class="token string">''</span><span class="token punctuation">,</span> <span class="token number">9090</span><span class="token punctuation">)</span>
        <span class="token keyword">try</span><span class="token punctuation">:</span>
            server<span class="token punctuation">.</span>main_loop<span class="token punctuation">(</span><span class="token punctuation">)</span>
        <span class="token keyword">except</span> KeyboardInterrupt<span class="token punctuation">:</span>
            <span class="token keyword">print</span> <span class="token string">&quot;Ctrl C - Stopping server&quot;</span>
            sys<span class="token punctuation">.</span>exit<span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span>
</code></pre></div><h2 id="other"><a href="#other" aria-hidden="true" class="header-anchor">#</a> Other</h2> <h3 id="decorators"><a href="#decorators" aria-hidden="true" class="header-anchor">#</a> Decorators</h3> <p>Decorators allow on-the-fly pre/post function operations/customizations.</p> <p>They are <strong>function wrappers</strong>.</p> <p><strong>Synchronize Lock:</strong></p> <div class="language-python extra-class"><pre class="language-python"><code><span class="token keyword">def</span> <span class="token function">synchronized</span><span class="token punctuation">(</span>lock<span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token triple-quoted-string string">&quot;&quot;&quot; Synchronization decorator &quot;&quot;&quot;</span>
    <span class="token keyword">def</span> <span class="token function">wrap</span><span class="token punctuation">(</span>f<span class="token punctuation">)</span><span class="token punctuation">:</span>
        <span class="token keyword">def</span> <span class="token function">newFunction</span><span class="token punctuation">(</span><span class="token operator">*</span>args<span class="token punctuation">,</span> <span class="token operator">**</span>kw<span class="token punctuation">)</span><span class="token punctuation">:</span>
            lock<span class="token punctuation">.</span>acquire<span class="token punctuation">(</span><span class="token punctuation">)</span>
            <span class="token keyword">try</span><span class="token punctuation">:</span>
                <span class="token keyword">return</span> f<span class="token punctuation">(</span><span class="token operator">*</span>args<span class="token punctuation">,</span> <span class="token operator">**</span>kw<span class="token punctuation">)</span>
            <span class="token keyword">finally</span><span class="token punctuation">:</span>
                lock<span class="token punctuation">.</span>release<span class="token punctuation">(</span><span class="token punctuation">)</span>
        <span class="token keyword">return</span> newFunction
    <span class="token keyword">return</span> wrap

<span class="token keyword">import</span> threading
lock <span class="token operator">=</span> threading<span class="token punctuation">.</span>Lock<span class="token punctuation">(</span><span class="token punctuation">)</span>

@synchronized<span class="token punctuation">(</span>lock<span class="token punctuation">)</span>
<span class="token keyword">def</span> <span class="token function">do_something</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
  <span class="token comment"># etc</span>

<span class="token decorator annotation punctuation">@synchronzied</span><span class="token punctuation">(</span>lock<span class="token punctuation">)</span>
<span class="token keyword">def</span> <span class="token function">do_something_else</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
  <span class="token comment"># etc</span>
</code></pre></div><p><strong>Time Wrapper:</strong></p> <div class="language-python extra-class"><pre class="language-python"><code><span class="token keyword">def</span> <span class="token function">time_dec</span><span class="token punctuation">(</span>func<span class="token punctuation">)</span><span class="token punctuation">:</span>

  <span class="token keyword">def</span> <span class="token function">wrapper</span><span class="token punctuation">(</span><span class="token operator">*</span>arg<span class="token punctuation">)</span><span class="token punctuation">:</span>
      t <span class="token operator">=</span> time<span class="token punctuation">.</span>time<span class="token punctuation">(</span><span class="token punctuation">)</span>
      res <span class="token operator">=</span> func<span class="token punctuation">(</span><span class="token operator">*</span>arg<span class="token punctuation">)</span>
      <span class="token keyword">print</span> func<span class="token punctuation">.</span>func_name<span class="token punctuation">,</span> time<span class="token punctuation">.</span>clock<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">-</span>t
      <span class="token keyword">return</span> res

  <span class="token keyword">return</span> wrapper


@time_dec
<span class="token keyword">def</span> <span class="token function">myFunction</span><span class="token punctuation">(</span>n<span class="token punctuation">)</span><span class="token punctuation">:</span>
</code></pre></div><h3 id="pyvirtualdisplay"><a href="#pyvirtualdisplay" aria-hidden="true" class="header-anchor">#</a> PyVirtualDisplay</h3> <div class="language-bash extra-class"><pre class="language-bash"><code>pip <span class="token function">install</span> pyvirtualdisplay
</code></pre></div><p><strong>CentOs</strong></p> <div class="language-bash extra-class"><pre class="language-bash"><code><span class="token function">wget</span> http://vault.centos.org/6.2/os/x86_64/Packages/xorg-x11-server-Xvfb-1.10.4-6.el6.x86_64.rpm
yum localinstall -y xorg-x11-server-Xvfb-1.10.4-6.el6.x86_64.rpm
</code></pre></div><p><strong>Debian</strong></p> <div class="language-bash extra-class"><pre class="language-bash"><code><span class="token function">apt-get</span> <span class="token function">install</span> -y xvfb
</code></pre></div><h3 id="logger"><a href="#logger" aria-hidden="true" class="header-anchor">#</a> Logger</h3> <div class="language-python extra-class"><pre class="language-python"><code>logger <span class="token operator">=</span> get_logger<span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token comment"># create console handler and set level to debug</span>
ch <span class="token operator">=</span> logging<span class="token punctuation">.</span>StreamHandler<span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token comment">#ch.setLevel(logging.DEBUG)</span>

<span class="token comment"># create formatter</span>
formatter <span class="token operator">=</span> logging<span class="token punctuation">.</span>Formatter<span class="token punctuation">(</span><span class="token string">&quot;%(asctime)s;%(levelname)s;%(message)s&quot;</span><span class="token punctuation">,</span><span class="token string">&quot;%Y-%m-%d %H-%M-%S&quot;</span><span class="token punctuation">)</span>

<span class="token comment"># add formatter to ch</span>
ch<span class="token punctuation">.</span>setFormatter<span class="token punctuation">(</span>formatter<span class="token punctuation">)</span>
logger<span class="token punctuation">.</span>addHandler<span class="token punctuation">(</span>ch<span class="token punctuation">)</span>
logger<span class="token punctuation">.</span>propagate <span class="token operator">=</span> <span class="token boolean">False</span>
</code></pre></div><h3 id="lxml"><a href="#lxml" aria-hidden="true" class="header-anchor">#</a> LXML</h3> <div class="language-bash extra-class"><pre class="language-bash"><code>yum <span class="token function">install</span> libxslt-devel
OR
<span class="token function">sudo</span> <span class="token function">apt-get</span> <span class="token function">install</span> python-dev libxml2-dev libxslt-dev build-essential

<span class="token function">sudo</span> pip <span class="token function">install</span> lxml
</code></pre></div><div class="language-python extra-class"><pre class="language-python"><code><span class="token keyword">for</span> element <span class="token keyword">in</span> xml_tree<span class="token punctuation">.</span><span class="token builtin">iter</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
  <span class="token comment"># print element.tag</span>

  <span class="token keyword">if</span> element<span class="token punctuation">.</span>tag <span class="token operator">==</span> <span class="token string">'FOLDER'</span><span class="token punctuation">:</span> v_FOLDER <span class="token operator">=</span> element<span class="token punctuation">.</span>get<span class="token punctuation">(</span><span class="token string">'NAME'</span><span class="token punctuation">)</span>

  <span class="token keyword">if</span> element<span class="token punctuation">.</span>tag <span class="token operator">==</span> <span class="token string">'SESSION'</span><span class="token punctuation">:</span>
      session_hash <span class="token operator">=</span> <span class="token builtin">dict</span><span class="token punctuation">(</span>session_hash<span class="token punctuation">.</span>items<span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">+</span> extract_SESSION2<span class="token punctuation">(</span>element<span class="token punctuation">)</span><span class="token punctuation">.</span>items<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>

  <span class="token keyword">if</span> element<span class="token punctuation">.</span>tag <span class="token operator">==</span> <span class="token string">'WORKFLOW'</span><span class="token punctuation">:</span>
      v_WORKFLOW_NAME <span class="token operator">=</span> element<span class="token punctuation">.</span>get<span class="token punctuation">(</span><span class="token string">'NAME'</span><span class="token punctuation">)</span>
      data_row <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span>
      <span class="token keyword">print</span> v_WORKFLOW_NAME

      <span class="token keyword">for</span> SESSION <span class="token keyword">in</span> element<span class="token punctuation">.</span>findall<span class="token punctuation">(</span><span class="token string">'SESSION'</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
          session_hash <span class="token operator">=</span> <span class="token builtin">dict</span><span class="token punctuation">(</span>session_hash<span class="token punctuation">.</span>items<span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">+</span> extract_SESSION2<span class="token punctuation">(</span>SESSION<span class="token punctuation">)</span><span class="token punctuation">.</span>items<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
</code></pre></div><p><a href="http://www.w3schools.com/xml/xml_xpath.asp" target="_blank" rel="noopener noreferrer">http://www.w3schools.com/xml/xml_xpath.asp<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></p> <div class="language-python extra-class"><pre class="language-python"><code><span class="token keyword">for</span> element <span class="token keyword">in</span> xml_tree<span class="token punctuation">.</span>xpath<span class="token punctuation">(</span><span class="token string">'//FOLDER'</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
</code></pre></div><h3 id="install-python-2-7-on-centos"><a href="#install-python-2-7-on-centos" aria-hidden="true" class="header-anchor">#</a> Install Python 2.7 on CentOs</h3> <div class="language-bash extra-class"><pre class="language-bash"><code><span class="token comment"># Install dependencies</span>
yum groupinstall -y <span class="token string">'development tools'</span>
yum <span class="token function">install</span> -y zlib-devel bzip2-devel openssl-devel xz-libs <span class="token function">wget</span>

<span class="token comment"># Download the Python source and unpack it</span>
<span class="token function">wget</span> http://www.python.org/ftp/python/2.7.9/Python-2.7.9.tar.xz
xz -d Python-2.7.9.tar.xz
<span class="token function">tar</span> -xvf Python-2.7.9.tar

<span class="token comment"># Enter the directory, configure, and install</span>
<span class="token function">cd</span> Python-2.7.9
./configure --prefix<span class="token operator">=</span>/usr/local
<span class="token function">make</span>
<span class="token function">make</span> altinstall

<span class="token comment"># Check the Python version with `python2.7 -V` and make sure</span>
<span class="token comment"># /usr/local/bin is in your `PATH` with `echo $PATH`. If not</span>
<span class="token comment"># do `export PATH=&quot;/usr/local/bin:$PATH&quot;`</span>

<span class="token comment"># Install `setuptools`</span>
<span class="token function">cd</span> <span class="token punctuation">..</span>
<span class="token function">wget</span> --no-check-certificate https://pypi.python.org/packages/source/s/setuptools/setuptools-14.0.tar.gz
<span class="token function">tar</span> -xvf setuptools-14.0.tar.gz
<span class="token function">cd</span> setuptools-14.0
python2.7 setup.py <span class="token function">install</span>

<span class="token comment"># Install `pip`</span>
<span class="token function">curl</span> https://raw.githubusercontent.com/pypa/pip/master/contrib/get-pip.py <span class="token operator">|</span> python2.7 -

<span class="token comment"># Install `virtualenv`</span>
pip2.7 <span class="token function">install</span> virtualenv
</code></pre></div><h3 id="python-libraries"><a href="#python-libraries" aria-hidden="true" class="header-anchor">#</a> Python Libraries</h3> <div class="language-bash extra-class"><pre class="language-bash"><code><span class="token function">apt-get</span> <span class="token function">install</span> -y build-essential libncursesw5-dev libssl-dev libgdbm-dev libc6-dev libsqlite3-dev tk-dev libbz2-dev
</code></pre></div><h3 id="how-to-deploy-flask-web-applications-using-uwsgi-behind-nginx"><a href="#how-to-deploy-flask-web-applications-using-uwsgi-behind-nginx" aria-hidden="true" class="header-anchor">#</a> How To Deploy Flask Web Applications Using uWSGI Behind Nginx</h3> <p>CentOS 6.4</p> <p><a href="https://www.digitalocean.com/community/tutorials/how-to-deploy-flask-web-applications-using-uwsgi-behind-nginx-on-centos-6-4" target="_blank" rel="noopener noreferrer">https://www.digitalocean.com/community/tutorials/how-to-deploy-flask-web-applications-using-uwsgi-behind-nginx-on-centos-6-4<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></p> <p>Ubuntu:</p> <p><a href="https://www.digitalocean.com/community/tutorials/how-to-serve-flask-applications-with-uwsgi-and-nginx-on-ubuntu-14-04" target="_blank" rel="noopener noreferrer">https://www.digitalocean.com/community/tutorials/how-to-serve-flask-applications-with-uwsgi-and-nginx-on-ubuntu-14-04<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></p> <h2 id="flask"><a href="#flask" aria-hidden="true" class="header-anchor">#</a> Flask</h2> <p><strong>Passing Variables to Template</strong></p> <div class="language-python extra-class"><pre class="language-python"><code><span class="token keyword">from</span> flask <span class="token keyword">import</span> Flask<span class="token punctuation">,</span> render_template<span class="token punctuation">,</span> url_for

app <span class="token operator">=</span> Flask<span class="token punctuation">(</span>__name__<span class="token punctuation">)</span>

<span class="token keyword">class</span> <span class="token class-name">User</span><span class="token punctuation">(</span><span class="token builtin">object</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
   <span class="token keyword">def</span> <span class="token function">__init__</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> fn<span class="token punctuation">,</span> ls<span class="token punctuation">)</span><span class="token punctuation">:</span>
      self<span class="token punctuation">.</span>first_name <span class="token operator">=</span> fn
      self<span class="token punctuation">.</span>last_name <span class="token operator">=</span> ln

@app<span class="token punctuation">.</span>route<span class="token punctuation">(</span><span class="token string">&quot;/&quot;</span><span class="token punctuation">)</span>
@app<span class="token punctuation">.</span>route<span class="token punctuation">(</span><span class="token string">&quot;/index&quot;</span><span class="token punctuation">)</span>
<span class="token keyword">def</span> <span class="token function">hello</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token keyword">return</span> render_template<span class="token punctuation">(</span><span class="token string">&quot;index.html&quot;</span><span class="token punctuation">,</span> title<span class="token operator">=</span><span class="token string">&quot;My Title!&quot;</span><span class="token punctuation">,</span>
                                text<span class="token operator">=</span><span class="token string">&quot;My text is typed here!!!!!&quot;</span><span class="token punctuation">,</span>
                                user <span class="token operator">=</span> User<span class="token punctuation">(</span><span class="token string">&quot;Adam&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;Smith&quot;</span><span class="token punctuation">)</span><span class="token punctuation">)</span>

<span class="token keyword">if</span> __name__ <span class="token operator">==</span> <span class="token string">&quot;__main__&quot;</span><span class="token punctuation">:</span>
    app<span class="token punctuation">.</span>run<span class="token punctuation">(</span>host<span class="token operator">=</span> <span class="token string">'0.0.0.0'</span><span class="token punctuation">,</span> port <span class="token operator">=</span> <span class="token number">5000</span><span class="token punctuation">,</span> debug<span class="token operator">=</span><span class="token boolean">True</span><span class="token punctuation">)</span>
</code></pre></div><h3 id="passing-params-through-uri"><a href="#passing-params-through-uri" aria-hidden="true" class="header-anchor">#</a> Passing Params through URI</h3> <div class="language-python extra-class"><pre class="language-python"><code><span class="token decorator annotation punctuation">@app<span class="token punctuation">.</span>route</span><span class="token punctuation">(</span><span class="token string">'/'</span><span class="token punctuation">,</span> defaults<span class="token operator">=</span><span class="token punctuation">{</span><span class="token string">'path'</span><span class="token punctuation">:</span> <span class="token string">''</span><span class="token punctuation">}</span><span class="token punctuation">)</span>
@app<span class="token punctuation">.</span>route<span class="token punctuation">(</span><span class="token string">'/&lt;path:path&gt;'</span><span class="token punctuation">)</span>
<span class="token keyword">def</span> <span class="token function">get_dir</span><span class="token punctuation">(</span>path<span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token comment"># do some stuff</span>
    <span class="token keyword">return</span> path
You can typecast <span class="token punctuation">(</span>well kinda<span class="token punctuation">)</span> the arguments <span class="token keyword">in</span> three ways<span class="token punctuation">,</span> path<span class="token punctuation">,</span> <span class="token builtin">int</span> <span class="token keyword">and</span> <span class="token builtin">float</span><span class="token punctuation">,</span> nothing means string<span class="token punctuation">.</span>

<span class="token operator">&lt;</span><span class="token builtin">int</span><span class="token punctuation">:</span>stuff<span class="token operator">&gt;</span> <span class="token comment"># accepts integers (typecasts)</span>
<span class="token operator">&lt;</span><span class="token builtin">float</span><span class="token punctuation">:</span>stuff<span class="token operator">&gt;</span> <span class="token comment"># like int but for floating point values</span>
<span class="token operator">&lt;</span>path<span class="token punctuation">:</span>stuff<span class="token operator">&gt;</span> <span class="token comment"># like the default but also accepts slashes</span>
<span class="token operator">&lt;</span>stuff<span class="token operator">&gt;</span> <span class="token comment"># Default</span>
</code></pre></div><h3 id="handle-form-post-requests"><a href="#handle-form-post-requests" aria-hidden="true" class="header-anchor">#</a> Handle Form POST Requests</h3> <p><a href="http://code.runnable.com/UhLMQLffO1YSAADK/handle-a-post-request-in-flask-for-python" target="_blank" rel="noopener noreferrer">http://code.runnable.com/UhLMQLffO1YSAADK/handle-a-post-request-in-flask-for-python<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></p> <div class="language-python extra-class"><pre class="language-python"><code><span class="token decorator annotation punctuation">@app<span class="token punctuation">.</span>route</span><span class="token punctuation">(</span><span class="token string">'/hello'</span><span class="token punctuation">,</span> methods<span class="token operator">=</span><span class="token punctuation">[</span><span class="token string">'POST'</span><span class="token punctuation">]</span><span class="token punctuation">)</span>
<span class="token keyword">def</span> <span class="token function">hello</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
    name<span class="token operator">=</span>request<span class="token punctuation">.</span>form<span class="token punctuation">[</span><span class="token string">'yourname'</span><span class="token punctuation">]</span>
    email<span class="token operator">=</span>request<span class="token punctuation">.</span>form<span class="token punctuation">[</span><span class="token string">'youremail'</span><span class="token punctuation">]</span>
    <span class="token keyword">return</span> render_template<span class="token punctuation">(</span><span class="token string">'form_action.html'</span><span class="token punctuation">,</span> name<span class="token operator">=</span>name<span class="token punctuation">,</span> email<span class="token operator">=</span>email<span class="token punctuation">)</span>
</code></pre></div><h3 id="handle-url-arguments"><a href="#handle-url-arguments" aria-hidden="true" class="header-anchor">#</a> Handle URL Arguments</h3> <p><a href="http://code.runnable.com/Uhf58hcCo9RSAACs/using-sessions-in-flask-for-python" target="_blank" rel="noopener noreferrer">http://code.runnable.com/Uhf58hcCo9RSAACs/using-sessions-in-flask-for-python<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></p> <div class="language-python extra-class"><pre class="language-python"><code><span class="token decorator annotation punctuation">@app<span class="token punctuation">.</span>route</span><span class="token punctuation">(</span><span class="token string">'/form'</span><span class="token punctuation">)</span>
<span class="token keyword">def</span> <span class="token function">form</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span> <span class="token comment"># &quot;GET /form?yourname=fff HTTP/1.1&quot;</span>
  sumSessionCounter<span class="token punctuation">(</span><span class="token punctuation">)</span>

  <span class="token comment"># if a name has been sent, store it on a session variable</span>
  <span class="token keyword">if</span> request<span class="token punctuation">.</span>args<span class="token punctuation">.</span>get<span class="token punctuation">(</span><span class="token string">'yourname'</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
    session<span class="token punctuation">[</span><span class="token string">'name'</span><span class="token punctuation">]</span> <span class="token operator">=</span> request<span class="token punctuation">.</span>args<span class="token punctuation">.</span>get<span class="token punctuation">(</span><span class="token string">'yourname'</span><span class="token punctuation">)</span>
    <span class="token comment"># And then redirect the user to the main page</span>
    <span class="token keyword">return</span> redirect<span class="token punctuation">(</span>url_for<span class="token punctuation">(</span><span class="token string">'index'</span><span class="token punctuation">)</span><span class="token punctuation">)</span>

  <span class="token keyword">else</span><span class="token punctuation">:</span>
    <span class="token comment"># If no name has been sent, show the form</span>
    <span class="token keyword">return</span> render_template<span class="token punctuation">(</span><span class="token string">'form.html'</span><span class="token punctuation">,</span> session<span class="token operator">=</span>session<span class="token punctuation">)</span>
</code></pre></div><p>Flask with AngularJS:</p> <p><a href="https://realpython.com/blog/python/flask-by-example-integrating-flask-and-angularjs/" target="_blank" rel="noopener noreferrer">https://realpython.com/blog/python/flask-by-example-integrating-flask-and-angularjs/<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></p> <p>Flask with JQuery:</p> <p><a href="http://www.giantflyingsaucer.com/blog/?p=4310" target="_blank" rel="noopener noreferrer">http://www.giantflyingsaucer.com/blog/?p=4310<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></p> <h2 id="jython"><a href="#jython" aria-hidden="true" class="header-anchor">#</a> Jython</h2> <p><strong>Distributing a JAR</strong> <a href="http://www.jython.org/jythonbook/en/1.0/SimpleWebApps.html#distributing-via-standalone-jar" target="_blank" rel="noopener noreferrer">http://www.jython.org/jythonbook/en/1.0/SimpleWebApps.html#distributing-via-standalone-jar<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></p> <p><strong>JDBC</strong> <a href="https://wiki.python.org/jython/DatabaseExamples" target="_blank" rel="noopener noreferrer">https://wiki.python.org/jython/DatabaseExamples<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a> <a href="http://www.jython.org/jythonbook/en/1.0/DatabasesAndJython.html" target="_blank" rel="noopener noreferrer">http://www.jython.org/jythonbook/en/1.0/DatabasesAndJython.html<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></p> <h2 id="scrapy"><a href="#scrapy" aria-hidden="true" class="header-anchor">#</a> Scrapy</h2> <p><strong>Extract all images</strong>:</p> <div class="language-python extra-class"><pre class="language-python"><code><span class="token keyword">from</span> scrapy<span class="token punctuation">.</span>selector <span class="token keyword">import</span> Selector
<span class="token keyword">from</span> scrapy<span class="token punctuation">.</span>http <span class="token keyword">import</span> HtmlResponse

response <span class="token operator">=</span> HtmlResponse<span class="token punctuation">(</span>url<span class="token operator">=</span><span class="token string">'http://example.com'</span><span class="token punctuation">,</span> body<span class="token operator">=</span>html_text<span class="token punctuation">,</span> encoding<span class="token operator">=</span><span class="token string">'utf8'</span><span class="token punctuation">)</span>
response<span class="token punctuation">.</span>css<span class="token punctuation">(</span><span class="token string">'img'</span><span class="token punctuation">)</span><span class="token punctuation">.</span>xpath<span class="token punctuation">(</span><span class="token string">'@src'</span><span class="token punctuation">)</span><span class="token punctuation">.</span>extract<span class="token punctuation">(</span><span class="token punctuation">)</span>
</code></pre></div><p><strong>Using CSS</strong></p> <div class="language-python extra-class"><pre class="language-python"><code><span class="token keyword">from</span> scrapy<span class="token punctuation">.</span>selector <span class="token keyword">import</span> Selector
<span class="token keyword">from</span> scrapy<span class="token punctuation">.</span>http <span class="token keyword">import</span> HtmlResponse

response <span class="token operator">=</span> HtmlResponse<span class="token punctuation">(</span>url<span class="token operator">=</span><span class="token string">'http://example.com'</span><span class="token punctuation">,</span> body<span class="token operator">=</span>html_text<span class="token punctuation">,</span> encoding<span class="token operator">=</span><span class="token string">'utf8'</span><span class="token punctuation">)</span>
results <span class="token operator">=</span> response<span class="token punctuation">.</span>css<span class="token punctuation">(</span>css_selector_str1<span class="token punctuation">)</span>
item <span class="token operator">=</span> results<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span>
text <span class="token operator">=</span> item<span class="token punctuation">.</span>css<span class="token punctuation">(</span>css_selector_str2 <span class="token operator">+</span> <span class="token string">'::text'</span><span class="token punctuation">)</span><span class="token punctuation">.</span>extract<span class="token punctuation">(</span><span class="token punctuation">)</span>
</code></pre></div><h1 id="ssh"><a href="#ssh" aria-hidden="true" class="header-anchor">#</a> SSH</h1> <div class="language-python extra-class"><pre class="language-python"><code><span class="token keyword">class</span> <span class="token class-name">Server</span><span class="token punctuation">(</span><span class="token builtin">object</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
  <span class="token keyword">def</span> <span class="token function">__init__</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> name<span class="token punctuation">,</span> ip<span class="token punctuation">,</span> username<span class="token punctuation">,</span> password<span class="token operator">=</span><span class="token boolean">None</span><span class="token punctuation">,</span> key_path<span class="token operator">=</span><span class="token boolean">None</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
    self<span class="token punctuation">.</span>port <span class="token operator">=</span> <span class="token number">22</span>
    <span class="token keyword">if</span> <span class="token string">&quot;:&quot;</span> <span class="token keyword">in</span> ip<span class="token punctuation">:</span>
        self<span class="token punctuation">.</span>port <span class="token operator">=</span> <span class="token builtin">int</span><span class="token punctuation">(</span>ip<span class="token punctuation">.</span>split<span class="token punctuation">(</span><span class="token string">&quot;:&quot;</span><span class="token punctuation">)</span><span class="token punctuation">[</span><span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">)</span>
        ip <span class="token operator">=</span> ip<span class="token punctuation">.</span>split<span class="token punctuation">(</span><span class="token string">&quot;:&quot;</span><span class="token punctuation">)</span><span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span>

    <span class="token keyword">import</span> paramiko
    self<span class="token punctuation">.</span>name <span class="token operator">=</span> name
    self<span class="token punctuation">.</span>ip <span class="token operator">=</span> ip
    self<span class="token punctuation">.</span>username <span class="token operator">=</span> username
    self<span class="token punctuation">.</span>password <span class="token operator">=</span> password
    self<span class="token punctuation">.</span>temp_path <span class="token operator">=</span> <span class="token string">&quot;/temp&quot;</span>
    self<span class="token punctuation">.</span>cores <span class="token operator">=</span> <span class="token number">0</span>
    self<span class="token punctuation">.</span>jobs_running <span class="token operator">=</span> <span class="token number">0</span>
    self<span class="token punctuation">.</span>connect_tries <span class="token operator">=</span> <span class="token number">0</span>
    self<span class="token punctuation">.</span>connected <span class="token operator">=</span> <span class="token boolean">False</span>
    self<span class="token punctuation">.</span>core_id_status <span class="token operator">=</span> <span class="token punctuation">{</span><span class="token punctuation">}</span>
    self<span class="token punctuation">.</span>core_id_queue <span class="token operator">=</span> <span class="token punctuation">{</span><span class="token punctuation">}</span>
    self<span class="token punctuation">.</span>core_id_lock <span class="token operator">=</span> <span class="token punctuation">{</span><span class="token punctuation">}</span>

    self<span class="token punctuation">.</span>key <span class="token operator">=</span> paramiko<span class="token punctuation">.</span>RSAKey<span class="token punctuation">.</span>from_private_key_file<span class="token punctuation">(</span>key_path<span class="token punctuation">)</span> <span class="token keyword">if</span> key_path <span class="token keyword">else</span> <span class="token boolean">None</span>

    self<span class="token punctuation">.</span>ssh_client <span class="token operator">=</span> paramiko<span class="token punctuation">.</span>SSHClient<span class="token punctuation">(</span><span class="token punctuation">)</span>
    self<span class="token punctuation">.</span>ssh_client<span class="token punctuation">.</span>set_missing_host_key_policy<span class="token punctuation">(</span>paramiko<span class="token punctuation">.</span>AutoAddPolicy<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
    self<span class="token punctuation">.</span>status <span class="token operator">=</span> Status<span class="token punctuation">(</span>text<span class="token operator">=</span><span class="token string">''</span><span class="token punctuation">,</span> spinner<span class="token operator">=</span><span class="token string">'dots'</span><span class="token punctuation">)</span>


  <span class="token keyword">def</span> <span class="token function">ssh_connect</span><span class="token punctuation">(</span>self<span class="token punctuation">)</span><span class="token punctuation">:</span>
    self<span class="token punctuation">.</span>connect_tries <span class="token operator">+=</span> <span class="token number">1</span>

    <span class="token keyword">try</span><span class="token punctuation">:</span>
      <span class="token keyword">with</span> Status<span class="token punctuation">(</span>text<span class="token operator">=</span><span class="token string">'Connecting to '</span> <span class="token operator">+</span> self<span class="token punctuation">.</span>ip<span class="token punctuation">,</span> spinner<span class="token operator">=</span><span class="token string">'dots'</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
        self<span class="token punctuation">.</span>ssh_client<span class="token punctuation">.</span>connect<span class="token punctuation">(</span>self<span class="token punctuation">.</span>ip<span class="token punctuation">,</span> self<span class="token punctuation">.</span>port<span class="token punctuation">,</span> self<span class="token punctuation">.</span>username<span class="token punctuation">,</span> self<span class="token punctuation">.</span>password<span class="token punctuation">,</span> timeout<span class="token operator">=</span><span class="token number">4</span><span class="token punctuation">,</span> pkey<span class="token operator">=</span>self<span class="token punctuation">.</span>key<span class="token punctuation">)</span>
        self<span class="token punctuation">.</span>sftp <span class="token operator">=</span> self<span class="token punctuation">.</span>ssh_client<span class="token punctuation">.</span>open_sftp<span class="token punctuation">(</span><span class="token punctuation">)</span>
      self<span class="token punctuation">.</span>connected <span class="token operator">=</span> <span class="token boolean">True</span>
      log<span class="token punctuation">(</span><span class="token string">&quot;Successful Connection to &quot;</span> <span class="token operator">+</span> self<span class="token punctuation">.</span>name <span class="token operator">+</span> <span class="token string">&quot; (%s)&quot;</span> <span class="token operator">%</span> self<span class="token punctuation">.</span>ip<span class="token punctuation">)</span>
      <span class="token keyword">return</span> self<span class="token punctuation">.</span>connected

      <span class="token comment">#self.channel = self.ssh_client.get_transport().open_session()</span>

      <span class="token comment"># Get CPU cores</span>
      stdin<span class="token punctuation">,</span> stdout<span class="token punctuation">,</span> stderr <span class="token operator">=</span> self<span class="token punctuation">.</span>ssh_client<span class="token punctuation">.</span>exec_command<span class="token punctuation">(</span><span class="token string">'cat /proc/cpuinfo'</span><span class="token punctuation">)</span>
      output <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span>
      <span class="token keyword">for</span> line <span class="token keyword">in</span> stdout<span class="token punctuation">.</span>readlines<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span> output<span class="token punctuation">.</span>append<span class="token punctuation">(</span>line<span class="token punctuation">.</span>replace<span class="token punctuation">(</span><span class="token string">'\n'</span><span class="token punctuation">,</span><span class="token string">''</span><span class="token punctuation">)</span><span class="token punctuation">)</span>

      <span class="token keyword">for</span> line <span class="token keyword">in</span> output<span class="token punctuation">:</span>
        line_arr <span class="token operator">=</span> line<span class="token punctuation">.</span>split<span class="token punctuation">(</span><span class="token punctuation">)</span>
        <span class="token keyword">try</span><span class="token punctuation">:</span>
          <span class="token keyword">if</span> line_arr<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span> <span class="token operator">==</span> <span class="token string">'processor'</span><span class="token punctuation">:</span>
            self<span class="token punctuation">.</span>cores <span class="token operator">=</span> self<span class="token punctuation">.</span>cores <span class="token operator">+</span> <span class="token number">1</span>
            self<span class="token punctuation">.</span>core_id_status<span class="token punctuation">[</span>self<span class="token punctuation">.</span>cores<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token string">'free'</span>
            self<span class="token punctuation">.</span>core_id_queue<span class="token punctuation">[</span>self<span class="token punctuation">.</span>cores<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token string">'no'</span>
            self<span class="token punctuation">.</span>core_id_lock<span class="token punctuation">[</span>self<span class="token punctuation">.</span>cores<span class="token punctuation">]</span> <span class="token operator">=</span> threading<span class="token punctuation">.</span>RLock<span class="token punctuation">(</span><span class="token punctuation">)</span>
        <span class="token keyword">except</span><span class="token punctuation">:</span>
            <span class="token keyword">pass</span>
    <span class="token keyword">except</span><span class="token punctuation">:</span>
      error_message <span class="token operator">=</span> <span class="token string">&quot;Failed to connect to &quot;</span> <span class="token operator">+</span> self<span class="token punctuation">.</span>name <span class="token operator">+</span> <span class="token string">&quot; (%s)&quot;</span> <span class="token operator">%</span> self<span class="token punctuation">.</span>ip <span class="token operator">+</span> <span class="token string">&quot; -&gt; &quot;</span> <span class="token operator">+</span> get_exception_message<span class="token punctuation">(</span><span class="token punctuation">)</span>
      log<span class="token punctuation">(</span>error_message<span class="token punctuation">,</span> color<span class="token operator">=</span><span class="token string">'red'</span><span class="token punctuation">)</span>
      <span class="token keyword">return</span> self<span class="token punctuation">.</span>connected

  <span class="token keyword">def</span> <span class="token function">ssh_command</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> command<span class="token punctuation">,</span> wait_for_output <span class="token operator">=</span> <span class="token boolean">True</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token keyword">not</span> self<span class="token punctuation">.</span>connected<span class="token punctuation">)</span><span class="token punctuation">:</span> self<span class="token punctuation">.</span>ssh_connect<span class="token punctuation">(</span><span class="token punctuation">)</span>

    <span class="token keyword">try</span><span class="token punctuation">:</span>
      stdin<span class="token punctuation">,</span> stdout<span class="token punctuation">,</span> stderr <span class="token operator">=</span> self<span class="token punctuation">.</span>ssh_client<span class="token punctuation">.</span>exec_command<span class="token punctuation">(</span>command<span class="token punctuation">)</span>
    <span class="token keyword">except</span> socket<span class="token punctuation">.</span>error <span class="token keyword">as</span> e<span class="token punctuation">:</span>
      <span class="token comment"># not connected?</span>
      self<span class="token punctuation">.</span>connected <span class="token operator">=</span> <span class="token boolean">False</span>
      self<span class="token punctuation">.</span>ssh_connect<span class="token punctuation">(</span><span class="token punctuation">)</span>
      stdin<span class="token punctuation">,</span> stdout<span class="token punctuation">,</span> stderr <span class="token operator">=</span> self<span class="token punctuation">.</span>ssh_client<span class="token punctuation">.</span>exec_command<span class="token punctuation">(</span>command<span class="token punctuation">)</span>

    self<span class="token punctuation">.</span>last_output <span class="token operator">=</span> <span class="token string">''</span>
    self<span class="token punctuation">.</span>last_output_lines <span class="token operator">=</span> <span class="token number">0</span>

    <span class="token keyword">if</span><span class="token punctuation">(</span>wait_for_output<span class="token punctuation">)</span><span class="token punctuation">:</span>
      self<span class="token punctuation">.</span>ssh_chan_status <span class="token operator">=</span> stdout<span class="token punctuation">.</span>channel<span class="token punctuation">.</span>recv_exit_status<span class="token punctuation">(</span><span class="token punctuation">)</span>
      <span class="token keyword">for</span> line <span class="token keyword">in</span> stdout<span class="token punctuation">.</span>readlines<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
        self<span class="token punctuation">.</span>last_output <span class="token operator">=</span> self<span class="token punctuation">.</span>last_output <span class="token operator">+</span> line
        self<span class="token punctuation">.</span>last_output_lines <span class="token operator">+=</span> <span class="token number">1</span>

    <span class="token keyword">return</span> self<span class="token punctuation">.</span>last_output

  <span class="token keyword">def</span> <span class="token function">sftp_copy_from</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> remote_filepath<span class="token punctuation">,</span> local_filepath<span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token keyword">not</span> self<span class="token punctuation">.</span>test_connection<span class="token punctuation">)</span><span class="token punctuation">:</span> self<span class="token punctuation">.</span>ssh_connect<span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token comment"># copy file from remote server object to local path</span>
    log<span class="token punctuation">(</span><span class="token string">&quot;Downloading from '&quot;</span> <span class="token operator">+</span> remote_filepath <span class="token operator">+</span> <span class="token string">&quot;' to '&quot;</span> <span class="token operator">+</span> local_filepath <span class="token operator">+</span> <span class="token string">&quot;'&quot;</span><span class="token punctuation">)</span>
    <span class="token keyword">try</span><span class="token punctuation">:</span>
      self<span class="token punctuation">.</span>status<span class="token punctuation">.</span>start<span class="token punctuation">(</span><span class="token punctuation">)</span>
      self<span class="token punctuation">.</span>last_stat <span class="token operator">=</span> <span class="token boolean">None</span>
      self<span class="token punctuation">.</span>sftp<span class="token punctuation">.</span>get<span class="token punctuation">(</span>remote_filepath<span class="token punctuation">,</span> local_filepath<span class="token punctuation">,</span> callback<span class="token operator">=</span>self<span class="token punctuation">.</span>transfer_progress<span class="token punctuation">)</span>
      self<span class="token punctuation">.</span>status<span class="token punctuation">.</span>stop<span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token keyword">except</span><span class="token punctuation">:</span>
      error_message <span class="token operator">=</span> get_exception_message<span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token string">'\nremote_filepath: '</span> <span class="token operator">+</span> self<span class="token punctuation">.</span>name <span class="token operator">+</span> <span class="token string">':'</span> <span class="token operator">+</span> remote_filepath <span class="token operator">+</span> <span class="token string">'\nlocal_filepath: '</span> <span class="token operator">+</span> local_filepath
      log<span class="token punctuation">(</span>error_message<span class="token punctuation">,</span> color<span class="token operator">=</span><span class="token string">'red'</span><span class="token punctuation">)</span>

  <span class="token keyword">def</span> <span class="token function">sftp_copy_to</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> local_filepath<span class="token punctuation">,</span> remote_filepath<span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token keyword">not</span> self<span class="token punctuation">.</span>test_connection<span class="token punctuation">)</span><span class="token punctuation">:</span> self<span class="token punctuation">.</span>ssh_connect<span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token comment"># copy file from local path to remote server object</span>
    log<span class="token punctuation">(</span><span class="token string">&quot;Uploading from '&quot;</span> <span class="token operator">+</span> local_filepath <span class="token operator">+</span> <span class="token string">&quot;' to '&quot;</span> <span class="token operator">+</span> remote_filepath  <span class="token operator">+</span> <span class="token string">&quot;'&quot;</span><span class="token punctuation">)</span>
    <span class="token keyword">try</span><span class="token punctuation">:</span>
      self<span class="token punctuation">.</span>status<span class="token punctuation">.</span>start<span class="token punctuation">(</span><span class="token punctuation">)</span>
      self<span class="token punctuation">.</span>last_stat <span class="token operator">=</span> <span class="token boolean">None</span>
      self<span class="token punctuation">.</span>sftp<span class="token punctuation">.</span>put<span class="token punctuation">(</span>local_filepath<span class="token punctuation">,</span> remote_filepath<span class="token punctuation">,</span> callback<span class="token operator">=</span>self<span class="token punctuation">.</span>transfer_progress<span class="token punctuation">)</span>
      self<span class="token punctuation">.</span>status<span class="token punctuation">.</span>stop<span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token keyword">except</span><span class="token punctuation">:</span>
      error_message <span class="token operator">=</span> get_exception_message<span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token string">'\nremote_filepath: '</span> <span class="token operator">+</span> self<span class="token punctuation">.</span>name <span class="token operator">+</span> <span class="token string">':'</span> <span class="token operator">+</span> remote_filepath <span class="token operator">+</span> <span class="token string">'\nlocal_filepath: '</span> <span class="token operator">+</span> local_filepath
      log<span class="token punctuation">(</span>error_message<span class="token punctuation">,</span> color<span class="token operator">=</span><span class="token string">'red'</span><span class="token punctuation">)</span>

  <span class="token keyword">def</span> <span class="token function">transfer_progress</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> transferred<span class="token punctuation">,</span> total<span class="token punctuation">,</span> unit<span class="token operator">=</span><span class="token string">'B'</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token string">&quot;Display transfer progress&quot;</span>
    prct <span class="token operator">=</span> <span class="token builtin">int</span><span class="token punctuation">(</span><span class="token number">100.0</span> <span class="token operator">*</span> transferred <span class="token operator">/</span> total<span class="token punctuation">)</span>
    divide <span class="token operator">=</span> <span class="token keyword">lambda</span> x<span class="token punctuation">,</span> y<span class="token punctuation">:</span> <span class="token builtin">round</span><span class="token punctuation">(</span><span class="token number">1.0</span> <span class="token operator">*</span> x <span class="token operator">/</span> <span class="token punctuation">(</span>y<span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">)</span>

    <span class="token keyword">if</span> self<span class="token punctuation">.</span>last_stat<span class="token punctuation">:</span>
      secs <span class="token operator">=</span> <span class="token punctuation">(</span>datetime<span class="token punctuation">.</span>datetime<span class="token punctuation">.</span>now<span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">-</span> self<span class="token punctuation">.</span>last_stat<span class="token punctuation">[</span><span class="token string">'time'</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">.</span>total_seconds<span class="token punctuation">(</span><span class="token punctuation">)</span>
      <span class="token keyword">if</span> secs <span class="token operator">&gt;</span> <span class="token number">2</span><span class="token punctuation">:</span>
        rate <span class="token operator">=</span> <span class="token builtin">round</span><span class="token punctuation">(</span><span class="token punctuation">(</span>transferred <span class="token operator">-</span> self<span class="token punctuation">.</span>last_stat<span class="token punctuation">[</span><span class="token string">'transferred'</span><span class="token punctuation">]</span><span class="token punctuation">)</span> <span class="token operator">/</span> secs<span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">)</span>
        self<span class="token punctuation">.</span>last_stat <span class="token operator">=</span> <span class="token builtin">dict</span><span class="token punctuation">(</span>time<span class="token operator">=</span>now<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> transferred<span class="token operator">=</span>transferred<span class="token punctuation">,</span> rate<span class="token operator">=</span>rate<span class="token punctuation">)</span>
      <span class="token keyword">else</span><span class="token punctuation">:</span>
        rate <span class="token operator">=</span> self<span class="token punctuation">.</span>last_stat<span class="token punctuation">[</span><span class="token string">'rate'</span><span class="token punctuation">]</span>
    <span class="token keyword">else</span><span class="token punctuation">:</span>
      rate <span class="token operator">=</span> <span class="token number">0</span>
      self<span class="token punctuation">.</span>last_stat <span class="token operator">=</span> <span class="token builtin">dict</span><span class="token punctuation">(</span>time<span class="token operator">=</span>now<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> transferred<span class="token operator">=</span>transferred<span class="token punctuation">,</span> rate<span class="token operator">=</span>rate<span class="token punctuation">)</span>

    <span class="token keyword">if</span> total <span class="token operator">&gt;</span> <span class="token number">1024</span> <span class="token operator">**</span> <span class="token number">3</span><span class="token punctuation">:</span>
      transferred <span class="token operator">=</span> divide<span class="token punctuation">(</span>transferred<span class="token punctuation">,</span> <span class="token number">1024</span> <span class="token operator">**</span> <span class="token number">3</span><span class="token punctuation">)</span>
      total <span class="token operator">=</span> divide<span class="token punctuation">(</span>total<span class="token punctuation">,</span> <span class="token number">1024</span> <span class="token operator">**</span> <span class="token number">3</span><span class="token punctuation">)</span>
      unit<span class="token operator">=</span><span class="token string">'GB'</span>
      rate <span class="token operator">=</span> <span class="token string">'{} {} / sec'</span><span class="token punctuation">.</span><span class="token builtin">format</span><span class="token punctuation">(</span>divide<span class="token punctuation">(</span>rate<span class="token punctuation">,</span> <span class="token number">1024</span> <span class="token operator">**</span> <span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token string">'MB'</span><span class="token punctuation">)</span>
    <span class="token keyword">elif</span> total <span class="token operator">&gt;</span> <span class="token number">1024</span> <span class="token operator">**</span> <span class="token number">2</span><span class="token punctuation">:</span>
      transferred <span class="token operator">=</span> divide<span class="token punctuation">(</span>transferred<span class="token punctuation">,</span> <span class="token number">1024</span> <span class="token operator">**</span> <span class="token number">2</span><span class="token punctuation">)</span>
      total <span class="token operator">=</span> divide<span class="token punctuation">(</span>total<span class="token punctuation">,</span> <span class="token number">1024</span> <span class="token operator">**</span> <span class="token number">2</span><span class="token punctuation">)</span>
      unit<span class="token operator">=</span><span class="token string">'MB'</span>
      rate <span class="token operator">=</span> <span class="token string">'{} {} / sec'</span><span class="token punctuation">.</span><span class="token builtin">format</span><span class="token punctuation">(</span>divide<span class="token punctuation">(</span>rate<span class="token punctuation">,</span> <span class="token number">1024</span> <span class="token operator">**</span> <span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">,</span> unit<span class="token punctuation">)</span>
    <span class="token keyword">elif</span> total <span class="token operator">&gt;</span> <span class="token number">1024</span> <span class="token operator">**</span> <span class="token number">1</span><span class="token punctuation">:</span>
      transferred <span class="token operator">=</span> divide<span class="token punctuation">(</span>transferred<span class="token punctuation">,</span> <span class="token number">1024</span> <span class="token operator">**</span> <span class="token number">1</span><span class="token punctuation">)</span>
      total <span class="token operator">=</span> divide<span class="token punctuation">(</span>total<span class="token punctuation">,</span> <span class="token number">1024</span> <span class="token operator">**</span> <span class="token number">1</span><span class="token punctuation">)</span>
      unit<span class="token operator">=</span><span class="token string">'KB'</span>
      rate <span class="token operator">=</span> <span class="token string">'{} {} / sec'</span><span class="token punctuation">.</span><span class="token builtin">format</span><span class="token punctuation">(</span>divide<span class="token punctuation">(</span>rate<span class="token punctuation">,</span> <span class="token number">1024</span> <span class="token operator">**</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">,</span> unit<span class="token punctuation">)</span>
    self<span class="token punctuation">.</span>status<span class="token punctuation">.</span>text <span class="token operator">=</span> <span class="token string">'{}% Complete: {} / {} {} @ {}'</span><span class="token punctuation">.</span><span class="token builtin">format</span><span class="token punctuation">(</span>prct<span class="token punctuation">,</span> transferred<span class="token punctuation">,</span> total<span class="token punctuation">,</span> unit<span class="token punctuation">,</span> rate<span class="token punctuation">)</span>

  <span class="token keyword">def</span> <span class="token function">test_connection</span><span class="token punctuation">(</span>self<span class="token punctuation">)</span><span class="token punctuation">:</span>
    stdout <span class="token operator">=</span> self<span class="token punctuation">.</span>ssh_client<span class="token punctuation">.</span>exec_command<span class="token punctuation">(</span><span class="token string">'ls'</span><span class="token punctuation">)</span>
    <span class="token keyword">return</span> self<span class="token punctuation">.</span>connected


  <span class="token keyword">def</span> <span class="token function">__init__</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> name<span class="token punctuation">,</span> ip<span class="token punctuation">,</span> username<span class="token punctuation">,</span> password<span class="token punctuation">)</span><span class="token punctuation">:</span>
    self<span class="token punctuation">.</span>port <span class="token operator">=</span> <span class="token number">22</span>
    <span class="token keyword">if</span> <span class="token string">&quot;:&quot;</span> <span class="token keyword">in</span> ip<span class="token punctuation">:</span>
        self<span class="token punctuation">.</span>port <span class="token operator">=</span> <span class="token builtin">int</span><span class="token punctuation">(</span>ip<span class="token punctuation">.</span>split<span class="token punctuation">(</span><span class="token string">&quot;:&quot;</span><span class="token punctuation">)</span><span class="token punctuation">[</span><span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">)</span>
        ip <span class="token operator">=</span> ip<span class="token punctuation">.</span>split<span class="token punctuation">(</span><span class="token string">&quot;:&quot;</span><span class="token punctuation">)</span><span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span>

    <span class="token keyword">import</span> paramiko
    self<span class="token punctuation">.</span>name <span class="token operator">=</span> name
    self<span class="token punctuation">.</span>ip <span class="token operator">=</span> ip
    self<span class="token punctuation">.</span>username <span class="token operator">=</span> username
    self<span class="token punctuation">.</span>password <span class="token operator">=</span> password
    self<span class="token punctuation">.</span>temp_path <span class="token operator">=</span> <span class="token string">&quot;/temp&quot;</span>
    self<span class="token punctuation">.</span>cores <span class="token operator">=</span> <span class="token number">0</span>
    self<span class="token punctuation">.</span>jobs_running <span class="token operator">=</span> <span class="token number">0</span>
    self<span class="token punctuation">.</span>connect_tries <span class="token operator">=</span> <span class="token number">0</span>
    self<span class="token punctuation">.</span>connected <span class="token operator">=</span> <span class="token boolean">False</span>
    self<span class="token punctuation">.</span>core_id_status <span class="token operator">=</span> <span class="token punctuation">{</span><span class="token punctuation">}</span>
    self<span class="token punctuation">.</span>core_id_queue <span class="token operator">=</span> <span class="token punctuation">{</span><span class="token punctuation">}</span>
    self<span class="token punctuation">.</span>core_id_lock <span class="token operator">=</span> <span class="token punctuation">{</span><span class="token punctuation">}</span>

    self<span class="token punctuation">.</span>ssh_client <span class="token operator">=</span> paramiko<span class="token punctuation">.</span>SSHClient<span class="token punctuation">(</span><span class="token punctuation">)</span>
    self<span class="token punctuation">.</span>ssh_client<span class="token punctuation">.</span>set_missing_host_key_policy<span class="token punctuation">(</span>paramiko<span class="token punctuation">.</span>AutoAddPolicy<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
    self<span class="token punctuation">.</span>status <span class="token operator">=</span> Status<span class="token punctuation">(</span>text<span class="token operator">=</span><span class="token string">''</span><span class="token punctuation">,</span> spinner<span class="token operator">=</span><span class="token string">'dots'</span><span class="token punctuation">)</span>


  <span class="token keyword">def</span> <span class="token function">ssh_connect</span><span class="token punctuation">(</span>self<span class="token punctuation">)</span><span class="token punctuation">:</span>
    self<span class="token punctuation">.</span>connect_tries <span class="token operator">+=</span> <span class="token number">1</span>

    <span class="token keyword">try</span><span class="token punctuation">:</span>
      <span class="token keyword">with</span> Status<span class="token punctuation">(</span>text<span class="token operator">=</span><span class="token string">'Connecting to '</span> <span class="token operator">+</span> self<span class="token punctuation">.</span>ip<span class="token punctuation">,</span> spinner<span class="token operator">=</span><span class="token string">'dots'</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
        self<span class="token punctuation">.</span>ssh_client<span class="token punctuation">.</span>connect<span class="token punctuation">(</span>self<span class="token punctuation">.</span>ip<span class="token punctuation">,</span> self<span class="token punctuation">.</span>port<span class="token punctuation">,</span> self<span class="token punctuation">.</span>username<span class="token punctuation">,</span> self<span class="token punctuation">.</span>password<span class="token punctuation">,</span> timeout<span class="token operator">=</span><span class="token number">4</span><span class="token punctuation">)</span>
        self<span class="token punctuation">.</span>sftp <span class="token operator">=</span> self<span class="token punctuation">.</span>ssh_client<span class="token punctuation">.</span>open_sftp<span class="token punctuation">(</span><span class="token punctuation">)</span>
      self<span class="token punctuation">.</span>connected <span class="token operator">=</span> <span class="token boolean">True</span>
      log<span class="token punctuation">(</span><span class="token string">&quot;Successful Connection to &quot;</span> <span class="token operator">+</span> self<span class="token punctuation">.</span>name <span class="token operator">+</span> <span class="token string">&quot; (%s)&quot;</span> <span class="token operator">%</span> self<span class="token punctuation">.</span>ip<span class="token punctuation">)</span>
      <span class="token keyword">return</span> self<span class="token punctuation">.</span>connected

      <span class="token comment">#self.channel = self.ssh_client.get_transport().open_session()</span>

      <span class="token comment"># Get CPU cores</span>
      stdin<span class="token punctuation">,</span> stdout<span class="token punctuation">,</span> stderr <span class="token operator">=</span> self<span class="token punctuation">.</span>ssh_client<span class="token punctuation">.</span>exec_command<span class="token punctuation">(</span><span class="token string">'cat /proc/cpuinfo'</span><span class="token punctuation">)</span>
      output <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span>
      <span class="token keyword">for</span> line <span class="token keyword">in</span> stdout<span class="token punctuation">.</span>readlines<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span> output<span class="token punctuation">.</span>append<span class="token punctuation">(</span>line<span class="token punctuation">.</span>replace<span class="token punctuation">(</span><span class="token string">'\n'</span><span class="token punctuation">,</span><span class="token string">''</span><span class="token punctuation">)</span><span class="token punctuation">)</span>

      <span class="token keyword">for</span> line <span class="token keyword">in</span> output<span class="token punctuation">:</span>
        line_arr <span class="token operator">=</span> line<span class="token punctuation">.</span>split<span class="token punctuation">(</span><span class="token punctuation">)</span>
        <span class="token keyword">try</span><span class="token punctuation">:</span>
          <span class="token keyword">if</span> line_arr<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span> <span class="token operator">==</span> <span class="token string">'processor'</span><span class="token punctuation">:</span>
            self<span class="token punctuation">.</span>cores <span class="token operator">=</span> self<span class="token punctuation">.</span>cores <span class="token operator">+</span> <span class="token number">1</span>
            self<span class="token punctuation">.</span>core_id_status<span class="token punctuation">[</span>self<span class="token punctuation">.</span>cores<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token string">'free'</span>
            self<span class="token punctuation">.</span>core_id_queue<span class="token punctuation">[</span>self<span class="token punctuation">.</span>cores<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token string">'no'</span>
            self<span class="token punctuation">.</span>core_id_lock<span class="token punctuation">[</span>self<span class="token punctuation">.</span>cores<span class="token punctuation">]</span> <span class="token operator">=</span> threading<span class="token punctuation">.</span>RLock<span class="token punctuation">(</span><span class="token punctuation">)</span>
        <span class="token keyword">except</span><span class="token punctuation">:</span>
            <span class="token keyword">pass</span>
    <span class="token keyword">except</span><span class="token punctuation">:</span>
      error_message <span class="token operator">=</span> <span class="token string">&quot;Failed to connect to &quot;</span> <span class="token operator">+</span> self<span class="token punctuation">.</span>name <span class="token operator">+</span> <span class="token string">&quot; (%s)&quot;</span> <span class="token operator">%</span> self<span class="token punctuation">.</span>ip <span class="token operator">+</span> <span class="token string">&quot; -&gt; &quot;</span> <span class="token operator">+</span> get_exception_message<span class="token punctuation">(</span><span class="token punctuation">)</span>
      log<span class="token punctuation">(</span>error_message<span class="token punctuation">,</span> color<span class="token operator">=</span><span class="token string">'red'</span><span class="token punctuation">)</span>
      <span class="token keyword">return</span> self<span class="token punctuation">.</span>connected

  <span class="token keyword">def</span> <span class="token function">ssh_command</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> command<span class="token punctuation">,</span> wait_for_output <span class="token operator">=</span> <span class="token boolean">True</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token keyword">not</span> self<span class="token punctuation">.</span>connected<span class="token punctuation">)</span><span class="token punctuation">:</span> self<span class="token punctuation">.</span>ssh_connect<span class="token punctuation">(</span><span class="token punctuation">)</span>

    <span class="token keyword">try</span><span class="token punctuation">:</span>
      stdin<span class="token punctuation">,</span> stdout<span class="token punctuation">,</span> stderr <span class="token operator">=</span> self<span class="token punctuation">.</span>ssh_client<span class="token punctuation">.</span>exec_command<span class="token punctuation">(</span>command<span class="token punctuation">)</span>
    <span class="token keyword">except</span> socket<span class="token punctuation">.</span>error <span class="token keyword">as</span> e<span class="token punctuation">:</span>
      <span class="token comment"># not connected?</span>
      self<span class="token punctuation">.</span>connected <span class="token operator">=</span> <span class="token boolean">False</span>
      self<span class="token punctuation">.</span>ssh_connect<span class="token punctuation">(</span><span class="token punctuation">)</span>
      stdin<span class="token punctuation">,</span> stdout<span class="token punctuation">,</span> stderr <span class="token operator">=</span> self<span class="token punctuation">.</span>ssh_client<span class="token punctuation">.</span>exec_command<span class="token punctuation">(</span>command<span class="token punctuation">)</span>

    self<span class="token punctuation">.</span>last_output <span class="token operator">=</span> <span class="token string">''</span>
    self<span class="token punctuation">.</span>last_output_lines <span class="token operator">=</span> <span class="token number">0</span>

    <span class="token keyword">if</span><span class="token punctuation">(</span>wait_for_output<span class="token punctuation">)</span><span class="token punctuation">:</span>
      self<span class="token punctuation">.</span>ssh_chan_status <span class="token operator">=</span> stdout<span class="token punctuation">.</span>channel<span class="token punctuation">.</span>recv_exit_status<span class="token punctuation">(</span><span class="token punctuation">)</span>
      <span class="token keyword">for</span> line <span class="token keyword">in</span> stdout<span class="token punctuation">.</span>readlines<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
        self<span class="token punctuation">.</span>last_output <span class="token operator">=</span> self<span class="token punctuation">.</span>last_output <span class="token operator">+</span> line
        self<span class="token punctuation">.</span>last_output_lines <span class="token operator">+=</span> <span class="token number">1</span>

    <span class="token keyword">return</span> self<span class="token punctuation">.</span>last_output

  <span class="token keyword">def</span> <span class="token function">sftp_copy_from</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> remote_filepath<span class="token punctuation">,</span> local_filepath<span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token keyword">not</span> self<span class="token punctuation">.</span>test_connection<span class="token punctuation">)</span><span class="token punctuation">:</span> self<span class="token punctuation">.</span>ssh_connect<span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token comment"># copy file from remote server object to local path</span>
    log<span class="token punctuation">(</span><span class="token string">&quot;Downloading from '&quot;</span> <span class="token operator">+</span> remote_filepath <span class="token operator">+</span> <span class="token string">&quot;' to '&quot;</span> <span class="token operator">+</span> local_filepath <span class="token operator">+</span> <span class="token string">&quot;'&quot;</span><span class="token punctuation">)</span>
    <span class="token keyword">try</span><span class="token punctuation">:</span>
      self<span class="token punctuation">.</span>status<span class="token punctuation">.</span>start<span class="token punctuation">(</span><span class="token punctuation">)</span>
      self<span class="token punctuation">.</span>last_stat <span class="token operator">=</span> <span class="token boolean">None</span>
      self<span class="token punctuation">.</span>sftp<span class="token punctuation">.</span>get<span class="token punctuation">(</span>remote_filepath<span class="token punctuation">,</span> local_filepath<span class="token punctuation">,</span> callback<span class="token operator">=</span>self<span class="token punctuation">.</span>transfer_progress<span class="token punctuation">)</span>
      self<span class="token punctuation">.</span>status<span class="token punctuation">.</span>stop<span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token keyword">except</span><span class="token punctuation">:</span>
      error_message <span class="token operator">=</span> get_exception_message<span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token string">'\nremote_filepath: '</span> <span class="token operator">+</span> self<span class="token punctuation">.</span>name <span class="token operator">+</span> <span class="token string">':'</span> <span class="token operator">+</span> remote_filepath <span class="token operator">+</span> <span class="token string">'\nlocal_filepath: '</span> <span class="token operator">+</span> local_filepath
      log<span class="token punctuation">(</span>error_message<span class="token punctuation">,</span> color<span class="token operator">=</span><span class="token string">'red'</span><span class="token punctuation">)</span>

  <span class="token keyword">def</span> <span class="token function">sftp_copy_to</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> local_filepath<span class="token punctuation">,</span> remote_filepath<span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token keyword">not</span> self<span class="token punctuation">.</span>test_connection<span class="token punctuation">)</span><span class="token punctuation">:</span> self<span class="token punctuation">.</span>ssh_connect<span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token comment"># copy file from local path to remote server object</span>
    log<span class="token punctuation">(</span><span class="token string">&quot;Uploading from '&quot;</span> <span class="token operator">+</span> local_filepath <span class="token operator">+</span> <span class="token string">&quot;' to '&quot;</span> <span class="token operator">+</span> remote_filepath  <span class="token operator">+</span> <span class="token string">&quot;'&quot;</span><span class="token punctuation">)</span>
    <span class="token keyword">try</span><span class="token punctuation">:</span>
      self<span class="token punctuation">.</span>status<span class="token punctuation">.</span>start<span class="token punctuation">(</span><span class="token punctuation">)</span>
      self<span class="token punctuation">.</span>last_stat <span class="token operator">=</span> <span class="token boolean">None</span>
      self<span class="token punctuation">.</span>sftp<span class="token punctuation">.</span>put<span class="token punctuation">(</span>local_filepath<span class="token punctuation">,</span> remote_filepath<span class="token punctuation">,</span> callback<span class="token operator">=</span>self<span class="token punctuation">.</span>transfer_progress<span class="token punctuation">)</span>
      self<span class="token punctuation">.</span>status<span class="token punctuation">.</span>stop<span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token keyword">except</span><span class="token punctuation">:</span>
      error_message <span class="token operator">=</span> get_exception_message<span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token string">'\nremote_filepath: '</span> <span class="token operator">+</span> self<span class="token punctuation">.</span>name <span class="token operator">+</span> <span class="token string">':'</span> <span class="token operator">+</span> remote_filepath <span class="token operator">+</span> <span class="token string">'\nlocal_filepath: '</span> <span class="token operator">+</span> local_filepath
      log<span class="token punctuation">(</span>error_message<span class="token punctuation">,</span> color<span class="token operator">=</span><span class="token string">'red'</span><span class="token punctuation">)</span>

  <span class="token keyword">def</span> <span class="token function">transfer_progress</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> transferred<span class="token punctuation">,</span> total<span class="token punctuation">,</span> unit<span class="token operator">=</span><span class="token string">'B'</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token string">&quot;Display transfer progress&quot;</span>
    prct <span class="token operator">=</span> <span class="token builtin">int</span><span class="token punctuation">(</span><span class="token number">100.0</span> <span class="token operator">*</span> transferred <span class="token operator">/</span> total<span class="token punctuation">)</span>
    divide <span class="token operator">=</span> <span class="token keyword">lambda</span> x<span class="token punctuation">,</span> y<span class="token punctuation">:</span> <span class="token builtin">round</span><span class="token punctuation">(</span><span class="token number">1.0</span> <span class="token operator">*</span> x <span class="token operator">/</span> <span class="token punctuation">(</span>y<span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">)</span>

    <span class="token keyword">if</span> self<span class="token punctuation">.</span>last_stat<span class="token punctuation">:</span>
      secs <span class="token operator">=</span> <span class="token punctuation">(</span>datetime<span class="token punctuation">.</span>datetime<span class="token punctuation">.</span>now<span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">-</span> self<span class="token punctuation">.</span>last_stat<span class="token punctuation">[</span><span class="token string">'time'</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">.</span>total_seconds<span class="token punctuation">(</span><span class="token punctuation">)</span>
      <span class="token keyword">if</span> secs <span class="token operator">&gt;</span> <span class="token number">2</span><span class="token punctuation">:</span>
        rate <span class="token operator">=</span> <span class="token builtin">round</span><span class="token punctuation">(</span><span class="token punctuation">(</span>transferred <span class="token operator">-</span> self<span class="token punctuation">.</span>last_stat<span class="token punctuation">[</span><span class="token string">'transferred'</span><span class="token punctuation">]</span><span class="token punctuation">)</span> <span class="token operator">/</span> secs<span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">)</span>
        self<span class="token punctuation">.</span>last_stat <span class="token operator">=</span> <span class="token builtin">dict</span><span class="token punctuation">(</span>time<span class="token operator">=</span>now<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> transferred<span class="token operator">=</span>transferred<span class="token punctuation">,</span> rate<span class="token operator">=</span>rate<span class="token punctuation">)</span>
      <span class="token keyword">else</span><span class="token punctuation">:</span>
        rate <span class="token operator">=</span> self<span class="token punctuation">.</span>last_stat<span class="token punctuation">[</span><span class="token string">'rate'</span><span class="token punctuation">]</span>
    <span class="token keyword">else</span><span class="token punctuation">:</span>
      rate <span class="token operator">=</span> <span class="token number">0</span>
      self<span class="token punctuation">.</span>last_stat <span class="token operator">=</span> <span class="token builtin">dict</span><span class="token punctuation">(</span>time<span class="token operator">=</span>now<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> transferred<span class="token operator">=</span>transferred<span class="token punctuation">,</span> rate<span class="token operator">=</span>rate<span class="token punctuation">)</span>

    <span class="token keyword">if</span> total <span class="token operator">&gt;</span> <span class="token number">1024</span> <span class="token operator">**</span> <span class="token number">3</span><span class="token punctuation">:</span>
      transferred <span class="token operator">=</span> divide<span class="token punctuation">(</span>transferred<span class="token punctuation">,</span> <span class="token number">1024</span> <span class="token operator">**</span> <span class="token number">3</span><span class="token punctuation">)</span>
      total <span class="token operator">=</span> divide<span class="token punctuation">(</span>total<span class="token punctuation">,</span> <span class="token number">1024</span> <span class="token operator">**</span> <span class="token number">3</span><span class="token punctuation">)</span>
      unit<span class="token operator">=</span><span class="token string">'GB'</span>
      rate <span class="token operator">=</span> <span class="token string">'{} {} / sec'</span><span class="token punctuation">.</span><span class="token builtin">format</span><span class="token punctuation">(</span>divide<span class="token punctuation">(</span>rate<span class="token punctuation">,</span> <span class="token number">1024</span> <span class="token operator">**</span> <span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token string">'MB'</span><span class="token punctuation">)</span>
    <span class="token keyword">elif</span> total <span class="token operator">&gt;</span> <span class="token number">1024</span> <span class="token operator">**</span> <span class="token number">2</span><span class="token punctuation">:</span>
      transferred <span class="token operator">=</span> divide<span class="token punctuation">(</span>transferred<span class="token punctuation">,</span> <span class="token number">1024</span> <span class="token operator">**</span> <span class="token number">2</span><span class="token punctuation">)</span>
      total <span class="token operator">=</span> divide<span class="token punctuation">(</span>total<span class="token punctuation">,</span> <span class="token number">1024</span> <span class="token operator">**</span> <span class="token number">2</span><span class="token punctuation">)</span>
      unit<span class="token operator">=</span><span class="token string">'MB'</span>
      rate <span class="token operator">=</span> <span class="token string">'{} {} / sec'</span><span class="token punctuation">.</span><span class="token builtin">format</span><span class="token punctuation">(</span>divide<span class="token punctuation">(</span>rate<span class="token punctuation">,</span> <span class="token number">1024</span> <span class="token operator">**</span> <span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">,</span> unit<span class="token punctuation">)</span>
    <span class="token keyword">elif</span> total <span class="token operator">&gt;</span> <span class="token number">1024</span> <span class="token operator">**</span> <span class="token number">1</span><span class="token punctuation">:</span>
      transferred <span class="token operator">=</span> divide<span class="token punctuation">(</span>transferred<span class="token punctuation">,</span> <span class="token number">1024</span> <span class="token operator">**</span> <span class="token number">1</span><span class="token punctuation">)</span>
      total <span class="token operator">=</span> divide<span class="token punctuation">(</span>total<span class="token punctuation">,</span> <span class="token number">1024</span> <span class="token operator">**</span> <span class="token number">1</span><span class="token punctuation">)</span>
      unit<span class="token operator">=</span><span class="token string">'KB'</span>
      rate <span class="token operator">=</span> <span class="token string">'{} {} / sec'</span><span class="token punctuation">.</span><span class="token builtin">format</span><span class="token punctuation">(</span>divide<span class="token punctuation">(</span>rate<span class="token punctuation">,</span> <span class="token number">1024</span> <span class="token operator">**</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">,</span> unit<span class="token punctuation">)</span>
    self<span class="token punctuation">.</span>status<span class="token punctuation">.</span>text <span class="token operator">=</span> <span class="token string">'{}% Complete: {} / {} {} @ {}'</span><span class="token punctuation">.</span><span class="token builtin">format</span><span class="token punctuation">(</span>prct<span class="token punctuation">,</span> transferred<span class="token punctuation">,</span> total<span class="token punctuation">,</span> unit<span class="token punctuation">,</span> rate<span class="token punctuation">)</span>

  <span class="token keyword">def</span> <span class="token function">test_connection</span><span class="token punctuation">(</span>self<span class="token punctuation">)</span><span class="token punctuation">:</span>
    stdout <span class="token operator">=</span> self<span class="token punctuation">.</span>ssh_client<span class="token punctuation">.</span>exec_command<span class="token punctuation">(</span><span class="token string">'ls'</span><span class="token punctuation">)</span>
    <span class="token keyword">return</span> self<span class="token punctuation">.</span>connected
</code></pre></div><h1 id="pip"><a href="#pip" aria-hidden="true" class="header-anchor">#</a> Pip</h1> <p><a href="https://pip.pypa.io/en/stable/reference/pip_install/#git" target="_blank" rel="noopener noreferrer">https://pip.pypa.io/en/stable/reference/pip_install/#git<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></p> <h2 id="installing-with-custom-rpm-library"><a href="#installing-with-custom-rpm-library" aria-hidden="true" class="header-anchor">#</a> Installing with custom RPM library</h2> <div class="language-bash extra-class"><pre class="language-bash"><code><span class="token comment"># Download RPM located at http://rpmfind.net/linux/rpm2html/search.php?query=ncurses-static</span>
<span class="token function">cd</span> /data/user/fl88589/tmp
<span class="token function">wget</span> http://rpmfind.net/linux/centos/6.9/os/x86_64/Packages/ncurses-static-5.7-4.20090207.el6.x86_64.rpm

<span class="token comment"># Install rpm without root</span>
<span class="token function">cd</span> /data/user/fl88589/ps/ncurses-static
rpm2cpio /data/user/fl88589/tmp/ncurses-static-5.7-4.20090207.el6.x86_64.rpm <span class="token operator">|</span> cpio -idv

<span class="token comment"># pip install</span>
tpip3 <span class="token function">install</span> --global-option<span class="token operator">=</span>build_ext --global-option<span class="token operator">=</span><span class="token string">&quot;-L/data/user/fl88589/ps/ncurses-static/usr/lib64&quot;</span> readline
</code></pre></div><h2 id="installing-from-script"><a href="#installing-from-script" aria-hidden="true" class="header-anchor">#</a> Installing from script</h2> <div class="language-python extra-class"><pre class="language-python"><code><span class="token keyword">import</span> pip

<span class="token keyword">def</span> <span class="token function">install</span><span class="token punctuation">(</span>package<span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token keyword">if</span> <span class="token builtin">hasattr</span><span class="token punctuation">(</span>pip<span class="token punctuation">,</span> <span class="token string">'main'</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
        pip<span class="token punctuation">.</span>main<span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token string">'install'</span><span class="token punctuation">,</span> package<span class="token punctuation">]</span><span class="token punctuation">)</span>
    <span class="token keyword">else</span><span class="token punctuation">:</span>
        pip<span class="token punctuation">.</span>_internal<span class="token punctuation">.</span>main<span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token string">'install'</span><span class="token punctuation">,</span> package<span class="token punctuation">]</span><span class="token punctuation">)</span>

<span class="token comment"># Example</span>
<span class="token keyword">if</span> __name__ <span class="token operator">==</span> <span class="token string">'__main__'</span><span class="token punctuation">:</span>
    install<span class="token punctuation">(</span><span class="token string">'argh'</span><span class="token punctuation">)</span>
</code></pre></div><h2 id="install-local-package"><a href="#install-local-package" aria-hidden="true" class="header-anchor">#</a> Install Local Package</h2> <h3 id="from-local-folder"><a href="#from-local-folder" aria-hidden="true" class="header-anchor">#</a> From local folder</h3> <div class="language- extra-class"><pre class="language-text"><code>pip install mypackage --no-index --find-links file:///srv/pkg/mypackage
</code></pre></div><h3 id="edit-develpement-mode"><a href="#edit-develpement-mode" aria-hidden="true" class="header-anchor">#</a> Edit / Develpement Mode</h3> <div class="language- extra-class"><pre class="language-text"><code>pip install -e /path/to/package
</code></pre></div><h3 id="to-local-folder-pythonpath"><a href="#to-local-folder-pythonpath" aria-hidden="true" class="header-anchor">#</a> To Local Folder (PYTHONPATH)</h3> <div class="language- extra-class"><pre class="language-text"><code>pip install --target . mypackage
pip install --target /path/to/folder mypackage
</code></pre></div></div> <div class="page-edit"><!----> <!----></div> <div class="page-nav"><p class="inner"><span class="prev">
        ←
        <a href="/ref-docs/docsDir/programming/python-links.html" class="prev">
          Python Links
        </a></span> <span class="next"><a href="/ref-docs/docsDir/programming/ruby.html">
          Ruby
        </a>
        →
      </span></p></div> </div> <!----></div></div>
    <script src="/ref-docs/assets/js/app.71b49bc2.js" defer></script><script src="/ref-docs/assets/js/31.edabf6af.js" defer></script>
  </body>
</html>
